<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html"><meta property="og:site_name" content="å°è”¡coding"><meta property="og:title" content="åŸºç¡€ç¯‡2"><meta property="og:description" content="SPUå’ŒSKU SPUï¼šstandard product unit(æ ‡å‡†åŒ–äº§å“å•å…ƒ)ï¼šæ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½ï¼Œæ˜¯ä¸€ç»„å¯å¤ç”¨ã€æ˜“æ£€ç´¢çš„æ ‡å‡†åŒ–ä¿¡æ¯çš„é›†åˆï¼Œè¯¥é›†åˆæè¿°äº†ä¸€ä¸ªäº§å“çš„ç‰¹æ€§ã€‚å¦‚iphone13æ˜¯SPUï¼Œå®ƒæ˜¯ä¸€ä¸ªäº§å“çš„é›†åˆ SKUï¼šstock keeping unit(åº“å­˜é‡å•ä½)ï¼šåº“å­˜è¿›å‡ºè®¡é‡çš„åŸºæœ¬å•å…ƒï¼Œå¯ä»¥æ˜¯ä»¶/ç›’/æ‰˜ç›˜ç­‰å•ä½ã€‚ SKUæ˜¯å¯¹äºå¤§..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><title>åŸºç¡€ç¯‡2 | å°è”¡coding</title><meta name="description" content="SPUå’ŒSKU SPUï¼šstandard product unit(æ ‡å‡†åŒ–äº§å“å•å…ƒ)ï¼šæ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½ï¼Œæ˜¯ä¸€ç»„å¯å¤ç”¨ã€æ˜“æ£€ç´¢çš„æ ‡å‡†åŒ–ä¿¡æ¯çš„é›†åˆï¼Œè¯¥é›†åˆæè¿°äº†ä¸€ä¸ªäº§å“çš„ç‰¹æ€§ã€‚å¦‚iphone13æ˜¯SPUï¼Œå®ƒæ˜¯ä¸€ä¸ªäº§å“çš„é›†åˆ SKUï¼šstock keeping unit(åº“å­˜é‡å•ä½)ï¼šåº“å­˜è¿›å‡ºè®¡é‡çš„åŸºæœ¬å•å…ƒï¼Œå¯ä»¥æ˜¯ä»¶/ç›’/æ‰˜ç›˜ç­‰å•ä½ã€‚ SKUæ˜¯å¯¹äºå¤§...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-b0136e4c.css" as="style"><link rel="stylesheet" href="/assets/style-b0136e4c.css">
    <link rel="modulepreload" href="/assets/app-18c23253.js"><link rel="modulepreload" href="/assets/framework-f12b30cc.js"><link rel="modulepreload" href="/assets/åŸºç¡€ç¯‡2.html-47a7f229.js"><link rel="modulepreload" href="/assets/åŸºç¡€ç¯‡2.html-2f532c9a.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.png" alt="å°è”¡coding"><!----><span class="site-name hide-in-pad">å°è”¡coding</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸»é¡µ"><span class="font-icon icon iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/front/Vue/" class="nav-link" aria-label="å‰ç«¯"><span class="font-icon icon iconfont icon-javascript" style=""></span>å‰ç«¯<!----></a></div><div class="nav-item hide-in-mobile"><a href="/Java/" class="nav-link" aria-label="åç«¯"><span class="font-icon icon iconfont icon-java" style=""></span>åç«¯<!----></a></div><div class="nav-item hide-in-mobile"><a href="/devops/" class="nav-link" aria-label="è¿ç»´"><span class="font-icon icon iconfont icon-centos" style=""></span>è¿ç»´<!----></a></div><div class="nav-item hide-in-mobile"><a href="/mysql/" class="nav-link" aria-label="Mysql"><span class="font-icon icon iconfont icon-more" style=""></span>Mysql<!----></a></div><div class="nav-item hide-in-mobile"><a href="/redis/" class="nav-link" aria-label="Redis"><span class="font-icon icon iconfont icon-launch" style=""></span>Redis<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="é¡¹ç›®å®æˆ˜"><span class="title"><span class="font-icon icon iconfont icon-hot" style=""></span>é¡¹ç›®å®æˆ˜</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/study-project/school/" class="nav-link" aria-label="è°·ç²’å­¦é™¢"><!---->è°·ç²’å­¦é™¢<!----></a></li><li class="dropdown-item"><a href="/study-project/mall/" class="nav-link active" aria-label="è°·ç²’å•†åŸ"><!---->è°·ç²’å•†åŸ<!----></a></li><li class="dropdown-item"><a href="/study-project/evaluate/" class="nav-link" aria-label="é»‘é©¬ç‚¹è¯„"><!---->é»‘é©¬ç‚¹è¯„<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#" class="router-link-active router-link-exact-active nav-link" aria-label="æ¢èŠ±äº¤å‹"><!---->æ¢èŠ±äº¤å‹<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#" class="router-link-active router-link-exact-active nav-link" aria-label="é»‘é©¬å¤´æ¡"><!---->é»‘é©¬å¤´æ¡<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#" class="router-link-active router-link-exact-active nav-link" aria-label="å“è¾¾ç‰©æµTMS"><!---->å“è¾¾ç‰©æµTMS<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#" class="router-link-active router-link-exact-active nav-link" aria-label="æ™ºç‰›è‚¡"><!---->æ™ºç‰›è‚¡<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#" class="router-link-active router-link-exact-active nav-link" aria-label="äº¿å¯æ§"><!---->äº¿å¯æ§<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#" class="router-link-active router-link-exact-active nav-link" aria-label="å¼€æºé¡¹ç›®"><!---->å¼€æºé¡¹ç›®<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å­¦ä¹ ä¸­é‡åˆ°çš„é—®é¢˜"><span class="title"><span class="font-icon icon iconfont icon-linux" style=""></span>å­¦ä¹ ä¸­é‡åˆ°çš„é—®é¢˜</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/mac/idea.html" class="nav-link" aria-label="MACä½¿ç”¨IDEAå°æŠ€å·§"><!---->MACä½¿ç”¨IDEAå°æŠ€å·§<!----></a></li><li class="dropdown-item"><a href="/mac/linux.html" class="nav-link" aria-label="Linuxä½¿ç”¨å°æŠ€å·§"><!---->Linuxä½¿ç”¨å°æŠ€å·§<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%871.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€ç¯‡1"><!---->åŸºç¡€ç¯‡1<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="åŸºç¡€ç¯‡2"><!---->åŸºç¡€ç¯‡2<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#spuå’Œsku" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SPUå’ŒSKU"><!---->SPUå’ŒSKU<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#è§„æ ¼å‚æ•°å’Œé”€å”®å±æ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è§„æ ¼å‚æ•°å’Œé”€å”®å±æ€§"><!---->è§„æ ¼å‚æ•°å’Œé”€å”®å±æ€§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#è¡¨çš„å…³ç³»ç†è§£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è¡¨çš„å…³ç³»ç†è§£"><!---->è¡¨çš„å…³ç³»ç†è§£<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å¯¼å…¥å‰ç«¯ä»£ç " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¯¼å…¥å‰ç«¯ä»£ç "><!---->å¯¼å…¥å‰ç«¯ä»£ç <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å®Œå–„åç«¯æ¥å£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®Œå–„åç«¯æ¥å£"><!---->å®Œå–„åç«¯æ¥å£<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#æ¥å£å¼€å‘æµç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ¥å£å¼€å‘æµç¨‹"><!---->æ¥å£å¼€å‘æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å±æ€§åˆ†ç»„è¯¦æƒ…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å±æ€§åˆ†ç»„è¯¦æƒ…"><!---->å±æ€§åˆ†ç»„è¯¦æƒ…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#è§„æ ¼å‚æ•°è¯¦æƒ…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è§„æ ¼å‚æ•°è¯¦æƒ…"><!---->è§„æ ¼å‚æ•°è¯¦æƒ…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#é”€å”®å±æ€§è¯¦æƒ…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é”€å”®å±æ€§è¯¦æƒ…"><!---->é”€å”®å±æ€§è¯¦æƒ…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#åˆ†ç»„ä¸å±æ€§å…³è”" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ†ç»„ä¸å±æ€§å…³è”"><!---->åˆ†ç»„ä¸å±æ€§å…³è”<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å‘å¸ƒå•†å“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å‘å¸ƒå•†å“"><!---->å‘å¸ƒå•†å“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#ä»“åº“æœåŠ¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»“åº“æœåŠ¡"><!---->ä»“åº“æœåŠ¡<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#æ— æ³•å‘é€æŸ¥è¯¢å“ç‰Œä¿¡æ¯çš„è¯·æ±‚" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ— æ³•å‘é€æŸ¥è¯¢å“ç‰Œä¿¡æ¯çš„è¯·æ±‚"><!---->æ— æ³•å‘é€æŸ¥è¯¢å“ç‰Œä¿¡æ¯çš„è¯·æ±‚<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å€¼ç±»å‹ä¿®æ”¹å¤±è´¥-ä¸€ç›´ä¿æŒå¤šé€‰" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å€¼ç±»å‹ä¿®æ”¹å¤±è´¥ï¼Œä¸€ç›´ä¿æŒå¤šé€‰"><!---->å€¼ç±»å‹ä¿®æ”¹å¤±è´¥ï¼Œä¸€ç›´ä¿æŒå¤šé€‰<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/study-project/mall/%E9%AB%98%E7%BA%A7%E7%AF%871.html" class="nav-link sidebar-link sidebar-page" aria-label="é«˜çº§ç¯‡1"><!---->é«˜çº§ç¯‡1<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/study-project/mall/%E9%AB%98%E7%BA%A7%E7%AF%872.html" class="nav-link sidebar-link sidebar-page" aria-label="é«˜çº§ç¯‡2"><!---->é«˜çº§ç¯‡2<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/study-project/mall/%E9%83%A8%E7%BD%B2%E7%AF%871.html" class="nav-link sidebar-link sidebar-page" aria-label="éƒ¨ç½²K8sç¯å¢ƒ"><!---->éƒ¨ç½²K8sç¯å¢ƒ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/study-project/mall/%E9%83%A8%E7%BD%B2%E7%AF%872.html" class="nav-link sidebar-link sidebar-page" aria-label="K8så¿«é€Ÿå…¥é—¨"><!---->K8så¿«é€Ÿå…¥é—¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->åŸºç¡€ç¯‡2</h1><div class="page-info"><span class="author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://xiaocaicoding.cn" target="_blank" rel="noopener noreferrer">xiaocai</a></span><span property="author" content="xiaocai"></span></span><!----><!----><!----><!----><span class="reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 32 min</span><meta property="timeRequired" content="PT32M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#spuå’Œsku" class="router-link-active router-link-exact-active toc-link level2">SPUå’ŒSKU</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#è§„æ ¼å‚æ•°å’Œé”€å”®å±æ€§" class="router-link-active router-link-exact-active toc-link level2">è§„æ ¼å‚æ•°å’Œé”€å”®å±æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#è¡¨çš„å…³ç³»ç†è§£" class="router-link-active router-link-exact-active toc-link level2">è¡¨çš„å…³ç³»ç†è§£</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å¯¼å…¥å‰ç«¯ä»£ç " class="router-link-active router-link-exact-active toc-link level2">å¯¼å…¥å‰ç«¯ä»£ç </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å®Œå–„åç«¯æ¥å£" class="router-link-active router-link-exact-active toc-link level2">å®Œå–„åç«¯æ¥å£</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#æ¥å£å¼€å‘æµç¨‹" class="router-link-active router-link-exact-active toc-link level3">æ¥å£å¼€å‘æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å±æ€§åˆ†ç»„è¯¦æƒ…" class="router-link-active router-link-exact-active toc-link level3">å±æ€§åˆ†ç»„è¯¦æƒ…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#è§„æ ¼å‚æ•°è¯¦æƒ…" class="router-link-active router-link-exact-active toc-link level3">è§„æ ¼å‚æ•°è¯¦æƒ…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#é”€å”®å±æ€§è¯¦æƒ…" class="router-link-active router-link-exact-active toc-link level3">é”€å”®å±æ€§è¯¦æƒ…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#åˆ†ç»„ä¸å±æ€§å…³è”" class="router-link-active router-link-exact-active toc-link level3">åˆ†ç»„ä¸å±æ€§å…³è”</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å‘å¸ƒå•†å“" class="router-link-active router-link-exact-active toc-link level3">å‘å¸ƒå•†å“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#ä»“åº“æœåŠ¡" class="router-link-active router-link-exact-active toc-link level3">ä»“åº“æœåŠ¡</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#æ— æ³•å‘é€æŸ¥è¯¢å“ç‰Œä¿¡æ¯çš„è¯·æ±‚" class="router-link-active router-link-exact-active toc-link level2">æ— æ³•å‘é€æŸ¥è¯¢å“ç‰Œä¿¡æ¯çš„è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%872.html#å€¼ç±»å‹ä¿®æ”¹å¤±è´¥-ä¸€ç›´ä¿æŒå¤šé€‰" class="router-link-active router-link-exact-active toc-link level2">å€¼ç±»å‹ä¿®æ”¹å¤±è´¥ï¼Œä¸€ç›´ä¿æŒå¤šé€‰</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="åŸºç¡€ç¯‡2" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ç¯‡2" aria-hidden="true">#</a> åŸºç¡€ç¯‡2</h1><h2 id="spuå’Œsku" tabindex="-1"><a class="header-anchor" href="#spuå’Œsku" aria-hidden="true">#</a> SPUå’ŒSKU</h2><p><strong>SPUï¼šstandard product unit(æ ‡å‡†åŒ–äº§å“å•å…ƒ)</strong>ï¼šæ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½ï¼Œæ˜¯ä¸€ç»„å¯å¤ç”¨ã€æ˜“æ£€ç´¢çš„æ ‡å‡†åŒ–ä¿¡æ¯çš„é›†åˆï¼Œè¯¥é›†åˆæè¿°äº†ä¸€ä¸ªäº§å“çš„ç‰¹æ€§ã€‚å¦‚iphone13æ˜¯SPUï¼Œå®ƒæ˜¯ä¸€ä¸ªäº§å“çš„é›†åˆ</p><p>**SKUï¼šstock keeping unit(åº“å­˜é‡å•ä½)ï¼š**åº“å­˜è¿›å‡ºè®¡é‡çš„åŸºæœ¬å•å…ƒï¼Œå¯ä»¥æ˜¯ä»¶/ç›’/æ‰˜ç›˜ç­‰å•ä½ã€‚</p><p>SKUæ˜¯å¯¹äºå¤§å‹è¿é”è¶…å¸‚DCé…é€ä¸­å¿ƒç‰©æµç®¡ç†çš„ä¸€ä¸ªå¿…è¦çš„æ–¹æ³•ã€‚ç°åœ¨å·²ç»è¢«å¼•ç”³ä¸º<code>äº§å“ç»Ÿä¸€ç¼–å·</code>çš„ç®€ç§°ï¼Œæ¯ç§äº§å“å¯¹åº”æœ‰å”¯ä¸€çš„SKUå·ã€‚å¦‚iphone13ProMax 1T è“è‰² æ˜¯SKUï¼ŒåŒ…å­åº—ä¸­è‚‰åŒ…å­æ˜¯SKUï¼Œç´ åŒ…å­æ˜¯SKUï¼Œæ°´ç…åŒ…æ˜¯SKU......</p><h2 id="è§„æ ¼å‚æ•°å’Œé”€å”®å±æ€§" tabindex="-1"><a class="header-anchor" href="#è§„æ ¼å‚æ•°å’Œé”€å”®å±æ€§" aria-hidden="true">#</a> è§„æ ¼å‚æ•°å’Œé”€å”®å±æ€§</h2><p>åƒè¿™é‡Œçš„<code>å•†å“ä»‹ç»ï¼Œè§„æ ¼ä¸åŒ…è£…</code>éƒ½æ˜¯å±äºSPUçš„å±æ€§ã€‚å®ƒä»¬éƒ½å±äºæ˜¯<code>è§„æ ¼å‚æ•°</code></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220806105620408.png" alt="image-20220806105620408" tabindex="0" loading="lazy"><figcaption>image-20220806105620408</figcaption></figure><p>åƒç‰ˆæœ¬ï¼Œé¢œè‰²ç­‰éƒ½å±æ˜¯SKUçš„é”€å”®å±æ€§</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220806105802342.png" alt="image-20220806105802342" tabindex="0" loading="lazy"><figcaption>image-20220806105802342</figcaption></figure><h2 id="è¡¨çš„å…³ç³»ç†è§£" tabindex="-1"><a class="header-anchor" href="#è¡¨çš„å…³ç³»ç†è§£" aria-hidden="true">#</a> è¡¨çš„å…³ç³»ç†è§£</h2><p><strong>ï¼ˆ1ï¼‰å±æ€§å…³ç³»-è§„æ ¼å‚æ•°-é”€å”®å±æ€§-ä¸‰çº§åˆ†ç±» å…³è”å…³ç³»</strong></p><p>æ¯ä¸ªä¸‰çº§åˆ†ç±»ä¸‹æœ‰å„è‡ªçš„å±æ€§åˆ†ç»„è¡¨é€šè¿‡<code>idå’Œcatelogidå…³è”</code>ï¼Œèƒ½æŸ¥å‡ºæ¯ä¸ª<strong>åˆ†ç±»ä¸‹çš„å±æ€§åˆ†ç»„</strong></p><p>å±æ€§åˆ†ç»„è¡¨å’Œå±æ€§è¡¨é€šè¿‡ä¸€ä¸ª<code>å±æ€§&amp;å±æ€§å…³è”è¡¨</code>è¿›è¡Œå…³è”ï¼Œèƒ½æŸ¥å‡ºæ¯ä¸ª<strong>å±æ€§åˆ†ç»„ä¸‹çš„å±æ€§</strong></p><p>æœ€ç»ˆè¿™æ ·çš„å…³ç³»æˆ‘ä»¬å¯ä»¥æŸ¥å‡ºæ¯ä¸ªåˆ†ç±»çš„<code>å±æ€§åˆ†ç»„</code>å’Œæ¯ä¸ª<code>å±æ€§åˆ†ç»„å¯¹åº”çš„å±æ€§</code></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220806110205216.png" alt="image-20220806110205216" tabindex="0" loading="lazy"><figcaption>image-20220806110205216</figcaption></figure><p><strong>ï¼ˆ2ï¼‰é€šè¿‡æ€ç»´å¯¼å›¾æ¥ç†è§£</strong></p><blockquote><p>æ‰‹æœºæ˜¯ä¸€çº§åˆ†ç±»ï¼Œå®ƒä¸‹é¢åˆæœ‰å±æ€§ç»„ï¼Œæ¯ä¸ªå±æ€§ç»„åˆæœ‰å„è‡ªçš„å±æ€§</p></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220807230244792.png" alt="image-20220807230244792" tabindex="0" loading="lazy"><figcaption>image-20220807230244792</figcaption></figure><p><strong>ï¼ˆ3ï¼‰SPU-SKUå±æ€§è¡¨</strong></p><p>å•†å“å±æ€§è¡¨å’Œå±æ€§è¡¨é€šè¿‡<code>attrid</code>å’Œ<code>id</code>è¿›è¡Œå…³è”ï¼Œèƒ½æŸ¥å‡ºæ¯ä¸ª<strong>spuçš„å±æ€§</strong></p><p>skué”€å”®å±æ€§è¡¨æ˜¯ä¸ºäº†è¡¨ç¤º<code>spuä¸‹ä¸åŒsku</code>ï¼Œæ¯”å¦‚<strong>1å·spuåœ¨æ­¤è¡¨æœ‰ä¸¤ä¸ªsku</strong>ï¼Œè¿™ä¸¤ä¸ª<strong>skuæœ‰ä¸åŒçš„é”€å”®å±æ€§</strong>ï¼Œæ˜¯é€šè¿‡<code>å’Œå±æ€§è¡¨å…³è”è·å–</code>çš„</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220806110506836.png" alt="image-20220806110506836" tabindex="0" loading="lazy"><figcaption>image-20220806110506836</figcaption></figure><p><strong>ï¼ˆ4ï¼‰é€šè¿‡æ€ç»´å¯¼å›¾æ¥ç†è§£</strong></p><blockquote><p>åƒç½‘ç»œã€åƒç´ ä¸€èˆ¬æ˜¯å›ºå®šä¸å¯é€‰çš„æ‰€ä»¥æ˜¯SPUå±æ€§</p><p>è€Œå†…å­˜ã€å®¹é‡ã€é¢œè‰²ç­‰å¯é€‰çš„å°±ä¸ºSKUé”€å”®å±æ€§</p></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220807231607457.png" alt="image-20220807231607457" tabindex="0" loading="lazy"><figcaption>image-20220807231607457</figcaption></figure><h2 id="å¯¼å…¥å‰ç«¯ä»£ç " tabindex="-1"><a class="header-anchor" href="#å¯¼å…¥å‰ç«¯ä»£ç " aria-hidden="true">#</a> å¯¼å…¥å‰ç«¯ä»£ç </h2><p><strong>ï¼ˆ1ï¼‰é‡æ–°æ‰§è¡Œâ€œsys_menus.sqlâ€ï¼Œå®Œå–„èœå•ã€‚</strong></p><p>æ­£å¸¸æˆ‘ä»¬æ˜¯åœ¨ç³»ç»Ÿç®¡ç†é‡Œè‡ªå®šä¹‰æ·»åŠ ï¼Œæ­¥éª¤éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå…¶å®åœ¨å‰ç«¯é¡µé¢æ·»åŠ å°±æ˜¯æŠŠæ•°æ®æäº¤åˆ°mall_adminè¡¨ä¸­,è¿™é‡Œæˆ‘ä»¬ç›´æ¥æŠŠæä¾›çš„sqlè¯­å¥å¯¼å…¥å³å¯ï¼</p><p>å¦‚ä¸‹ç»“æœï¼š</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220806100125647.png" alt="image-20220806100125647" tabindex="0" loading="lazy"><figcaption>image-20220806100125647</figcaption></figure><p><strong>ï¼ˆ2ï¼‰å®ç°ç‚¹å‡»èœå•çš„å·¦è¾¹ï¼Œèƒ½å¤Ÿå®ç°åœ¨å³è¾¹å±•ç¤ºæ•°æ®</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220806112654338.png" alt="image-20220806112654338" tabindex="0" loading="lazy"><figcaption>image-20220806112654338</figcaption></figure><p>è¿™ä¸ªé¡µé¢å°±æ˜¯ä¸‰çº§åˆ†ç±»å’Œä¸€ä¸ªè¡¨æ ¼æ˜¾ç¤ºåœ¨ä¸€å—å¯¹å§ï¼Œå±äºæ˜¯<code>çˆ¶å­ç»„ä»¶äº¤äº’</code></p><p>å‰ç«¯ä¸å…·ä½“å†™äº†ï¼Œæˆ‘ä»¬ç›´æ¥å¯¼å…¥ä»£ç ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220807232635607.png" alt="image-20220807232635607" tabindex="0" loading="lazy"><figcaption>image-20220807232635607</figcaption></figure><p>å› ä¸ºæ•°æ®åº“æ²¡æ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œä¸æ˜¾ç¤º</p><h2 id="å®Œå–„åç«¯æ¥å£" tabindex="-1"><a class="header-anchor" href="#å®Œå–„åç«¯æ¥å£" aria-hidden="true">#</a> å®Œå–„åç«¯æ¥å£</h2><h3 id="æ¥å£å¼€å‘æµç¨‹" tabindex="-1"><a class="header-anchor" href="#æ¥å£å¼€å‘æµç¨‹" aria-hidden="true">#</a> æ¥å£å¼€å‘æµç¨‹</h3><h4 id="ä»€ä¹ˆæ˜¯å¼€å‘æ¥å£" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å¼€å‘æ¥å£" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯å¼€å‘æ¥å£ï¼Ÿ</h4><p>å¼€å‘æ¥å£å°±æ˜¯å¼€å‘Controllerã€serviceã€dao</p><p>åœ¨çº¿æ¥å£æ–‡æ¡£å¦‚ä¸‹<code>https://easydoc.net/s/78237135/ZUqEdvA4/OXTgKobR</code> åˆ«äººå‘Šè¯‰ä½ éœ€è¦ä»€ä¹ˆåŠŸèƒ½ï¼Œéœ€è¦è¿”å›ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œä½ å°±é€šè¿‡æ¥å£çš„å½¢å¼æŠŠä»–ä»¬å‘¢å®ç°å‡ºæ¥å³å¯ï¼</p><p>ä»¥åå·¥ä½œäº†ä¹Ÿæ˜¯è¿™ç§å½¢å¼ï¼Œä¸»è¦æ˜¯å¼€å‘æ¥å£ä¸ºå¤šï¼Œå‰ç«¯å…¶å®ä¸ç”¨å†™å¤ªå¤šï¼Œèƒ½çœ‹æ‡‚å³å¯ï¼ï¼ï¼</p><h4 id="å¼€å‘æ€è·¯" tabindex="-1"><a class="header-anchor" href="#å¼€å‘æ€è·¯" aria-hidden="true">#</a> å¼€å‘æ€è·¯</h4><p>æ€è·¯ï¼š</p><ul><li>æ ¹æ®æ¥å£æ–‡æ¡£å†™æ¥å£</li><li>ä»£ç ä¸­å¤§éƒ¨åˆ†æ¥å£å·²è‡ªåŠ¨ç”Ÿæˆï¼ˆMBGï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å‰ç«¯é¡µé¢çœ‹å“ªä¸ªè¯·æ±‚å¤±è´¥</li><li>åç«¯æ”¹æ¥å£</li></ul><p><strong>è¿™ä¸€éƒ¨åˆ†éƒ½æ˜¯CRUDç›¸å…³çš„ä»£ç ï¼Œæ‰€ä»¥è¦å¥½å¥½ç»ƒå¥½å¥½å†™ï¼ï¼ï¼</strong></p><h3 id="å±æ€§åˆ†ç»„è¯¦æƒ…" tabindex="-1"><a class="header-anchor" href="#å±æ€§åˆ†ç»„è¯¦æƒ…" aria-hidden="true">#</a> å±æ€§åˆ†ç»„è¯¦æƒ…</h3><h4 id="æ˜¾ç¤ºå±æ€§åˆ†ç»„" tabindex="-1"><a class="header-anchor" href="#æ˜¾ç¤ºå±æ€§åˆ†ç»„" aria-hidden="true">#</a> æ˜¾ç¤ºå±æ€§åˆ†ç»„</h4><p><strong>æ¥å£å¦‚ä¸‹ï¼š</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220810220705409.png" alt="image-20220810220705409" tabindex="0" loading="lazy"><figcaption>image-20220810220705409</figcaption></figure><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list/{catelogId}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span>
                  <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        PageUtils page = attrGroupService.queryPage(params);</span>

        <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">queryPage</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><blockquote><p>è¿™é‡Œæ³¨æ„ï¼Œå‰ç«¯æœ‰ä¸¤ä¸ªæŸ¥è¯¢æŒ‰é’®</p><p>æŸ¥è¯¢å’ŒæŸ¥è¯¢å…¨éƒ¨</p><p>è¿™ä¸¤ä¸ªéƒ½è¦æœ‰æ¨¡ç³ŠæŸ¥è¯¢çš„åŠŸèƒ½ï¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//å¤šæ¡ä»¶æŸ¥è¯¢</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            obj<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_group_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;attr_group_name&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>catelogId <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¦‚æœæ˜¯é»˜è®¤çš„æ˜¯æŸ¥å…¨éƒ¨çš„ä¸€çº§åˆ†ç±»</span>
        <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span> wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811091620116.png" alt="image-20220811091620116" tabindex="0" loading="lazy"><figcaption>image-20220811091620116</figcaption></figure><h4 id="å±æ€§åˆ†ç»„å›æ˜¾" tabindex="-1"><a class="header-anchor" href="#å±æ€§åˆ†ç»„å›æ˜¾" aria-hidden="true">#</a> å±æ€§åˆ†ç»„å›æ˜¾</h4><blockquote><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯åšå±æ€§åˆ†ç»„çš„æ•°æ®å›æ˜¾çš„</p></blockquote><p><strong>æ¥å£å¦‚ä¸‹ï¼š</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220810220631503.png" alt="image-20220810220631503" tabindex="0" loading="lazy"><figcaption>image-20220810220631503</figcaption></figure><p><code>å‰ç«¯è¿™é‡Œçœç•¥ï¼Œéœ€è¦å»elementuiæ‰¾ç»„ä»¶ï¼Œæ”¹æ•°æ®</code></p><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ä¿¡æ¯
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/info/{attrId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> attrId<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token class-name">AttrEntity</span> attr <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attrId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Long</span> catelogId <span class="token operator">=</span> attr<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> path <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">findCatelogPath</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    attr<span class="token punctuation">.</span><span class="token function">setCatelogPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;attr&quot;</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><blockquote><p><strong>è·å–åˆ†ç±»è·¯å¾„id</strong></p><p>é€šè¿‡é€’å½’æ“ä½œå®Œæˆ</p><p><strong>è¿‡ç¨‹</strong></p><p>ç»™ä¸€ä¸ªåˆ†ç±»idï¼Œä¸æ–­çš„æŸ¥å®ƒçš„çˆ¶ç±»idç›´åˆ°æŸ¥ä¸åˆ°ä¸ºæ­¢ï¼Œæœ€åæŠŠæŸ¥è¯¢åˆ°çš„idåˆ°æ”¾åˆ°ä¸€ä¸ªé›†åˆé‡Œ</p><p><strong>æ€æ ·å†™å¥½é€’å½’ï¼Ÿ</strong></p><ol><li>ç¡®å®šå‚æ•°å€¼å’Œè¿”å›å€¼</li><li>ç¡®å®šç»ˆæ­¢æ¡ä»¶</li><li>é€’å½’é€»è¾‘</li></ol><p>ä¸‰è€…ç¼ºä¸€ä¸å¯ï¼ï¼ï¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//æ‰¾åˆ°catelogIdçš„å®Œæ•´è·¯å¾„:[çˆ¶/å­/å­™]</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findCatelogPath</span><span class="token punctuation">(</span><span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> parentPath <span class="token operator">=</span> <span class="token function">findParentPath</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1.ç¡®å®šé€’å½’å‚æ•°å’Œè¿”å›å€¼</span>

    <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span>parentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Long</span><span class="token punctuation">[</span>parentPath<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">findParentPath</span><span class="token punctuation">(</span><span class="token class-name">Long</span> catelogId<span class="token punctuation">,</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//3.é€’å½’é€»è¾‘</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CategoryEntity</span> entity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//2.é€’å½’ç»ˆæ­¢æ¡ä»¶</span>
        <span class="token function">findParentPath</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><p>è¿”å›å±æ€§çš„çˆ¶è·¯å¾„id</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811092606249.png" alt="image-20220811092606249" tabindex="0" loading="lazy"><figcaption>image-20220811092606249</figcaption></figure><h3 id="è§„æ ¼å‚æ•°è¯¦æƒ…" tabindex="-1"><a class="header-anchor" href="#è§„æ ¼å‚æ•°è¯¦æƒ…" aria-hidden="true">#</a> è§„æ ¼å‚æ•°è¯¦æƒ…</h3><p><strong>æ¥å£å¦‚ä¸‹ï¼š</strong><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220810220725125.png" alt="image-20220810220725125" loading="lazy"></p><p><strong>ä»€ä¹ˆæ˜¯è§„æ ¼å‚æ•°ï¼Ÿ</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220808231624265.png" alt="image-20220808231624265" tabindex="0" loading="lazy"><figcaption>image-20220808231624265</figcaption></figure><h4 id="ä¿å­˜è§„æ ¼å‚æ•°" tabindex="-1"><a class="header-anchor" href="#ä¿å­˜è§„æ ¼å‚æ•°" aria-hidden="true">#</a> ä¿å­˜è§„æ ¼å‚æ•°</h4><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ä¿å­˜
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/save&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">AttrVo</span> vo<span class="token punctuation">)</span><span class="token punctuation">{</span>
	attrService<span class="token punctuation">.</span><span class="token function">saveAttr</span><span class="token punctuation">(</span>vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><blockquote><p>è¿™é‡Œæ³¨æ„ï¼Œå› ä¸ºæ·»åŠ è§„æ ¼å‚æ•°çš„æ—¶å€™ä¼šæœ‰é€‰æ‹©å±æ€§ç»„ï¼Œå› ä¸º<code>å±æ€§ç»„å’Œå±æ€§</code>æ˜¯é€šè¿‡å…³è”å…³ç³»è¡¨è¿æ¥çš„æ‰€ä»¥è¦æœ‰çº§è”æ“ä½œã€‚</p><p><strong>åœ¨å¾€pms_attrè¡¨æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œpms_attr_group_relationä¹Ÿè¦æ’å…¥</strong></p><p><code>å°bug</code>ï¼šè¿™é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹ï¼Œå½“æ·»åŠ è§„æ ¼å‚æ•°çš„æ—¶å€™å¦‚æœæ²¡æœ‰æŒ‡å®šè§„æ ¼å‚æ•°æ‰€å±åˆ†ç»„ï¼Œé‚£ä¹ˆå°±ä¸åº”è¯¥åœ¨å…³è”è¡¨ä¸­ä¿å­˜å…³è”å…³ç³»ï¼ï¼ï¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAttr</span><span class="token punctuation">(</span><span class="token class-name">AttrVo</span> attr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AttrEntity</span> attrEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1.å°†å‰ç«¯æ¥æ”¶æ•°æ®çš„å¯¹è±¡voèµ‹å€¼ç»™attrEntityå¯¹è±¡ï¼Œä»è€Œæ›´æ–°æ•°æ®åº“</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span> attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span><span class="token constant">ATTR_TYPE_BASE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> attr<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//2.ä¿å­˜å…³è”å…³ç³»</span>
        <span class="token comment">//å› ä¸ºå±æ€§ç»„å’Œå±æ€§æ˜¯é€šè¿‡å…³è”å…³ç³»è¡¨è¿æ¥çš„</span>
        <span class="token class-name">AttrAttrgroupRelationEntity</span> relationEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        relationEntity<span class="token punctuation">.</span><span class="token function">setAttrGroupId</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        relationEntity<span class="token punctuation">.</span><span class="token function">setAttrId</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        relationService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>relationEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ˜¾ç¤ºè§„æ ¼å‚æ•°" tabindex="-1"><a class="header-anchor" href="#æ˜¾ç¤ºè§„æ ¼å‚æ•°" aria-hidden="true">#</a> æ˜¾ç¤ºè§„æ ¼å‚æ•°</h4><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ˜¾ç¤ºè§„æ ¼å‚æ•°
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/base/list/{catelogId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">baseAttrList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span>
                      <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">queryBaseAttrPage</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//åˆ†é¡µæŸ¥è¯¢è§„æ ¼å‚æ•°</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryBaseAttrPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">Integer</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>catelogId <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¦‚æœä¸æ˜¯ä¸€çº§åˆ†ç±»ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ—¶å€™åŠ ä¸Šwhere catelog_id = ?</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å¤šæ¡ä»¶æ¨¡ç³ŠæŸ¥è¯¢</span>
    <span class="token comment">//æœç´¢æ¡†é‡Œçš„keyä¸ä½†å¯ä»¥å¯¹catelog_idè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯¹attr_nameä¹Ÿæ¨¡ç³ŠæŸ¥è¯¢</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢</span>
    <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
        wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">PageUtils</span> pageUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pageUtils<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><p>å¦‚ä¸‹ï¼š</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220810205809739.png" alt="image-20220810205809739" tabindex="0" loading="lazy"><figcaption>image-20220810205809739</figcaption></figure><p><strong>è¿™äº›å±æ€§çš„åˆ†ç±»å’Œæ‰€å±åˆ†ç»„æ€ä¹ˆæŸ¥å‘¢ï¼Ÿ</strong></p><blockquote css-module="."><p><code>è§„æ ¼å‚æ•°è¡¨ï¼ˆpms_attrï¼‰</code>ä¸­ï¼Œæœ‰æ‰€å±åˆ†ç±»çš„ä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨åˆ†ç±»çš„serviceè¿›è¡ŒæŸ¥è¯¢</p><p>é‚£åˆ†ç»„ä¿¡æ¯æ€ä¹ˆæŸ¥è¯¢å‘¢ï¼Ÿè§„æ ¼å‚æ•°è¡¨ä¸­æ²¡æœ‰æ‰€å±åˆ†ç±»ç›¸å…³çš„ä¿¡æ¯...</p><p>è¿™é‡Œæˆ‘ä»¬å°±è¦å€ŸåŠ©ç¬¬ä¸‰å¼ è¡¨ï¼Œ<code>å±æ€§å’Œåˆ†ç»„è¡¨ï¼ˆpms_attr_attrgroup_relationï¼‰</code>è¿›è¡ŒæŸ¥è¯¢</p><p>é€šè¿‡<code>è§„æ ¼å‚æ•°è¡¨ï¼ˆpms_attrï¼‰</code>è·å¾—<code>attr_id</code>ï¼Œä¹‹ååœ¨è°ƒç”¨<code>å±æ€§å’Œåˆ†ç»„è¡¨</code>çš„service<code>è·å¾—å±æ€§å’Œåˆ†ç»„è¡¨çš„å®ä½“ç±»</code>ï¼Œä»è€Œè·å¾—è¯¥å±æ€§çš„åˆ†ç»„</p><p>ä¸‹é¢é€šè¿‡<code>stream</code>æµçš„æ–¹å¼ï¼Œé€šè¿‡mapç»™listé›†åˆä¸­çš„æ¯ä¸€é¡¹åšæ˜ å°„ç»™<code>æ–°å®ä½“ç±»ï¼ˆAttrRespVoï¼‰</code>èµ‹å€¼ï¼Œæœ€åè¿”å›<code>AttrRespVo</code></p><p><code>å°bugï¼š</code>è¿™é‡Œæ˜¾ç¤ºè§„æ ¼å‚æ•°çš„æ—¶å€™ï¼Œä¼šæ˜¾ç¤ºè§„æ ¼ã€‚å‚æ•°å¯¹åº”çš„åˆ†ç»„ã€åˆ†ç±»ï¼Œé‚£ä¹ˆå¦‚æœå®ƒä»¬æŸ¥å‡ºå¯¹è±¡åˆ†ç»„idæˆ–åˆ†ç±»idä¸ºç©ºé‚£å°±ä¸è®¾ç½®åå­—if (attrId != null &amp;&amp; attrId.getAttrGroupId() != null)</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//åˆ†é¡µæŸ¥è¯¢è§„æ ¼å‚æ•°</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryBaseAttrPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">,</span> <span class="token class-name">Integer</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;base&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span><span class="token constant">ATTR_TYPE_BASE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span><span class="token constant">ATTR_TYPE_SALE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>catelogId <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¦‚æœä¸æ˜¯ä¸€çº§åˆ†ç±»ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ—¶å€™åŠ ä¸Šwhere catelog_id = ?</span>
        <span class="token comment">//IgnoreCaseå¿½ç•¥å¤§å°å†™</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å¤šæ¡ä»¶æ¨¡ç³ŠæŸ¥è¯¢</span>
    <span class="token comment">//æœç´¢æ¡†é‡Œçš„keyä¸ä½†å¯ä»¥å¯¹catelog_idè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯¹attr_nameä¹Ÿæ¨¡ç³ŠæŸ¥è¯¢</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢</span>
    <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
        wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">PageUtils</span> pageUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//        .map()è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹è¢«ç­›é€‰è¿‡åçš„æµè¿›è¡Œæ˜ å°„ï¼Œä¸€èˆ¬æ˜¯å¯¹å±æ€§è¿›è¡Œèµ‹å€¼ã€‚</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrRespVo</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">AttrRespVo</span> attrRespvo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrRespVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> attrRespvo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®åˆ†ç±»å’Œåˆ†ç»„çš„åå­—</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;base&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">AttrAttrgroupRelationEntity</span> attrId <span class="token operator">=</span> relationService<span class="token punctuation">.</span>
                <span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>attrId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> attrId<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//attrgroupRelationEntity.getAttrGroupId()ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥æ”¾è¿›å»å¯¹è±¡</span>
                <span class="token class-name">AttrGroupEntity</span> attrGroupEntity <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attrId<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                attrRespvo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>attrGroupEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">CategoryEntity</span> categoryEntity <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            attrRespvo<span class="token punctuation">.</span><span class="token function">setCatelogName</span><span class="token punctuation">(</span>categoryEntity<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//è¿”å›æœ€åçš„å°è£…ç»“æœ</span>
        <span class="token keyword">return</span> attrRespvo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªé›†åˆ</span>
    pageUtils<span class="token punctuation">.</span><span class="token function">setList</span><span class="token punctuation">(</span>resultList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//        è¿”å›åˆ†é¡µåçš„é›†åˆå¯¹è±¡</span>
    <span class="token keyword">return</span> pageUtils<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>AttrRespVo</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AttrRespVo</span> <span class="token keyword">extends</span> <span class="token class-name">AttrVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> catelogName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span>  groupName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811084206902.png" alt="image-20220811084206902" tabindex="0" loading="lazy"><figcaption>image-20220811084206902</figcaption></figure><h4 id="è§„æ ¼å‚æ•°å›æ˜¾" tabindex="-1"><a class="header-anchor" href="#è§„æ ¼å‚æ•°å›æ˜¾" aria-hidden="true">#</a> è§„æ ¼å‚æ•°å›æ˜¾</h4><blockquote><p>å¯ä»¥çœ‹å‡ºæ‰€å±åˆ†ç±»å’Œåˆ†ç»„éƒ½æ˜¯ç”±è¿™æ¡è¯·æ±‚æŸ¥è¯¢çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ”¹è¿™ä¸ªæ¥å£åŠŸèƒ½å°±è¡Œ</p><p>ç›¸å½“äºåœ¨<code>åŸæ¥æŸ¥è¯¢åŸºç¡€ä¸Š</code>è¿”å›<code>åˆ†ç±»è·¯å¾„ä¿¡æ¯</code>ï¼Œ<code>åˆ†ç»„ä¿¡æ¯</code></p></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220810221107404.png" alt="image-20220810221107404" tabindex="0" loading="lazy"><figcaption>image-20220810221107404</figcaption></figure><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ä¿¡æ¯
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/info/{attrId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> attrId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AttrRespVo</span> respVo <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getAttrInfo</span><span class="token punctuation">(</span>attrId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;attr&quot;</span><span class="token punctuation">,</span> respVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">AttrRespVo</span> <span class="token function">getAttrInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> attrId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AttrRespVo</span> respVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrRespVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AttrEntity</span> attrEntity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attrId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">,</span> respVo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è®¾ç½®åˆ†ç»„ä¿¡æ¯
     */</span>
    <span class="token class-name">AttrAttrgroupRelationEntity</span> attrgroupRelationEntity <span class="token operator">=</span> relationService<span class="token punctuation">.</span>
            <span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attrEntity<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>attrgroupRelationEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        respVo<span class="token punctuation">.</span><span class="token function">setAttrGroupId</span><span class="token punctuation">(</span>attrgroupRelationEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Long</span> attrGroupId <span class="token operator">=</span> attrgroupRelationEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AttrGroupEntity</span> attrGroupEntity <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attrGroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>attrGroupEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            respVo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>attrGroupEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * è®¾ç½®åˆ†ç±»ä¿¡æ¯
     */</span>
    <span class="token class-name">Long</span> catelogId <span class="token operator">=</span> attrEntity<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æœ‰äº†åˆ†ç±»çš„å®Œæ•´è·¯å¾„ï¼Œæ¥ä¸‹æ¥å°±è®¾ç½®åˆ†ç±»åå­—</span>
    <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> catelogPath <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">findCatelogPath</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    respVo<span class="token punctuation">.</span><span class="token function">setCatelogPath</span><span class="token punctuation">(</span>catelogPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//è·å¾—åˆ†ç±»åå­—</span>
    <span class="token class-name">CategoryEntity</span> categoryEntity <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        respVo<span class="token punctuation">.</span><span class="token function">setCatelogName</span><span class="token punctuation">(</span>categoryEntity<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> respVo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220810232827723.png" alt="image-20220810232827723" tabindex="0" loading="lazy"><figcaption>image-20220810232827723</figcaption></figure><h4 id="ä¿®æ”¹orå¢åŠ " tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹orå¢åŠ " aria-hidden="true">#</a> ä¿®æ”¹Orå¢åŠ </h4><blockquote><p>æäº¤ä¿®æ”¹åˆ†ç±»å’Œåˆ†ç»„æ˜¯æ— æ•ˆçš„ï¼Ÿ</p><p>æ›´æ”¹ç”¨çš„è¿˜æ˜¯é»˜è®¤çš„updateæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¹updateæ¥å£ï¼</p></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220810232652674.png" alt="image-20220810232652674" tabindex="0" loading="lazy"><figcaption>image-20220810232652674</figcaption></figure><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ä¿®æ”¹
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/update&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">AttrVo</span> attr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    attrService<span class="token punctuation">.</span><span class="token function">updateAttr</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><blockquote><p>è¿™é‡Œåšäº†ä¼˜åŒ–ï¼Œå¯¹äºè§„æ ¼å‚æ•°ä¸­æ²¡æœ‰æ‰€å±åˆ†ç»„çš„ï¼Œå¦‚æœæŒ‡å®šäº†ä¸åœ¨æ˜¯ä¿®æ”¹è€Œæ˜¯æ·»åŠ ï¼</p><p><strong>æ€ä¹ˆåˆ¤æ–­è§„æ ¼å‚æ•°æœ‰æ²¡æœ‰æ‰€å±åˆ†ç»„å‘¢ï¼Ÿ</strong></p><p>æ‹¿attr_idå»<code>pms_attr_attrgroup_relation</code>è¡¨ä¸­æŸ¥è¯¢ï¼Œå¦‚æœæ”¹attr_idå­˜åœ¨ä¸è¯¥è¡¨ï¼Œé‚£å°±ä¿®æ”¹å…³è”å…³ç³»</p><p>å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆå°±åœ¨æ­¤è¡¨æ·»åŠ æ•°æ®ï¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateAttr</span><span class="token punctuation">(</span><span class="token class-name">AttrVo</span> attr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AttrEntity</span> attrEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span> attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¿®æ”¹åˆ†ç»„å…³è”</span>
    <span class="token class-name">AttrAttrgroupRelationEntity</span> attrAttrgroupRelationEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    attrAttrgroupRelationEntity<span class="token punctuation">.</span><span class="token function">setAttrGroupId</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    attrAttrgroupRelationEntity<span class="token punctuation">.</span><span class="token function">setAttrId</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//ç»Ÿè®¡attr_idçš„å…³è”å±æ€§,å¦‚æœæ²¡æœ‰åˆå§‹åˆ†ç»„,åˆ™è¿›è¡Œæ·»åŠ æ“ä½œ;æœ‰åˆ™è¿›è¡Œä¿®æ”¹æ“ä½œ</span>
    <span class="token class-name">Integer</span> count <span class="token operator">=</span> relation<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        relation<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>attrAttrgroupRelationEntity<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        relation<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>attrAttrgroupRelationEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="spuè§„æ ¼ç»´æŠ¤" tabindex="-1"><a class="header-anchor" href="#spuè§„æ ¼ç»´æŠ¤" aria-hidden="true">#</a> spuè§„æ ¼ç»´æŠ¤</h4><p>å‡ºç°400é¡µé¢ï¼Œåœ¨æ•°æ®åº“æ·»åŠ </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token constant">INSERT</span> <span class="token class-name">INTO</span> sys_menu <span class="token punctuation">(</span>menu_id<span class="token punctuation">,</span> parent_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> url<span class="token punctuation">,</span> perms<span class="token punctuation">,</span> type<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> order_num<span class="token punctuation">)</span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token char">&#39;è§„æ ¼ç»´æŠ¤&#39;</span><span class="token punctuation">,</span> &#39;product<span class="token operator">/</span>attrupdate<span class="token char">&#39;, &#39;</span><span class="token char">&#39;, 2, &#39;</span>log&#39;<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

æ›´æ–°index<span class="token punctuation">.</span>jsï¼Œå“ªé‡Œæ›´æ–°ï¼Ÿæ‰¾è€å¸ˆçš„æºç 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>controller</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/update/{spuId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">updateSpuAttr</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;spuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> spuId<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span><span class="token punctuation">{</span>

    productAttrValueService<span class="token punctuation">.</span><span class="token function">updateSpuAttr</span><span class="token punctuation">(</span>spuId<span class="token punctuation">,</span>entities<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>impl</p></blockquote><p>è¿™é‡Œçš„ä¿®æ”¹å…¶å®æ˜¯å…ˆæŠŠåŸæ¥çš„spu_idä¸‹çš„å±æ€§éƒ½åˆ é™¤æ‰</p><p>ä¹‹ååœ¨æŠŠå‰ç«¯ä¼ æ¥çš„å±æ€§é›†åˆè¿›è¡Œæ‰¹é‡ä¿å­˜</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateSpuAttr</span><span class="token punctuation">(</span><span class="token class-name">Long</span> spuId<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1ã€åˆ é™¤spuIdä¹‹å‰å¯¹åº”çš„æ‰€æœ‰å±æ€§</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;spu_id&quot;</span><span class="token punctuation">,</span>spuId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//2ã€æ·»åŠ å•†å“è§„æ ¼ä¿¡æ¯</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> entities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//æ‰¹é‡æ–°å¢</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é”€å”®å±æ€§è¯¦æƒ…" tabindex="-1"><a class="header-anchor" href="#é”€å”®å±æ€§è¯¦æƒ…" aria-hidden="true">#</a> é”€å”®å±æ€§è¯¦æƒ…</h3><h4 id="æ˜¾ç¤ºé”€å”®å±æ€§" tabindex="-1"><a class="header-anchor" href="#æ˜¾ç¤ºé”€å”®å±æ€§" aria-hidden="true">#</a> æ˜¾ç¤ºé”€å”®å±æ€§</h4><p>å¦‚å›¾<code>http://localhost:88/api/product/attr/sale/list/0?t=1660181297434&amp;page=1&amp;limit=10&amp;key=</code>è¿™ä¸ªæ¥å£æœ‰é—®é¢˜ï¼</p><p>æ‰€ä»¥æˆ‘ä»¬å°±å»åç«¯æ”¹è¿™ä¸ªæ¥å£å³å¯ï¼</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811092412567.png" alt="image-20220811092412567" tabindex="0" loading="lazy"><figcaption>image-20220811092412567</figcaption></figure><p><strong>controller</strong></p><blockquote><p>è§„æ ¼å‚æ•°å’Œé”€å”®å‚æ•°çš„åŒºåˆ«åœ¨äºtypeçš„å€¼ï¼Œ<code>typeä¸º 1æ˜¯è§„æ ¼å‚æ•°</code>ï¼Œ<code>typeä¸º0æ˜¯é”€å”®å‚æ•°</code></p><p>è¿™é‡Œé‡‡ç”¨ä¸€ä¸ªæ–¹æ³•å½“ä¸¤ä¸ªæ¥ç”¨ï¼</p></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811094628873.png" alt="image-20220811094628873" tabindex="0" loading="lazy"><figcaption>image-20220811094628873</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{attrType}/list/{catelogId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">baseAttrList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span>
                      <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrType&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> type<span class="token punctuation">,</span>
                      <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">queryBaseAttrPage</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> type<span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><blockquote><p>åœ¨åŸæ¥å¯¹è§„æ ¼å‚æ•°çš„åŸºç¡€ä¸ŠåŠ äº†é™åˆ¶æ¡ä»¶ï¼Œå¦‚æœæ˜¯è§„æ ¼å‚æ•°é‚£å°±æ˜¯WHERE attr_type = 1,å¦åˆ™å°±æ˜¯WHERE attr_type = 0ï¼›</p><p>ä¸‹é¢çš„é€»è¾‘å’ŒæŸ¥è¯¢è§„æ ¼å‚æ•°ä¸€è‡´ï¼Œéƒ½è¦æ¨¡ç³ŠæŸ¥è¯¢</p><p>è¿™é‡Œä¸ºäº†ä½¿ä»£ç æ›´é€šç”¨ï¼Œ1å’Œ0çš„å€¼æˆ‘ä»¬å†™ä¸€ä¸ªå¸¸é‡æ¥æ§åˆ¶ï¼Œå¦‚è¿‡åæœŸæ¢å€¼äº†æˆ‘ä»¬ç›´æ¥æ›´æ”¹å¸¸é‡çš„å€¼å³å¯</p></blockquote><p><strong>ProductConstant</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>caq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>constant</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductConstant</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">AttrEnum</span><span class="token punctuation">{</span>
        <span class="token function">ATTR_TYPE_BASE</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;åŸºæœ¬å±æ€§&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">ATTR_TYPE_SALE</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;é”€å”®å±æ€§&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>

        <span class="token class-name">AttrEnum</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> code<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨åŸæ¥å¯¹è§„æ ¼å‚æ•°çš„åŸºç¡€ä¸ŠåŠ äº†é™åˆ¶æ¡ä»¶ï¼Œå¦‚æœæ˜¯è§„æ ¼å‚æ•°é‚£å°±æ˜¯<code>WHERE attr_type = 1</code>,å¦åˆ™å°±æ˜¯<code>WHERE attr_type = 0ï¼›</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryBaseAttrPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">,</span> <span class="token class-name">Integer</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;base&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span><span class="token constant">ATTR_TYPE_BASE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span><span class="token constant">ATTR_TYPE_SALE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>catelogId <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//å¦‚æœä¸æ˜¯ä¸€çº§åˆ†ç±»ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ—¶å€™åŠ ä¸Šwhere catelog_id = ?</span>
            <span class="token comment">//IgnoreCaseå¿½ç•¥å¤§å°å†™</span>
            wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//å¤šæ¡ä»¶æ¨¡ç³ŠæŸ¥è¯¢</span>
        <span class="token comment">//æœç´¢æ¡†é‡Œçš„keyä¸ä½†å¯ä»¥å¯¹catelog_idè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯¹attr_nameä¹Ÿæ¨¡ç³ŠæŸ¥è¯¢</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢</span>
        <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
                wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PageUtils</span> pageUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        .map()è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹è¢«ç­›é€‰è¿‡åçš„æµè¿›è¡Œæ˜ å°„ï¼Œä¸€èˆ¬æ˜¯å¯¹å±æ€§è¿›è¡Œèµ‹å€¼ã€‚</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrRespVo</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">AttrRespVo</span> attrRespvo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrRespVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> attrRespvo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">AttrAttrgroupRelationEntity</span> attrgroupRelationEntity <span class="token operator">=</span> relationService<span class="token punctuation">.</span>
                    <span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>attrgroupRelationEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//attrgroupRelationEntity.getAttrGroupId()ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥æ”¾è¿›å»å¯¹è±¡</span>
                <span class="token class-name">AttrGroupEntity</span> attrGroupEntity <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attrgroupRelationEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
                attrRespvo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>attrGroupEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">CategoryEntity</span> categoryEntity <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                attrRespvo<span class="token punctuation">.</span><span class="token function">setCatelogName</span><span class="token punctuation">(</span>categoryEntity<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//è¿”å›æœ€åçš„å°è£…ç»“æœ</span>
            <span class="token keyword">return</span> attrRespvo<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªé›†åˆ</span>
        pageUtils<span class="token punctuation">.</span><span class="token function">setList</span><span class="token punctuation">(</span>resultList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        è¿”å›åˆ†é¡µåçš„é›†åˆå¯¹è±¡</span>
        <span class="token keyword">return</span> pageUtils<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é”€å”®å±æ€§å›æ˜¾" tabindex="-1"><a class="header-anchor" href="#é”€å”®å±æ€§å›æ˜¾" aria-hidden="true">#</a> é”€å”®å±æ€§å›æ˜¾</h4><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œé”€å”®å±æ€§å›æ˜¾æ˜¯ä¸éœ€è¦æ‰€å±åˆ†ç»„çš„</p><p>ä½†æ˜¯<code>é”€å”®å±æ€§</code>å’Œ<code>è§„æ ¼å‚æ•°</code>ç”¨çš„æ˜¯<code>åŒä¸€ä¸ªå›æ˜¾æ–¹æ³•</code>ï¼Œæˆ‘ä»¬ä¹Ÿè¿›è¡Œæ›´æ”¹ï¼Œ<code>åªæœ‰æ˜¯è§„æ ¼å‚æ•°çš„æ—¶å€™æ‰è¿›è¡Œåˆ†ç»„å›æ˜¾</code>ï¼</p></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811104643952.png" alt="image-20220811104643952" tabindex="0" loading="lazy"><figcaption>image-20220811104643952</figcaption></figure><p>åœ¨åŸåˆ†ç»„å›æ˜¾çš„é€»è¾‘ä¸ŠåŠ ä¸Šåˆ¤æ–­ï¼Œåé¢é€»è¾‘ä¸å˜ï¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getAttrType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span><span class="token constant">ATTR_TYPE_BASE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811104920477.png" alt="image-20220811104920477" tabindex="0" loading="lazy"><figcaption>image-20220811104920477</figcaption></figure><h4 id="ä¿®æ”¹é”€å”®å±æ€§" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹é”€å”®å±æ€§" aria-hidden="true">#</a> ä¿®æ”¹é”€å”®å±æ€§</h4><blockquote><p><code>é”€å”®å±æ€§</code>å’Œ<code>è§„æ ¼å‚æ•°</code>ç”¨çš„æ˜¯<code>åŒä¸€ä¸ªä¿®æ”¹æ–¹æ³•</code>ï¼Œé”€å”®å±æ€§è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šå¯¹å…³è”è¡¨è¿›è¡Œä¸€ä¸ªçº§è”æ›´æ–°ï¼Œä½†é”€å”®å±æ€§ä¸éœ€è¦</p><p>æ‰€ä»¥ä¹Ÿåœ¨å¯¹å…³è”è¡¨çº§è”æ›´æ–°çš„æ—¶å€™è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é”€å”®å±æ€§ä¿®æ”¹çš„æ—¶å€™æ‰è¿›è¡Œçº§è”æ›´æ–°ï¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getAttrType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span><span class="token constant">ATTR_TYPE_BASE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811105227416.png" alt="image-20220811105227416" tabindex="0" loading="lazy"><figcaption>image-20220811105227416</figcaption></figure><h4 id="ä¿å­˜é”€å”®å±æ€§" tabindex="-1"><a class="header-anchor" href="#ä¿å­˜é”€å”®å±æ€§" aria-hidden="true">#</a> ä¿å­˜é”€å”®å±æ€§</h4><blockquote><p><code>é”€å”®å±æ€§</code>å’Œ<code>è§„æ ¼å‚æ•°</code>ç”¨çš„æ˜¯<code>åŒä¸€ä¸ªä¿å­˜æ–¹æ³•</code>ï¼Œé”€å”®å±æ€§è¿›è¡Œä¿å­˜æ—¶ï¼Œä¼šå¯¹å…³è”è¡¨è¿›è¡Œä¸€ä¸ªçº§è”ä¿å­˜ï¼Œä½†é”€å”®å±æ€§ä¸éœ€è¦</p><p>æ‰€ä»¥ä¹Ÿåœ¨å¯¹å…³è”è¡¨çº§è”ä¿å­˜çš„æ—¶å€™è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é”€å”®å±æ€§ä¿å­˜çš„æ—¶å€™æ‰è¿›è¡Œçº§è”ä¿å­˜ï¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getAttrType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span><span class="token constant">ATTR_TYPE_BASE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811105415725.png" alt="image-20220811105415725" tabindex="0" loading="lazy"><figcaption>image-20220811105415725</figcaption></figure><h3 id="åˆ†ç»„ä¸å±æ€§å…³è”" tabindex="-1"><a class="header-anchor" href="#åˆ†ç»„ä¸å±æ€§å…³è”" aria-hidden="true">#</a> åˆ†ç»„ä¸å±æ€§å…³è”</h3><h4 id="æ˜¾ç¤ºå±æ€§" tabindex="-1"><a class="header-anchor" href="#æ˜¾ç¤ºå±æ€§" aria-hidden="true">#</a> æ˜¾ç¤ºå±æ€§</h4><blockquote><p>è¿™é‡Œå…¶å®å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒæŸ¥è¯¢ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç‚¹å‡»åˆ†ç»„å±æ€§çš„æ—¶å€™è·å–åˆ°åˆ†ç»„idï¼Œ</li><li>æ‹¿åˆ†ç»„idå»å…³è”è¡¨æŸ¥åˆ†ç»„idå¯¹åº”çš„attr_id</li><li>æ‹¿<code>attr_id</code>å»pms_attrè¡¨ä¸­è·å–å±æ€§</li></ol></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220808231237643.png" alt="image-20220808231237643" tabindex="0" loading="lazy"><figcaption>image-20220808231237643</figcaption></figure><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 3.è·å–å±æ€§åˆ†ç»„çš„å…³è”çš„æ‰€æœ‰å±æ€§
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{attrgroupId}/attr/relation&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">attrRelation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrgroupId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> attrgroupId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> entities <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getRelationAttr</span><span class="token punctuation">(</span>attrgroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRelationAttr</span><span class="token punctuation">(</span><span class="token class-name">Long</span> attrgroupId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//åˆ†å¸ƒæŸ¥è¯¢ï¼Œç¬¬ä¸€æ­¥å»å…³è”è¡¨ä¸­æŸ¥å‡ºæ‰€æœ‰çš„ç»„å’Œå±æ€§id</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span> entities <span class="token operator">=</span> relationService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_group_id&quot;</span><span class="token punctuation">,</span>attrgroupId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//ç¬¬äºŒæ”¶é›†å±æ€§id</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> attrIds <span class="token operator">=</span> entities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listByIds</span><span class="token punctuation">(</span>attrIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><p>å±æ€§æ˜¾ç¤ºæˆåŠŸ</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811124827549.png" alt="image-20220811124827549" tabindex="0" loading="lazy"><figcaption>image-20220811124827549</figcaption></figure><h4 id="ç§»é™¤å±æ€§" tabindex="-1"><a class="header-anchor" href="#ç§»é™¤å±æ€§" aria-hidden="true">#</a> ç§»é™¤å±æ€§</h4><blockquote><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥å†™ä¸€ä¸ªæ‰¹é‡åˆ é™¤çš„æ¥å£</p></blockquote><p><strong>controller</strong></p><ul><li>/product/attrgroup/attr/relation/delete</li><li>postè¯·æ±‚ä¼šå¸¦æ¥jsonæ•°æ®ï¼Œè¦å°è£…æˆè‡ªå®šä¹‰å¯¹è±¡voséœ€è¦@RequestBodyæ³¨è§£</li><li>æ„æ€å°±æ˜¯å°†è¯·æ±‚ä½“ä¸­çš„æ•°æ®å°è£…æˆvos</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 4.ç§»é™¤å±æ€§åˆ†ç»„å’Œå±æ€§çš„å…³ç³»
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/attr/relation/delete&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">deleteRelation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">AttrGroupRelationVo</span><span class="token punctuation">[</span><span class="token punctuation">]</span> vos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    attrService<span class="token punctuation">.</span><span class="token function">deleteRelation</span><span class="token punctuation">(</span>vos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteRelation</span><span class="token punctuation">(</span><span class="token class-name">AttrGroupRelationVo</span><span class="token punctuation">[</span><span class="token punctuation">]</span> vos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span> entities <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>vos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">AttrAttrgroupRelationEntity</span> entity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    relation<span class="token punctuation">.</span><span class="token function">deleteBatchRelation</span><span class="token punctuation">(</span>entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>mapper</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>void deleteBatchRelation(@Param(&quot;entities&quot;) List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span> entities);

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>deleteBatchRelation<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        DELETE FROM `pms_attr_attrgroup_relation` where
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>entities<span class="token punctuation">&quot;</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>OR<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            (attr_id = #{item.attrId} AND attr_group_id = #{item.attrGroupId})
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æŸ¥è¯¢åˆ†ç»„æœªå…³è”çš„å±æ€§" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢åˆ†ç»„æœªå…³è”çš„å±æ€§" aria-hidden="true">#</a> æŸ¥è¯¢åˆ†ç»„æœªå…³è”çš„å±æ€§</h4><p><strong>é€»è¾‘åˆ†æ</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811172114595.png" alt="image-20220811172114595" tabindex="0" loading="lazy"><figcaption>image-20220811172114595</figcaption></figure><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 5.è·å–å±æ€§åˆ†ç»„æ²¡æœ‰å…³è”çš„æ‰€æœ‰å±æ€§
 * /product/attrgroup/<span class="token punctuation">{</span>attrgroupId<span class="token punctuation">}</span>/noattr/relation
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{attrgroupId}/noattr/relation&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">attrNoRelation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrgroupId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> attrgroupId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getNoRelationAttr</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span>attrgroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><blockquote><p>è®¤çœŸçœ‹æ³¨é‡Šï¼Œè®¤çœŸç†è§£ï¼Œè¿˜æ˜¯å¾ˆç»•çš„</p><p>æŸ¥è¯¢åˆ†ç»„æœªå…³è”çš„æ•°æ®ä¸‰æ­¥ï¼</p><ol><li>è·å¾—å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰åˆ†ç»„</li><li>è·å¾—è¿™äº›åˆ†ç»„ä¸‹æ‰€æœ‰å·²æ·»åŠ çš„å±æ€§</li><li>æ·»åŠ æ–°å±æ€§æ—¶ç§»é™¤è¿™äº›å·²æ·»åŠ çš„å±æ€§</li></ol></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">getNoRelationAttr</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">Long</span> attrgroupId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     *  1.å½“å‰åˆ†ç»„åªèƒ½å…³è”è‡ªå·±æ‰€å±çš„åˆ†ç±»é‡Œé¢çš„æ‰€æœ‰å±æ€§
     */</span>
    <span class="token class-name">AttrGroupEntity</span> attrGroupEntity <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attrgroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> catelogId <span class="token operator">=</span> attrGroupEntity<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     *  2 .å½“å‰åˆ†ç»„åªèƒ½å¼•ç”¨åˆ«çš„åˆ†ç»„æ²¡æœ‰å¼•ç”¨çš„å±æ€§
     *  2.1 å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰åˆ†ç»„
     *  2.2 è¿™äº›åˆ†ç»„å…³è”çš„å±æ€§
     *  2.3 ä»å½“å‰åˆ†ç±»çš„æ‰€æœ‰å±æ€§ä¸­ç§»é™¤è¿™äº›å±æ€§
     */</span>

    <span class="token doc-comment comment">/**
     * 2.1 å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰åˆ†ç»„ã€‚æ”¶é›†åˆ°ä»–ä»¬çš„ç»„id
     */</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> group <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> collectGroupIds <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     *  2.2 æ”¶é›†åˆ°åˆ†ç»„çš„æ‰€æœ‰å±æ€§
     *  ï¼ˆ1ï¼‰æ‹¿ç€ä¸Šä¸€æ­¥æ”¶é›†åˆ°çš„ç»„idåˆ°å…³ç³»è¡¨ä¸­æŸ¥æ‰¾å…³ç³»è¡¨å®ä½“ç±»å¯¹è±¡ï¼Œ
     *  ï¼ˆ2ï¼‰é€šè¿‡å…³ç³»è¡¨å®ä½“ç±»å¯¹è±¡è·å¾—æ‰€æœ‰åˆ†ç»„ä¸‹çš„æ‰€æœ‰å±æ€§id
     */</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span> groupId <span class="token operator">=</span> relationService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token string">&quot;attr_group_id&quot;</span><span class="token punctuation">,</span> collectGroupIds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> attrIds <span class="token operator">=</span> groupId<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 2.3 ä»å½“å‰åˆ†ç±»çš„æ‰€æœ‰å±æ€§ä¸­ç§»é™¤è¿™äº›å±æ€§å¹¶ç­›é€‰å‡ºåŸºæœ¬å±æ€§ï¼ˆwhere attr_type = 1ï¼‰
     */</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_type&quot;</span><span class="token punctuation">,</span><span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span><span class="token constant">ATTR_TYPE_BASE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¦‚æœå…¶ä»–åˆ†ç»„ä¹Ÿæ²¡å…³è”å±æ€§ï¼Œé‚£ä¹ˆå°±ä¸åŠ è¿™ä¸ªæ¡ä»¶</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>attrIds <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> attrIds<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">notIn</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attrIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åˆ†é¡µå¤šæ¡ä»¶æŸ¥è¯¢
     * where (`attr_id` = ? or `attr_name` like ?)
     */</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * pageæ–¹æ³•éœ€è¦ä¸¤ä¸ªå‚æ•°
     * 1.IPageå¯¹è±¡ï¼ˆé€šè¿‡å·¥å…·ç±»Queryè·å–å¹¶é€šè¿‡.getPage(params)å°è£…é¡µé¢ä¼ æ¥åˆ†é¡µå‚æ•°ï¼‰
     * 2.wrapperï¼ˆè‡ªå·±ç”Ÿæˆï¼‰
     */</span>
    <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span> wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PageUtils</span> pageUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pageUtils<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>tipsï¼š</code></p><p>æ³¨æ„éç©ºåˆ¤æ–­</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811173223505.png" alt="image-20220811173223505" tabindex="0" loading="lazy"><figcaption>image-20220811173223505</figcaption></figure><p><strong>æµ‹è¯•</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811183248352.png" alt="image-20220811183248352" tabindex="0" loading="lazy"><figcaption>image-20220811183248352</figcaption></figure><p>ç»™é”€å”®å±æ€§ç»‘å®šåˆ†ç»„ï¼ŒæŠŠ9å·å±æ€§ç»‘å®šç»™1å·åˆ†ç»„</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811183459861.png" alt="image-20220811183459861" tabindex="0" loading="lazy"><figcaption>image-20220811183459861</figcaption></figure><p>æŸ¥è¯¢åˆ†ç»„æœªå…³è”çš„å±æ€§</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811183601207.png" alt="image-20220811183601207" tabindex="0" loading="lazy"><figcaption>image-20220811183601207</figcaption></figure><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220811183612731.png" alt="image-20220811183612731" tabindex="0" loading="lazy"><figcaption>image-20220811183612731</figcaption></figure><h4 id="æ·»åŠ å±æ€§å…³è”" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ å±æ€§å…³è”" aria-hidden="true">#</a> æ·»åŠ å±æ€§å…³è”</h4><blockquote><p>å¸¸è§„çš„è°ƒç”¨ï¼Œæ³¨æ„ç‚¹æ˜¯saveBatchä¼ çš„å‚æ•°æ˜¯æ•°æ®å¯¹åº”çš„å®ä½“ç±»</p><p>æˆ‘ä»¬æƒ³ä¼ å…¶ä»–<code>vo</code>æ—¶ï¼Œéœ€è¦å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œä¸€ä¸ª<code>é‡å†™</code></p><p>æœ€åä¹Ÿæ˜¯é€šè¿‡æŠŠvoçš„å€¼èµ‹ç»™å¯¹åº”å®ä½“ç±»ï¼Œåœ¨è°ƒç”¨ç›¸åº”æ‰¹é‡ä¿å­˜</p></blockquote><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 6.æ·»åŠ å±æ€§ä¸åˆ†ç»„å…³è”å…³ç³»
 * /product/attrgroup/attr/relation
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/attr/relation&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">addRelation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupRelationVo</span><span class="token punctuation">&gt;</span></span> vos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    relationService<span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>vos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveBatch</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupRelationVo</span><span class="token punctuation">&gt;</span></span> vos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> vos<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">AttrAttrgroupRelationEntity</span> relationEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> relationEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> relationEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å‘å¸ƒå•†å“" tabindex="-1"><a class="header-anchor" href="#å‘å¸ƒå•†å“" aria-hidden="true">#</a> å‘å¸ƒå•†å“</h3><h4 id="è°ƒè¯•ä¼šå‘˜ç­‰çº§æ¥å£" tabindex="-1"><a class="header-anchor" href="#è°ƒè¯•ä¼šå‘˜ç­‰çº§æ¥å£" aria-hidden="true">#</a> è°ƒè¯•ä¼šå‘˜ç­‰çº§æ¥å£</h4><p>å¯åŠ¨ä¼šå‘˜å¾®æœåŠ¡ï¼Œæ·»åŠ ç½‘å…³ï¼Œæ·»åŠ å‰ç«¯é¡µé¢...</p><p>æ·»åŠ å¦‚ä¸‹ä¼šå‘˜ï¼š</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812111110133.png" alt="image-20220812111110133" tabindex="0" loading="lazy"><figcaption>image-20220812111110133</figcaption></figure><h4 id="è·å–åˆ†ç±»å…³è”çš„å“ç‰Œ" tabindex="-1"><a class="header-anchor" href="#è·å–åˆ†ç±»å…³è”çš„å“ç‰Œ" aria-hidden="true">#</a> è·å–åˆ†ç±»å…³è”çš„å“ç‰Œ</h4><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 1.è·å–åˆ†ç±»å…³è”çš„å“ç‰Œ
 * /product/categorybrandrelation/brands/list
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/brands/list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">relationBrandList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;catId&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> catId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandEntity</span><span class="token punctuation">&gt;</span></span> vos <span class="token operator">=</span> categoryBrandRelationService<span class="token punctuation">.</span><span class="token function">getBrandsByCatId</span><span class="token punctuation">(</span>catId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å“ç‰Œå¯¹è±¡é›†åˆåœ¨è¿›è¡Œç­›é€‰ï¼Œèµ‹äºˆå“ç‰Œå¯¹è±¡idå’Œnameï¼Œè¿”å›å°è£…çš„voç»™å‰ç«¯</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandVo</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> vos<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">BrandVo</span> brandVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrandVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        brandVo<span class="token punctuation">.</span><span class="token function">setBrandId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        brandVo<span class="token punctuation">.</span><span class="token function">setBrandName</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> brandVo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBrandsByCatId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> catId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è·å¾—CategoryBrandRelationEntityé›†åˆå¯¹è±¡</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBrandRelationEntity</span><span class="token punctuation">&gt;</span></span> catelogId <span class="token operator">=</span> relationDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBrandRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è·å¾—æ‰€æœ‰é›†åˆå¯¹è±¡ä¸­brandidï¼Œé€šè¿‡brandServiceæŸ¥è¯¢æ‰€æœ‰å“ç‰Œï¼Œå°è£…æˆå“ç‰Œå¯¹è±¡é›†åˆ</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> catelogId<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">Long</span> brandId <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BrandEntity</span> entity <span class="token operator">=</span> brandService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è¿”å›å“ç‰Œå¯¹è±¡é›†åˆ</span>
    <span class="token keyword">return</span> collect<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><blockquote><p>å¼€å‘è§„èŒƒ</p><ol><li>Controller:å¤„ç†è¯·æ±‚,æ¥å—å’Œæ ¡éªŒæ•°æ®</li><li>Serviceæ¥å—controlLerä¼ æ¥çš„æ•°æ®,è¿›è¡Œä¸šåŠ¡å¤„ç†</li><li>Controlleræ¥å—serviceå¤„ç†å®Œçš„æ•°æ®,å°è£…é¡µé¢æŒ‡å®šçš„vo</li></ol></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812115152211.png" alt="image-20220812115152211" tabindex="0" loading="lazy"><figcaption>image-20220812115152211</figcaption></figure><h4 id="è·å–åˆ†ç±»ä¸‹æ‰€æœ‰åˆ†ç»„-å…³è”å±æ€§" tabindex="-1"><a class="header-anchor" href="#è·å–åˆ†ç±»ä¸‹æ‰€æœ‰åˆ†ç»„-å…³è”å±æ€§" aria-hidden="true">#</a> è·å–åˆ†ç±»ä¸‹æ‰€æœ‰åˆ†ç»„&amp;å…³è”å±æ€§</h4><p><strong>æ¥å£åŠŸèƒ½å¦‚ä¸‹</strong></p><p>ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬é€‰æ‹©æ‰‹æœºåˆ†ç±»æ—¶ï¼Œé‚£å°±æŸ¥å‡ºæ‰‹æœºç›¸å…³çš„åˆ†ç»„ä¿¡æ¯ï¼Œå¹¶æŸ¥å‡ºæ¯ä¸ªåˆ†ç»„ç›¸åº”å±æ€§ä¿¡æ¯</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812180531794.png" alt="image-20220812180531794" tabindex="0" loading="lazy"><figcaption>image-20220812180531794</figcaption></figure><p><strong>vo</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AttrGroupWithAttrsVo</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * åˆ†ç»„id
     */</span>
    <span class="token annotation punctuation">@TableId</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> attrGroupId<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * ç»„å
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> attrGroupName<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * æ’åº
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> sort<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * æè¿°
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> descript<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * ç»„å›¾æ ‡
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> icon<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * æ‰€å±åˆ†ç±»id
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> attrs<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 7.è·å–åˆ†ç±»ä¸‹æ‰€æœ‰åˆ†ç»„&amp;å…³è”å±æ€§
 * /product/attrgroup/<span class="token punctuation">{</span>catelogId<span class="token punctuation">}</span>/withattr
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{catelogId}/withattr&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getAttrGroupWithAttrs</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupWithAttrsVo</span><span class="token punctuation">&gt;</span></span> vos <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getAttrGroupWithAttrsByCatelogId</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span>vos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><blockquote><p>voçš„é‡è¦æ€§ï¼š</p><ol><li>voï¼ˆvalue objectï¼‰å½“ç›¸åº”æ•°æ®éœ€è¦è‡ªå®šä¹‰æ—¶ï¼Œç”¨voæ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œä¸éœ€è¦å¯¹å®ä½“ç±»å­—æ®µè¿›è¡Œä¿®æ”¹</li></ol></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812181322056.png" alt="image-20220812181322056" tabindex="0" loading="lazy"><figcaption>image-20220812181322056</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * è·å–åˆ†ç±»ä¸‹çš„æ‰€æœ‰åˆ†ç»„åŠå±æ€§
     * <span class="token keyword">@param</span> <span class="token parameter">catelogId</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupWithAttrsVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAttrGroupWithAttrsByCatelogId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/** 1.è·å–åˆ†ç±»ä¸‹çš„æ‰€æœ‰åˆ†ç»„,å°è£…æˆé›†åˆ
         *  åˆ†ç±»å’Œç»„çš„å…³ç³»åœ¨pms_groupè¡¨ä¸­ï¼Œæ‰€ä»¥ï¼ˆwhere catelog_id = ï¼Ÿï¼‰å³å¯æŸ¥å‡ºåˆ†ç±»å¯¹åº”çš„ç»„
         *  ç”±äºè¿™æ˜¯mpï¼Œå®ƒä¼šå¾—å‡ºæ‰€æœ‰çš„è¿™ç§å…³ç³»ï¼Œå¹¶æŠŠç»“æœå°è£…æˆé›†åˆ
         */</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/** 2.è·å¾—åˆ†ç»„ä¸‹çš„å±æ€§
         *  è¦ç¬¬ä¸‰å¼ å…³è”è¡¨,ç›´æ¥è°ƒç”¨å…³è”è¡¨çš„serviceå³æŸ¥è¯¢åˆ†ç»„å¯¹åº”çš„å±æ€§id
         *  è·å¾—å±æ€§idåœ¨å»è°ƒç”¨å±æ€§è¡¨çš„serviceå³å¯æŸ¥è¯¢å±æ€§å
         *  ä»¥ä¸Šä¸¤æ­¥å‰é¢å·²ç»å†™å¥½é€»è¾‘äº†ç›´æ¥è°ƒç”¨å³å¯attrService.getRelationAttrï¼ˆgroupIdï¼‰
         */</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupWithAttrsVo</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">AttrGroupWithAttrsVo</span> attrGroupWithAttrsVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrGroupWithAttrsVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> attrGroupWithAttrsVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> attrs <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getRelationAttr</span><span class="token punctuation">(</span>attrGroupWithAttrsVo<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>attrs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                attrGroupWithAttrsVo<span class="token punctuation">.</span><span class="token function">setAttrs</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> attrGroupWithAttrsVo<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attrvo<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> attrvo<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> attrvo<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> collect<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812180358798.png" alt="image-20220812180358798" tabindex="0" loading="lazy"><figcaption>image-20220812180358798</figcaption></figure><h4 id="å•†å“æ–°å¢voæŠ½å–" tabindex="-1"><a class="header-anchor" href="#å•†å“æ–°å¢voæŠ½å–" aria-hidden="true">#</a> å•†å“æ–°å¢voæŠ½å–</h4><p>è®¾ç½®å®Œå±æ€§ï¼Œç‚¹å‡»ä¿å­˜ä¹‹åå–æ¶ˆä¿å­˜ï¼Œå¤åˆ¶æ§åˆ¶å°è¾“å‡º</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812210242531.png" alt="image-20220812210242531" tabindex="0" loading="lazy"><figcaption>image-20220812210242531</figcaption></figure><p><code>[åœ¨çº¿JSONå­—ç¬¦ä¸²è½¬Javaå®ä½“ç±»(JavaBeanã€Entity)-BeJSON.com](https://www.bejson.com/json2javapojo/new/)</code></p><p><strong>ç›´æ¥è§£æjsonæ•°æ®å°è£…æˆå®ä½“ç±»</strong></p><blockquote><p>è¿™é‡Œæˆ‘ç®€å•æˆªå–ä¸€ä¸ªä¸»è¦çš„Vo</p><p>æ­¤VoåŒ…æ‹¬æ¯ä¸ªæ­¥éª¤æ‰€æºå¸¦çš„æ•°æ®ï¼Œæœ‰çš„æ˜¯å•ä¸ªå­—æ®µæœ‰çš„æ˜¯ä¸€ä¸ªé›†åˆ</p><p>é€»è¾‘ä¸éš¾ï¼Œéš¾ç‚¹æ˜¯è¦ç†æ¸…é€»è¾‘ï¼Œæ³¨æ„ç»†èŠ‚ï¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuSaveVo</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> spuName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> spuDescription<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> catalogId<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> brandId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> weight<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> publishStatus<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> decript<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> images<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Bounds</span> bounds<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BaseAttrs</span><span class="token punctuation">&gt;</span></span> baseAttrs<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Skus</span><span class="token punctuation">&gt;</span></span> skus<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å•†å“æ–°å¢ä¸šåŠ¡æµç¨‹åˆ†æ" tabindex="-1"><a class="header-anchor" href="#å•†å“æ–°å¢ä¸šåŠ¡æµç¨‹åˆ†æ" aria-hidden="true">#</a> å•†å“æ–°å¢ä¸šåŠ¡æµç¨‹åˆ†æ</h4><blockquote><p>é€»è¾‘å¾ˆç®€å•é‚£ï¼Œå°±æ˜¯æŠŠ<code>æ•°æ®</code>ä¿å­˜åˆ°<code>å¤šå¼ è¡¨</code>ä¸­</p><p>å› ä¸ºè¿™ä¸ª<code>Vo</code>æ”¶é›†çš„æ•°æ®å¾ˆå¤šï¼ŒåŒ…æ‹¬æ¯ä¸ªæ­¥éª¤ä½ æ‰€é€‰æ‹©çš„æ•°æ®</p></blockquote><p><strong>1.ä¿å­˜spuåŸºæœ¬ä¿¡æ¯ pms_spu_info</strong></p><p>å› ä¸ºæ‰€æœ‰ä¼ æ¥çš„ä¿¡æ¯éƒ½åœ¨voé‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠä¿¡æ¯æ‹·è´åˆ°å¯¹åº”çš„å®ä½“ç±»ä¸­ï¼Œå¦‚æœvoæ²¡æœ‰çš„é‚£å°±å¯ä»¥è‡ªå·±èµ‹å€¼</p><p>è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220813192926303.png" alt="image-20220813192926303" tabindex="0" loading="lazy"><figcaption>image-20220813192926303</figcaption></figure><p>è¿™é‡Œçš„infoEntity.setCreateTime(new Date());infoEntity.setUpdateTime(new Date());æ˜¯å› ä¸ºå‰ç«¯ä¼ å…¥çš„æ˜¯æ²¡æœ‰è¿™ä¸¤ä¸ªå­—æ®µçš„ï¼Œæˆ‘ä»¬è‡ªå·±èµ‹å€¼å³å¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SpuInfoEntity</span> infoEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpuInfoEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>vo<span class="token punctuation">,</span> infoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
infoEntity<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
infoEntity<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveBaseInfo</span><span class="token punctuation">(</span>infoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.ä¿å­˜spuçš„æè¿°å›¾ç‰‡ pms_spu_info_desc</strong> ä¿å­˜å“ªä¸ªæ•°æ®åˆ°å“ªä¸ªè¡¨ï¼Œå°±æ³¨å…¥é‚£ä¸ªservice</p><p>String.join()çš„ä½œç”¨æ˜¯æŠŠé›†åˆä¸­çš„å…ƒç´ é€šè¿‡&quot;,&quot;åˆ†å‰²å½¢æˆä¸€ä¸ªä¸€ä¸ªçš„å­—ç¬¦ä¸²</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> decript <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getDecript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SpuInfoDescEntity</span> descEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpuInfoDescEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
descEntity<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>infoEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
descEntity<span class="token punctuation">.</span><span class="token function">setDecript</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> decript<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
spuInfoDescService<span class="token punctuation">.</span><span class="token function">saveSpuInfoDesc</span><span class="token punctuation">(</span>descEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3.ä¿å­˜spuçš„å›¾ç‰‡é›† pms_spu_images</strong> ä»voä¸­è·å–æ‰€æœ‰å›¾ç‰‡é›†åˆ è°ƒç”¨å›¾ç‰‡serviceè¿›è¡Œä¿å­˜ï¼Œä¿å­˜åªéœ€è¦ä¸¤ä¸ªç‚¹ å›¾ç‰‡idå’Œurlåœ°å€ï¼Œä¼ å…¥å¯¹è±¡å³å¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> images <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
imagesService<span class="token punctuation">.</span><span class="token function">saveImages</span><span class="token punctuation">(</span>infoEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> images<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4.ä¿å­˜spuçš„è§„æ ¼å‚æ•° pms_product_attr_value</strong> ä»voä¸­è·å–æ‰€æœ‰è§„æ ¼å‚æ•°é›†åˆ å¯¹è§„æ ¼å‚æ•°é›†åˆè¿›è¡Œéå†ï¼Œè®¾ç½®æ¯é¡¹çš„å±æ€§</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BaseAttrs</span><span class="token punctuation">&gt;</span></span> baseAttrs <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getBaseAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> baseAttrs<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">ProductAttrValueEntity</span> valueEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    valueEntity<span class="token punctuation">.</span><span class="token function">setAttrId</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AttrEntity</span> id <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    valueEntity<span class="token punctuation">.</span><span class="token function">setAttrName</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">getAttrName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    valueEntity<span class="token punctuation">.</span><span class="token function">setAttrValue</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    valueEntity<span class="token punctuation">.</span><span class="token function">setQuickShow</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getShowDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    valueEntity<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>infoEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> valueEntity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
attrValueService<span class="token punctuation">.</span><span class="token function">saveProductAttr</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5.ä¿å­˜spuçš„ç§¯åˆ†ä¿¡æ¯ mall_sms -&gt; sms_spu_bounds</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Bounds</span> bounds <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SpuBoundTo</span> spuBoundTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpuBoundTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>bounds<span class="token punctuation">,</span> spuBoundTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
spuBoundTo<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>infoEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">R</span> r0 <span class="token operator">=</span> couponFeignService<span class="token punctuation">.</span><span class="token function">saveSpuBounds</span><span class="token punctuation">(</span>spuBoundTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>r0<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è¿œç¨‹ä¿å­˜spuç§¯åˆ†ä¿¡æ¯å¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
couponFeignService<span class="token punctuation">.</span><span class="token function">saveSpuBounds</span><span class="token punctuation">(</span>spuBoundTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>6.ä¿å­˜å½“å‰spuå¯¹åº”çš„æ‰€æœ‰skuä¿¡æ¯ï¼›</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//6.1skuçš„åŸºæœ¬ä¿¡æ¯;pms_sku_info</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Skus</span><span class="token punctuation">&gt;</span></span> skus <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getSkus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>skus <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> skus<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    skus<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> defalutImg <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Images</span> image <span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token function">getImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">getDefaultImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                defalutImg <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">getImgUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">SkuInfoEntity</span> skuInfoEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuInfoEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> skuInfoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ·»åŠ voä¸­æ²¡æœ‰çš„ä¿¡æ¯</span>
        skuInfoEntity<span class="token punctuation">.</span><span class="token function">setBrandId</span><span class="token punctuation">(</span>infoEntity<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuInfoEntity<span class="token punctuation">.</span><span class="token function">setCatalogId</span><span class="token punctuation">(</span>infoEntity<span class="token punctuation">.</span><span class="token function">getCatalogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuInfoEntity<span class="token punctuation">.</span><span class="token function">setSaleCount</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuInfoEntity<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>infoEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuInfoEntity<span class="token punctuation">.</span><span class="token function">setSkuDefaultImg</span><span class="token punctuation">(</span>defalutImg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuInfoService<span class="token punctuation">.</span><span class="token function">saveSkuInfo</span><span class="token punctuation">(</span>skuInfoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//6.2skuå›¾ç‰‡ä¿¡æ¯;pms_sku_images</span>
        <span class="token comment">//æ²¡æœ‰å›¾ç‰‡è·¯å¾„çš„æ— éœ€ä¿å­˜</span>
        <span class="token class-name">Long</span> skuId <span class="token operator">=</span> skuInfoEntity<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> imageEntities <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>img <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">SkuImagesEntity</span> skuImagesEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuImagesEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            skuImagesEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuImagesEntity<span class="token punctuation">.</span><span class="token function">setImgUrl</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">getImgUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuImagesEntity<span class="token punctuation">.</span><span class="token function">setDefaultImg</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">getDefaultImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> skuImagesEntity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>entity <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getImgUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuImagesService<span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>imageEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//6.3skuçš„é”€å”®å±æ€§;pms_sku_sale_attr_value</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Attr</span><span class="token punctuation">&gt;</span></span> attr <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuSaleAttrValueEntity</span><span class="token punctuation">&gt;</span></span> skuSaleAttrValueEntities <span class="token operator">=</span> attr<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>a <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">SkuSaleAttrValueEntity</span> attrValueEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuSaleAttrValueEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> attrValueEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            attrValueEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> attrValueEntity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuSaleAttrValueService<span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>skuSaleAttrValueEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//6.4skuçš„ä¼˜æƒ æ»¡å‡ä¿¡æ¯(è·¨æœåŠ¡);</span>
        <span class="token class-name">SkuReductionTo</span> skuReductionTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuReductionTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> skuReductionTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuReductionTo<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">.</span><span class="token function">getFullCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> skuReductionTo<span class="token punctuation">.</span><span class="token function">getFullPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">R</span> r1 <span class="token operator">=</span> couponFeignService<span class="token punctuation">.</span><span class="token function">saveSkuReduction</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>r1<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è¿œç¨‹ä¿å­˜spuç§¯åˆ†ä¿¡æ¯å¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220813191901500.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="æ£€ç´¢åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#æ£€ç´¢åŠŸèƒ½" aria-hidden="true">#</a> æ£€ç´¢åŠŸèƒ½</h4><p>ä¹Ÿå°±æ˜¯å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢ï¼Œå¾ˆå¸¸è§çš„åŠŸèƒ½ï¼</p><p><mark>spuæ£€ç´¢</mark></p><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * åˆ—è¡¨
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> spuInfoService<span class="token punctuation">.</span><span class="token function">queryPageByCondition</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPageByCondition</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuInfoEntity</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//ç­‰ä»·sql: status=1 and (id=1 or spu_name like xxx)</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;spu_name&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> status <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;publish_status&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> brandId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;brand_id&quot;</span><span class="token punctuation">,</span> brandId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> catelogId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuInfoEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuInfoEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            queryWrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><mark>skuæ£€ç´¢</mark></p><p><strong>controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * åˆ—è¡¨
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> skuInfoService<span class="token punctuation">.</span><span class="token function">queryPageByParams</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>service</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPageByParams</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;sku_id&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;sku_name&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> catelogId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> brandId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;brand_id&quot;</span><span class="token punctuation">,</span> brandId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> max <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">BigDecimal</span> bigDecimal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bigDecimal<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                queryWrapper<span class="token punctuation">.</span><span class="token function">le</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> min <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;min&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">ge</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            queryWrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä»“åº“æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#ä»“åº“æœåŠ¡" aria-hidden="true">#</a> ä»“åº“æœåŠ¡</h3><h4 id="æ•´åˆwareæœåŠ¡-è·å–ä»“åº“åˆ—è¡¨" tabindex="-1"><a class="header-anchor" href="#æ•´åˆwareæœåŠ¡-è·å–ä»“åº“åˆ—è¡¨" aria-hidden="true">#</a> æ•´åˆwareæœåŠ¡&amp;è·å–ä»“åº“åˆ—è¡¨</h4><ol><li>åŠ å…¥å¾®æœåŠ¡æ³¨å†Œä¸­å¿ƒ</li><li>åŠ å…¥ç½‘å…³</li></ol><p>è·å–ä»“åº“åˆ—è¡¨å°±æ˜¯å¯¹ä»“åº“è¡¨çš„ç®€å•æŸ¥è¯¢ï¼Œé€†å‘ç”Ÿæˆä»£ç ä»¥å¸®æˆ‘ä»¬ç”Ÿæˆå¥½ï¼Œåªè¦é…ç½®å¥½ç½‘å…³å°±å¯ä»¥ç›´æ¥æ˜¾ç¤º</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220906101248116.png" alt="image-20220906101248116" tabindex="0" loading="lazy"><figcaption>image-20220906101248116</figcaption></figure><p>æˆ‘ä»¬åªè¦è®°ä½ï¼Œ<strong>åæ˜¯å•è¡¨æ“ä½œçš„é€†å‘ç”Ÿæˆä»¥å¸®æˆ‘ä»¬ç”Ÿæˆå¥½äº†ï¼Œæˆ‘ä»¬èƒ½æ‹¿æ¥ç›´æ¥ç”¨</strong>ï¼Œå°±åƒå¢åŠ ä»“åº“ã€åˆ é™¤ã€ä¿®æ”¹éƒ½æ˜¯å¯ä»¥ç›´æ¥ç”¨çš„ï¼</p><blockquote><p>å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareInfoEntity</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;areacode&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareInfoEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareInfoEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            queryWrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¤šæ¡ä»¶æŸ¥è¯¢éƒ½æ˜¯ä¸€æ ·çš„å¥—è·¯ï¼Œè·å¾—ä½ æœç´¢çš„keyï¼Œç„¶åæ‹¿è¿™ä¸ªkeyå»æ¨¡ç³ŠåŒ¹é…å¤šä¸ªå­—æ®µ</p><p>æ¯”å¦‚è¿™é‡Œæ‹¿ä½ è¾“å…¥çš„keyä¼šåœ¨nameã€addressã€areacodeåšæ¨¡ç³ŠæŸ¥è¯¢ï¼Œæ¡ä»¶ç›´æ¥é€šè¿‡oræ¥æ‹¼æ¥</p><h4 id="æŸ¥è¯¢åº“å­˜-åˆ›å»ºé‡‡è´­éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢åº“å­˜-åˆ›å»ºé‡‡è´­éœ€æ±‚" aria-hidden="true">#</a> æŸ¥è¯¢åº“å­˜&amp;åˆ›å»ºé‡‡è´­éœ€æ±‚</h4><blockquote><p><strong>æŸ¥è¯¢åº“å­˜</strong></p></blockquote><p>æŸ¥è¯¢åº“å­˜ä¹Ÿæ˜¯å•è¡¨æ“ä½œï¼ŒCRUDéƒ½å¸®æˆ‘ä»¬åšå¥½äº†ï¼Œæˆ‘ä»¬å°±åœ¨åˆ†é¡µçš„åŸºç¡€ä¸ŠåŠ ä¸Šå¤šæ¡ä»¶æŸ¥è¯¢å³å¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> skuId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;sku_id&quot;</span><span class="token punctuation">,</span> skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> wareId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;wareId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>wareId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;ware_id&quot;</span><span class="token punctuation">,</span> wareId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            queryWrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>åˆ›å»ºé‡‡è´­éœ€æ±‚</strong></p></blockquote><p>åŒä¸Šéƒ½æ˜¯å•è¡¨æ“ä½œï¼Œæˆ‘ä»¬åªéœ€è¦åšé‡‡è´­éœ€æ±‚çš„å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>w<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;purchase_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;sku_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> status <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> wareId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;wareId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>wareId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;ware_id&quot;</span><span class="token punctuation">,</span>wareId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            queryWrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åˆå¹¶é‡‡è´­éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#åˆå¹¶é‡‡è´­éœ€æ±‚" aria-hidden="true">#</a> åˆå¹¶é‡‡è´­éœ€æ±‚</h4><p>åˆå¹¶é€»è¾‘ï¼š</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220906105205032.png" alt="image-20220906105205032" tabindex="0" loading="lazy"><figcaption>image-20220906105205032</figcaption></figure><p><strong>1.åˆ›å»ºé‡‡è´­å•</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220906105356726.png" alt="image-20220906105356726" tabindex="0" loading="lazy"><figcaption>image-20220906105356726</figcaption></figure><p><strong>2.åˆå¹¶è¯·æ±‚æ¥å£</strong></p><p>è¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µå¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœæ²¡æœ‰é€‰ä¸­é‡‡è´­å•ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨åˆ›å»ºé‡‡è´­å•è¿›è¡Œåˆå¹¶</li><li>æœ‰çš„è¯ï¼Œå°±ç”¨é‡‡è´­å•id</li></ul><blockquote><p>controller</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * åˆå¹¶é‡‡è´­å•
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/merge&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">MergeVo</span> mergeVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> flag <span class="token operator">=</span> purchaseService<span class="token punctuation">.</span><span class="token function">mergePurchase</span><span class="token punctuation">(</span>mergeVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è¯·é€‰æ‹©æ–°å»ºæˆ–å·²åˆ†é…çš„é‡‡è´­éœ€æ±‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">VO</span>å¦‚ä¸‹ï¼š
    
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MergeVo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> purchaseId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>impl</p></blockquote><p>å®é™…ä¸Šå°±æ˜¯åˆ›å»ºå®Œé‡‡è´­éœ€æ±‚å¯¹è±¡å’Œé‡‡è´­å•å¯¹è±¡åï¼Œç‚¹å‡»åˆå¹¶ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¿¡æ¯ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ•´ä½“å°±æ˜¯åšè¿™äº›æ“ä½œ</p><p>å…·ä½“çš„çœ‹æ³¨é‡Šï¼Œè¿™é‡Œè¿˜ç”¨åˆ°äº†ä¸€äº›æšä¸¾ç±»çš„å†™æ³•ï¼Œé€šè¿‡æšä¸¾ç±»è·å¾—çŠ¶æ€ä¿¡æ¯ï¼Œäº†è§£å³å¯ï¼Œè¿™é‡Œå°±ä¸å†™äº†ï¼Œå¯ä»¥å»çœ‹è€å¸ˆçš„æºç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">mergePurchase</span><span class="token punctuation">(</span><span class="token class-name">MergeVo</span> mergeVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ä¸€ã€è·å–Voä¸­çš„ä¿¡æ¯</span>
    <span class="token comment">//å¦‚æœæŒ‡å®šäº†é‡‡è´­å•ï¼Œé‚£å°±è·å–é‡‡è´­å•çš„id</span>
    <span class="token class-name">Long</span> purchaseId <span class="token operator">=</span> mergeVo<span class="token punctuation">.</span><span class="token function">getPurchaseId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è·å¾—é‡‡è´­éœ€æ±‚çš„id</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> mergeVo<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//äºŒã€è¿‡æ»¤é‡‡è´­éœ€æ±‚</span>
    <span class="token comment">//å¯¹é‡‡è´­éœ€æ±‚idè¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœé‡‡è´­éœ€æ±‚å¤„äºæ–°å»ºæˆ–è€…å·²åˆ†é…çš„æ”¶é›†æˆæ–°çš„é›†åˆ</span>
    <span class="token comment">//è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è¿›è¡Œç­›é€‰ï¼Œå¦‚æœä½ é€‰ä¸­æ­£åœ¨é‡‡è´­çš„æ˜¯ä¸ä¼šè¢«åˆå¹¶çš„</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">//é€šè¿‡é‡‡è´­éœ€æ±‚çš„idè·å–é‡‡è´­éœ€æ±‚å®ä½“ç±»</span>
                        <span class="token class-name">PurchaseDetailEntity</span> purchaseDetailEntity <span class="token operator">=</span> purchaseDetailService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span><span class="token constant">CREATED</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token operator">||</span> purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span><span class="token constant">ASSIGNED</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//ä¸‰ã€æ²¡æœ‰æŒ‡å®šé‡‡è´­å•é€»è¾‘å’ŒæŒ‡å®šäº†çš„é€»è¾‘</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>collect <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> collect<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//3.1å¦‚æœæ²¡æœ‰æŒ‡å®šé‡‡è´­å•ï¼Œé‚£å°±è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>purchaseId <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">PurchaseEntity</span> purchaseEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å¦‚æœæ˜¯æ–°åˆ›å»ºçš„é‡‡è´­å•ï¼Œåˆ›å»ºæ—¶é—´æ›´æ–°æ—¶é—´ï¼ŒçŠ¶æ€éƒ½æ˜¯æ²¡æœ‰é»˜è®¤å€¼çš„æ‰€ä»¥è¿™é»˜è®¤å€¼æˆ‘ä»¬è‡ªå·±æ¥èµ‹å€¼</span>
            purchaseEntity<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            purchaseEntity<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è¿™é‡Œè®¾ç½®é‡‡è´­å•çš„çŠ¶æ€é‡‡ç”¨çš„æ˜¯æšä¸¾ç±»çš„å½¢å¼è·å–</span>
            purchaseEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span><span class="token constant">CREATED</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>purchaseEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è·å¾—è‡ªåŠ¨åˆ›å»ºçš„é‡‡è´­å•id</span>
            purchaseId <span class="token operator">=</span> purchaseEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/** 3.2æŒ‡å®šé‡‡è´­å•äº†ï¼Œé€»è¾‘å¦‚ä¸‹
         * 1.é‡‡è´­å•idä¸ºVoä¸­è·å–çš„æŒ‡å®šid
         * 2.è®¾ç½®æ‰€æœ‰çš„é‡‡è´­éœ€æ±‚å¯¹è±¡å¹¶æ”¶é›†æˆå¯¹è±¡
         */</span>
        <span class="token class-name">Long</span> finalPurchaseId <span class="token operator">=</span> purchaseId<span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> collect1 <span class="token operator">=</span> collect<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//è·å–æ‰€æœ‰çš„é‡‡è´­éœ€æ±‚å¯¹è±¡</span>
            <span class="token comment">//æ›´æ–°é‡‡è´­éœ€æ±‚çš„çŠ¶æ€ï¼Œä¸€å…±éœ€è¦è¯¥ä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯é‡‡è´­çŠ¶æ€ï¼Œä¸€ä¸ªæ˜¯é‡‡è´­å•idã€‚è®¾ç½®é‡‡è´­éœ€æ±‚çš„idæ˜¯ä¸ºäº†åŒºåˆ†æ˜¯å“ªä¸€ä¸ªè¿›è¡Œäº†æ›´æ”¹</span>
            <span class="token class-name">PurchaseDetailEntity</span> purchaseDetailEntity <span class="token operator">=</span> purchaseDetailService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">setPurchaseId</span><span class="token punctuation">(</span>finalPurchaseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span><span class="token constant">ASSIGNED</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> purchaseDetailEntity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ‰¹é‡æ›´æ”¹é‡‡è´­éœ€æ±‚ï¼Œè¿™é‡Œæ˜¯MPé‡Œçš„æ¥å£ï¼Œå¯ç›´æ¥ä¼ å…¥å¯¹è±¡ï¼ŒMPä¼šè‡ªåŠ¨è¯»å–é‡Œé¢çš„ID</span>
        purchaseDetailService<span class="token punctuation">.</span><span class="token function">updateBatchById</span><span class="token punctuation">(</span>collect1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//å››ã€ä¼˜åŒ–æ—¶é—´æ›´æ–°ï¼Œä¸ºäº†æ˜¾ç¤ºçš„æ—¶é—´ç¬¦åˆæˆ‘ä»¬çš„æ ·å¼</span>
        <span class="token class-name">PurchaseEntity</span> purchaseEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        purchaseEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>purchaseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        purchaseEntity<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//äº”ã€æ›´æ–°é‡‡è´­å•</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>purchaseEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é¢†å–é‡‡è´­å•" tabindex="-1"><a class="header-anchor" href="#é¢†å–é‡‡è´­å•" aria-hidden="true">#</a> é¢†å–é‡‡è´­å•</h4><p>è¿™é‡Œæˆ‘ä»¬åªç”¨å†™å¥½æ¥å£çš„åŠŸèƒ½ï¼Œè¿™ä¸ªè¯·æ±‚ä¸€èˆ¬æ˜¯ç”±appæ¥è¿›è¡Œå‘é€</p><blockquote><p>controller</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * é¢†å–é‡‡è´­å•
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/received&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">received</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">{</span>
    purchaseService<span class="token punctuation">.</span><span class="token function">received</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>impl</p></blockquote><ol><li>é¢†å–é‡‡è´­å•ï¼Œé€šè¿‡æ¥å£æµ‹è¯•å·¥å…·å®Œæˆè¯·æ±‚</li><li>é¢†å–ç©é‡‡è´­å•åï¼Œæ›´æ”¹é‡‡è´­å•çŠ¶æ€å’Œå¯¹åº”é‡‡è´­éœ€æ±‚çŠ¶æ€ <ol><li>é‡‡è´­å•çŠ¶æ€æ”¹ä¸ºå·²é¢†å–</li><li>é‡‡è´­éœ€æ±‚çŠ¶æ€æ”¹ä¸ºæ­£åœ¨é‡‡è´­</li></ol></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">received</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.ç¡®è®¤å½“å‰é‡‡è´­å•çŠ¶æ€</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> ids<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//é€šè¿‡é‡‡è´­å•idè·å–é‡‡è´­å•å¯¹è±¡</span>
            <span class="token class-name">PurchaseEntity</span> purchaseEntity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> purchaseEntity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>id <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//å¯¹é‡‡è´­å•å¯¹è±¡è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœçŠ¶æ€ä¸ºæ–°å»ºæˆ–è€…å·²åˆ†é…çš„ç•™ä¸‹</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span><span class="token constant">CREATED</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                    id<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span><span class="token constant">ASSIGNED</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//å¯¹ä¸Šé¢æ”¶é›†å¥½çš„åœ¨è¿›è¡Œè¿‡æ»¤ï¼Œæ”¹å˜é‡‡è´­å•çŠ¶æ€ä¸ºå·²é¢†å–ï¼ˆRECEIVEï¼‰</span>
            item<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span><span class="token constant">RECEIVE</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å¯¹ä¸Šé¢æ”¶é›†å¥½çš„åœ¨è¿›è¡Œè¿‡æ»¤ï¼Œæ”¹å˜é‡‡è´­å•æ›´æ–°æ—¶é—´</span>
            item<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2.æ‰¹é‡ä¿®æ”¹æ”¹å˜é‡‡è´­å•çŠ¶æ€</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateBatchById</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3.æ”¹å˜é‡‡è´­éœ€æ±‚ä¸­çš„çŠ¶æ€</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>collect <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> collect<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            collect<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> entities <span class="token operator">=</span> purchaseDetailService<span class="token punctuation">.</span><span class="token function">listDetailByPurchaseId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> detailEntities <span class="token operator">=</span> entities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>entity <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token class-name">PurchaseDetailEntity</span> purchaseDetailEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//å°†é‡‡è´­éœ€æ±‚ä¸­çš„çŠ¶æ€æ”¹ä¸ºæ­£åœ¨é‡‡è´­</span>
                    purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span><span class="token constant">BUYING</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> purchaseDetailEntity<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                purchaseDetailService<span class="token punctuation">.</span><span class="token function">updateBatchById</span><span class="token punctuation">(</span>detailEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220814004750176.png" alt="image-20220814004750176" tabindex="0" loading="lazy"><figcaption>image-20220814004750176</figcaption></figure><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220814004807416.png" alt="image-20220814004807416" tabindex="0" loading="lazy"><figcaption>image-20220814004807416</figcaption></figure><h4 id="å®Œæˆé‡‡è´­" tabindex="-1"><a class="header-anchor" href="#å®Œæˆé‡‡è´­" aria-hidden="true">#</a> å®Œæˆé‡‡è´­</h4><blockquote><p>controller</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬åªç”¨å†™å¥½æ¥å£çš„åŠŸèƒ½ï¼Œè¿™ä¸ªè¯·æ±‚ä¸€èˆ¬æ˜¯ç”±appæ¥è¿›è¡Œå‘é€</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å®Œæˆé‡‡è´­å•
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/done&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">finished</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PurchaseDoneVo</span> doneVo<span class="token punctuation">)</span><span class="token punctuation">{</span>
    purchaseService<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span>doneVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token constant">VO</span>å¦‚ä¸‹ï¼š
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PurchaseDoneVo</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@NonNull</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseItemDoneVo</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PurchaseDoneVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PurchaseItemDoneVo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> itemId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> reason<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>impl</p></blockquote><p>å®Œæˆé‡‡è´­ä¸»è¦æ³¨æ„æœ‰å‡ ä¸ªåœ°æ–¹å‘ç”Ÿäº†å˜åŒ–ï¼Œåšå¥½é€»è¾‘çš„åˆ¤æ–­å³å¯</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * é‡‡è´­å®Œæˆä¸€å…±ä¸‰åœ°æ–¹ä¼šå‘ç”Ÿå˜åŒ–
     *  1.é‡‡è´­å•çŠ¶æ€
     *  2.åº“å­˜å¢åŠ 
     *  3.é‡‡è´­éœ€æ±‚çŠ¶æ€å‘ç”Ÿå˜åŒ–
     * <span class="token keyword">@param</span> <span class="token parameter">doneVo</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token class-name">PurchaseDoneVo</span> doneVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–å®Œæˆçš„æ˜¯å“ªä¸€ä¸ªé‡‡è´­å•</span>
        <span class="token class-name">Long</span> id <span class="token operator">=</span> doneVo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¸€ã€åˆå§‹åŒ–</span>
        <span class="token class-name">Boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">//è·å–é‡‡è´­å•idé›†åˆ</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseItemDoneVo</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> doneVo<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ”¶é›†ç»“æœ</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> updates <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PurchaseItemDoneVo</span> item <span class="token operator">:</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">PurchaseDetailEntity</span> purchaseDetailEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span><span class="token constant">HASERROR</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//äºŒã€é‡‡è´­éœ€æ±‚çŠ¶æ€å‘ç”Ÿå˜åŒ–</span>
                purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span><span class="token constant">FINISH</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//ç”±é‡‡è´­å•çš„idè·å–é‡‡è´­éœ€æ±‚å¯¹è±¡ï¼Œæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæ˜¯ç”¨æ¥ç»™å¢åŠ åº“å­˜æ—¶èµ‹å€¼ç”¨çš„</span>
                <span class="token class-name">PurchaseDetailEntity</span> entity <span class="token operator">=</span> purchaseDetailService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//ä¸‰ã€åº“å­˜å¢åŠ </span>
                wareSkuService<span class="token punctuation">.</span><span class="token function">addStock</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">getWareId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">getSkuNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//é‡‡è´­å®Œæˆï¼Œé‡‡è´­éœ€æ±‚ä¸­çš„çŠ¶æ€ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œç»™å®ä½“ç±»å¯¹è±¡æŒ‡æ˜idï¼Œä»è€Œä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€</span>
            purchaseDetailEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æŠŠè¦ä¿®æ”¹çš„é‡‡è´­éœ€æ±‚å¯¹è±¡æ”¾åˆ°é›†åˆé‡Œ</span>
            updates<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>purchaseDetailEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//å› ä¸ºä¸€ä¸ªé‡‡è´­å•é‡Œæœ‰å¤šä¸ªé‡‡è´­éœ€æ±‚åˆå¹¶çš„ï¼Œæ‰€ä»¥æ‰¹é‡ä¿®æ”¹é‡‡è´­éœ€æ±‚å¯¹è±¡</span>
        purchaseDetailService<span class="token punctuation">.</span><span class="token function">updateBatchById</span><span class="token punctuation">(</span>updates<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//å››.æ”¹å˜é‡‡è´­å•çŠ¶æ€</span>
        <span class="token class-name">PurchaseEntity</span> purchaseEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        purchaseEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        purchaseEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span><span class="token constant">FINISH</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
                <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span><span class="token constant">HASERROR</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        purchaseEntity<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>purchaseEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•æ•°æ®å¦‚ä¸‹ï¼š</p><p><strong>è¿™é‡Œid = 6æ˜¯å¯¹6å·é‡‡è´­å•å‘èµ·æ“ä½œï¼Œé‡Œé¢çš„item9å’Œ10æ˜¯é‡‡è´­å•å¯¹åº”çš„é‡‡è´­éœ€æ±‚</strong></p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token property">&quot;items&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;itemId&quot;</span><span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;reason&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;itemId&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token property">&quot;reason&quot;</span><span class="token operator">:</span><span class="token string">&quot;æ— è´§&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220907215915451.png" alt="image-20220907215915451" tabindex="0" loading="lazy"><figcaption>image-20220907215915451</figcaption></figure><p><strong>é‡‡è´­å•çŠ¶æ€å¦‚ä¸‹ï¼š</strong></p><p>æœ‰å¼‚å¸¸æ˜¯å› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªé‡‡è´­å•æ²¡æœ‰é‡‡è´­å®Œæˆ</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220907215937701.png" alt="image-20220907215937701" tabindex="0" loading="lazy"><figcaption>image-20220907215937701</figcaption></figure><p><strong>é‡‡è´­éœ€æ±‚å¦‚ä¸‹ï¼š</strong></p><p>æ²¡æœ‰å®Œæˆçš„é‡‡è´­éœ€æ±‚ä¼šæ˜¾ç¤ºé‡‡è´­å¤±è´¥</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220907220051000.png" alt="image-20220907220051000" tabindex="0" loading="lazy"><figcaption>image-20220907220051000</figcaption></figure><p><strong>åº“å­˜å¦‚ä¸‹ï¼š</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220907220103041.png" alt="image-20220907220103041" tabindex="0" loading="lazy"><figcaption>image-20220907220103041</figcaption></figure><h4 id="æ˜¾ç¤ºå•†å“åº“å­˜ä¸­çš„sku-name" tabindex="-1"><a class="header-anchor" href="#æ˜¾ç¤ºå•†å“åº“å­˜ä¸­çš„sku-name" aria-hidden="true">#</a> æ˜¾ç¤ºå•†å“åº“å­˜ä¸­çš„sku_name</h4><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220907222230675.png" alt="image-20220907222230675" tabindex="0" loading="lazy"><figcaption>image-20220907222230675</figcaption></figure><p>æ€ä¹ˆæ˜¾ç¤ºå‘¢ï¼Ÿé”å®šåº“å­˜å°±æ˜¯æœ¬è¡¨åº“å­˜è¡¨ç›¸å…³çš„å¯ä»¥ç›´æ¥è®¾ç½®ï¼Œè€Œsku_nameæ˜¯mall-productå¾®æœåŠ¡é‡Œæ‰èƒ½æŸ¥è¯¢çš„åˆ°çš„</p><p>é‚£å°±å†™Feignæ¥å£å‘—ï¼Œè¿™é‡Œä»‹ç»ä¸¤ç§feignæ¥å£çš„å†™æ³•ï¼š</p><p><strong>1.ç»™è¿œç¨‹è°ƒç”¨çš„å¾®æœåŠ¡å‘è¯·æ±‚</strong></p><ul><li><pre><code> @FeignClient(&quot;mall-product&quot;) æŒ‡å®šå¾®æœåŠ¡
</code></pre></li><li><pre><code> /product/skuinfo/info/{skuId}
</code></pre></li></ul><p><strong>2.ç»™ç½‘å…³å‘è¯·æ±‚</strong></p><ul><li>@FeignClient(&quot;mall-gateway&quot;)</li><li skuId="">/api/product/skuinfo/info/</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">&quot;mall-gateway&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProductFeignService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/product/skuinfo/info/{skuId}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¢åŠ åº“å­˜çš„æ—¶å€™æ³¨å…¥FeignServiceæ¥å£å³å¯å®ç°è¿œç¨‹è°ƒç”¨</p><p>è¿™é‡Œé‡‡å–äº†trycatchçš„å½¢å¼æ¥æ•è·å¼‚å¸¸ï¼Œå¯ä»¥é˜²æ­¢è¿œç¨‹è°ƒç”¨å¤±è´¥æ—¶ï¼Œäº‹åŠ¡å›æ»š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addStock</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">,</span> <span class="token class-name">Long</span> wareId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> skuNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//åˆ¤æ–­å¦‚æœæ²¡æœ‰æ­¤åº“å­˜è®°å½•,åˆ™ä¸ºæ–°å¢æ“ä½œ;å¦‚æœæœ‰åˆ™ä¸ºæ›´æ”¹æ“ä½œ</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span> wareSkuEntities <span class="token operator">=</span> wareSkuDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;sku_id&quot;</span><span class="token punctuation">,</span> skuId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;ware_id&quot;</span><span class="token punctuation">,</span> wareId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>wareSkuEntities <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> wareSkuEntities<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WareSkuEntity</span> wareSkuEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WareSkuEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wareSkuEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wareSkuEntity<span class="token punctuation">.</span><span class="token function">setStock</span><span class="token punctuation">(</span>skuNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wareSkuEntity<span class="token punctuation">.</span><span class="token function">setWareId</span><span class="token punctuation">(</span>wareId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wareSkuEntity<span class="token punctuation">.</span><span class="token function">setStockLocked</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//TODO è¿œç¨‹æŸ¥è¯¢skuçš„åå­—</span>
        <span class="token comment">//å¦‚æœæŸ¥è¯¢åå­—æŸ¥è¯¢å¤±è´¥äº†ï¼Œäº‹åŠ¡å›æ»šæœ‰ç‚¹ä¸å€¼å¾—ï¼Œæ‰€ä»¥ç”¨trycatchæ¥æ•æ‰ä¸€ä¸‹</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">R</span> info <span class="token operator">=</span> productFeignService<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> skuInfo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> info<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;skuInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                wareSkuEntity<span class="token punctuation">.</span><span class="token function">setSkuName</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> skuInfo<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;skuName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        wareSkuDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>wareSkuEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        wareSkuDao<span class="token punctuation">.</span><span class="token function">addStock</span><span class="token punctuation">(</span>skuId<span class="token punctuation">,</span> wareId<span class="token punctuation">,</span> skuNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="åˆ†å¸ƒå¼åŸºç¡€ç¯‡æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼åŸºç¡€ç¯‡æ€»ç»“" aria-hidden="true">#</a> åˆ†å¸ƒå¼åŸºç¡€ç¯‡æ€»ç»“</h1><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220907233734138.png" alt="image-20220907233734138" tabindex="0" loading="lazy"><figcaption>image-20220907233734138</figcaption></figure><h1 id="bugè®°å½•" tabindex="-1"><a class="header-anchor" href="#bugè®°å½•" aria-hidden="true">#</a> Bugè®°å½•</h1><h2 id="æ— æ³•å‘é€æŸ¥è¯¢å“ç‰Œä¿¡æ¯çš„è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#æ— æ³•å‘é€æŸ¥è¯¢å“ç‰Œä¿¡æ¯çš„è¯·æ±‚" aria-hidden="true">#</a> æ— æ³•å‘é€æŸ¥è¯¢å“ç‰Œä¿¡æ¯çš„è¯·æ±‚</h2><p>p84 å…³äºpubsubã€publishæŠ¥é”™ï¼Œæ— æ³•å‘é€æŸ¥è¯¢å“ç‰Œä¿¡æ¯çš„è¯·æ±‚ï¼š 1ã€npm install --save pubsub-js 2ã€åœ¨srcä¸‹çš„main.jsä¸­å¼•ç”¨ï¼š â‘  import PubSub from &#39;pubsub-js&#39; â‘¡ Vue.prototype.PubSub = PubSub</p><h2 id="å€¼ç±»å‹ä¿®æ”¹å¤±è´¥-ä¸€ç›´ä¿æŒå¤šé€‰" tabindex="-1"><a class="header-anchor" href="#å€¼ç±»å‹ä¿®æ”¹å¤±è´¥-ä¸€ç›´ä¿æŒå¤šé€‰" aria-hidden="true">#</a> å€¼ç±»å‹ä¿®æ”¹å¤±è´¥ï¼Œä¸€ç›´ä¿æŒå¤šé€‰</h2><p>é—®é¢˜å¦‚ä¸‹ï¼š</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812172555834.png" alt="image-20220812172555834" tabindex="0" loading="lazy"><figcaption>image-20220812172555834</figcaption></figure><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ä¿å­˜æˆ–ä¿®æ”¹æ•°æ®çš„æ—¶å€™çœ‹æ§åˆ¶å°ä¼šæŠ¥é”™ï¼ï¼ï¼</li><li>æ£€æŸ¥å‘ç°ä¸å‘ç”Ÿæ”¹å˜çš„å­—æ®µæ²¡æœ‰ä¼ åˆ°æ•°æ®åº“é‡Œï¼Œä¹Ÿå°±æ˜¯voé‡Œå°‘äº†å­—æ®µ</li></ol><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812174656091.png" alt="image-20220812174656091" tabindex="0" loading="lazy"><figcaption>image-20220812174656091</figcaption></figure><p><strong>å‘ç°æ²¡æœ‰value_type</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812174711634.png" alt="image-20220812174711634" tabindex="0" loading="lazy"><figcaption>image-20220812174711634</figcaption></figure><p>åœ¨voä¸­åŠ ä¸Šè¯¥å­—æ®µå³å¯ï¼</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812175453778.png" alt="image-20220812175453778" tabindex="0" loading="lazy"><figcaption>image-20220812175453778</figcaption></figure><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220812175857419.png" alt="image-20220812175857419" tabindex="0" loading="lazy"><figcaption>image-20220812175857419</figcaption></figure></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/ssss/edit/main/demo/theme-docs/src/study-project/mall/åŸºç¡€ç¯‡2.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><!----><!----></footer><nav class="page-nav"><a href="/study-project/mall/%E5%9F%BA%E7%A1%80%E7%AF%871.html" class="nav-link prev" aria-label="åŸºç¡€ç¯‡1"><div class="hint"><span class="arrow left"></span>Prev</div><div class="link"><!---->åŸºç¡€ç¯‡1</div></a><a href="/study-project/mall/%E9%AB%98%E7%BA%A7%E7%AF%871.html" class="nav-link next" aria-label="é«˜çº§ç¯‡1"><div class="hint">Next<span class="arrow right"></span></div><div class="link">é«˜çº§ç¯‡1<!----></div></a></nav><div class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">NickName</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">E-Mail</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">Website</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="Write a comment here (Fill in the email address to receive an email notification when being replied)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>Preview:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="Emoji" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="GIF"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="Upload Image"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="Preview"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-text-number">0 <!--v-if--> Â Words</div><button type="button" class="wl-btn">Login</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->Submit<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="Search GIF"><div class="wl-gallery" style="gap:6px;"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> Comments</div><ul class="wl-sort"><!--[--><li class="active">Latest</li><li class="">Oldest</li><li class="">Hottest</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v2.14.4</div></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Copyright Â© 2022 å°è”¡coding</div><div class="copyright">Copyright Â© 2022 xiaocai</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-18c23253.js" defer></script>
  </body>
</html>
