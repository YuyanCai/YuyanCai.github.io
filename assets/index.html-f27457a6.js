import{ac as i,F as t,G as r,D as a,R as s,M as e,ad as l,V as c}from"./framework-f12b30cc.js";const o={},p=l(`<h2 id="docker环境安装" tabindex="-1"><a class="header-anchor" href="#docker环境安装" aria-hidden="true">#</a> Docker环境安装</h2><ul><li>安装<code>yum-utils</code>：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils device-mapper-persistent-data lvm2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>为yum源添加docker仓库位置：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>安装docker：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> docker-ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动docker：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl start <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="mysql安装" tabindex="-1"><a class="header-anchor" href="#mysql安装" aria-hidden="true">#</a> MySQL安装</h2><ul><li>下载MySQL<code>5.7</code>的docker镜像：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull mysql:5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>使用如下命令启动MySQL服务：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token parameter variable">--name</span> mysql <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/mysql/log:/var/log/mysql <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/mysql/data:/var/lib/mysql <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/mysql/conf:/etc/mysql <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root  <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> mysql:5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>参数说明 <ul><li>-p 3306:3306：将容器的3306端口映射到主机的3306端口</li><li>-v /mydata/mysql/conf:/etc/mysql：将配置文件夹挂在到主机</li><li>-v /mydata/mysql/log:/var/log/mysql：将日志文件夹挂载到主机</li><li>-v /mydata/mysql/data:/var/lib/mysql/：将数据文件夹挂载到主机</li><li>-e MYSQL_ROOT_PASSWORD=root：初始化root用户的密码</li></ul></li><li>进入运行MySQL的docker容器：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql /bin/bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>使用MySQL命令打开客户端：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot</span> --default-character-set<span class="token operator">=</span>utf8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>创建mall数据库：</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> mall <span class="token keyword">character</span> <span class="token keyword">set</span> utf8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>安装上传下载插件，并将<code>document/sql/mall.sql</code>上传到Linux服务器上：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> lrzsz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>将<code>mall.sql</code>文件拷贝到mysql容器的<code>/</code>目录下：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">cp</span> /mydata/mall.sql mysql:/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>将sql文件导入到数据库：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>use mall<span class="token punctuation">;</span>
<span class="token builtin class-name">source</span> /mall.sql<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>创建一个<code>reader:123456</code>帐号并修改权限，使得任何ip都能访问：</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">&#39;reader&#39;</span> <span class="token variable">@&#39;%&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="redis安装" tabindex="-1"><a class="header-anchor" href="#redis安装" aria-hidden="true">#</a> Redis安装</h2><ul><li>下载Redis<code>7</code>的docker镜像：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull redis:7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>使用如下命令启动Redis服务：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6379</span>:6379 <span class="token parameter variable">--name</span> redis <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/redis/data:/data <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> redis:7 redis-server <span class="token parameter variable">--appendonly</span> <span class="token function">yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>进入Redis容器使用<code>redis-cli</code>命令进行连接：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> redis redis-cli
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/YuyanCai/imagebed/main/note/image-20221224205009412.png" alt="image-20221224205009412" tabindex="0" loading="lazy"><figcaption>image-20221224205009412</figcaption></figure><h2 id="nginx安装" tabindex="-1"><a class="header-anchor" href="#nginx安装" aria-hidden="true">#</a> Nginx安装</h2><ul><li>下载Nginx<code>1.22</code>的docker镜像：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull nginx:1.22
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>先运行一次容器（为了拷贝配置文件）：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token parameter variable">--name</span> nginx <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/nginx/html:/usr/share/nginx/html <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/nginx/logs:/var/log/nginx  <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> nginx:1.22
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>将容器内的配置文件拷贝到指定目录：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> container <span class="token function">cp</span> nginx:/etc/nginx /mydata/nginx/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>修改文件名称：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mv</span> nginx conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>终止并删除容器：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> stop nginx
<span class="token function">docker</span> <span class="token function">rm</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用如下命令启动Nginx服务：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token parameter variable">--name</span> nginx <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/nginx/html:/usr/share/nginx/html <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/nginx/logs:/var/log/nginx  <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/nginx/conf:/etc/nginx <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> nginx:1.22
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="rabbitmq安装" tabindex="-1"><a class="header-anchor" href="#rabbitmq安装" aria-hidden="true">#</a> RabbitMQ安装</h2><ul><li>下载rabbitmq<code>3.9-management</code>的docker镜像：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull rabbitmq:3.9-management
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>使用如下命令启动RabbitMQ服务：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">5672</span>:5672 <span class="token parameter variable">-p</span> <span class="token number">15672</span>:15672 <span class="token parameter variable">--name</span> rabbitmq <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> rabbitmq:3.9-management
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>开启防火墙：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">15672</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,56),d={href:"http://172.0.0.2:15672",target:"_blank",rel:"noopener noreferrer"},u=l(`<figure><img src="https://raw.githubusercontent.com/YuyanCai/imagebed/main/note/mall_linux_deploy_03.78dad8ac.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li><p>输入账号密码并登录：guest guest</p></li><li><p>创建帐号并设置其角色为管理员：mall mall</p></li></ul><figure><img src="https://raw.githubusercontent.com/YuyanCai/imagebed/main/note/mall_linux_deploy_04.2fd308c9.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li>创建一个新的虚拟host为：/mall</li></ul><figure><img src="https://www.macrozheng.com/assets/mall_linux_deploy_05.9a7bf37b.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li>点击mall用户进入用户配置页面</li></ul><figure><img src="https://raw.githubusercontent.com/YuyanCai/imagebed/main/note/mall_linux_deploy_06.309462ae.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li>给mall用户配置该虚拟host的权限</li></ul><figure><img src="https://www.macrozheng.com/assets/mall_linux_deploy_07.782ca72c.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="elasticsearch安装" tabindex="-1"><a class="header-anchor" href="#elasticsearch安装" aria-hidden="true">#</a> Elasticsearch安装</h2><ul><li>下载Elasticsearch<code>7.17.3</code>的docker镜像：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull elasticsearch:7.17.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>修改虚拟内存区域大小，否则会因为过小而无法启动:</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">vm.max_map_count</span><span class="token operator">=</span><span class="token number">262144</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>使用如下命令启动Elasticsearch服务，内存小的服务器可以通过<code>ES_JAVA_OPTS</code>来设置占用内存大小：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token parameter variable">--name</span> elasticsearch <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;discovery.type=single-node&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;cluster.name=elasticsearch&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx1024m&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/elasticsearch/data:/usr/share/elasticsearch/data <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> elasticsearch:7.17.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动时会发现<code>/usr/share/elasticsearch/data</code>目录没有访问权限，只需要修改<code>/mydata/elasticsearch/data</code>目录的权限，再重新启动即可；</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">chmod</span> <span class="token number">777</span> /mydata/elasticsearch/data/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,18),m={href:"https://github.com/medcl/elasticsearch-analysis-ik/releases",target:"_blank",rel:"noopener noreferrer"},b=l(`<figure><img src="https://www.macrozheng.com/assets/mall_linux_deploy_new_02.d402f993.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li>下载完成后解压到Elasticsearch的<code>/mydata/elasticsearch/plugins</code>目录下；</li></ul><figure><img src="https://raw.githubusercontent.com/YuyanCai/imagebed/main/note/mall_linux_deploy_new_03.d123512a.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li>重新启动服务：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart elasticsearch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>开启防火墙：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">9200</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,7),v={href:"http://172.0.0.2:9200",target:"_blank",rel:"noopener noreferrer"},g=l(`<div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;708f1d885c16&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cluster_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;elasticsearch&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cluster_uuid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mza51wT-QvaZ5R0NmE183g&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;number&quot;</span><span class="token operator">:</span> <span class="token string">&quot;7.17.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_flavor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_hash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5ad023604c8d7416c9eb6c0eadb62b14e766caff&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2022-04-19T08:11:19.070913226Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build_snapshot&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lucene_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.11.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;minimum_wire_compatibility_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6.8.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;minimum_index_compatibility_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6.0.0-beta1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tagline&quot;</span><span class="token operator">:</span> <span class="token string">&quot;You Know, for Search&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="logstash安装" tabindex="-1"><a class="header-anchor" href="#logstash安装" aria-hidden="true">#</a> Logstash安装</h2><ul><li>下载Logstash<code>7.17.3</code>的docker镜像：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull logstash:7.17.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,4),h=a("code",null,"logstash.conf",-1),k=a("code",null,"output",-1),f=a("code",null,"es:9200",-1),x={href:"https://github.com/macrozheng/mall/blob/master/document/elk/logstash.conf",target:"_blank",rel:"noopener noreferrer"},y=l(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>output {
  elasticsearch {
    hosts =&gt; &quot;es:9200&quot;
    index =&gt; &quot;mall-%{type}-%{+YYYY.MM.dd}&quot;
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>创建<code>/mydata/logstash</code>目录，并将Logstash的配置文件<code>logstash.conf</code>拷贝到该目录；</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> /mydata/logstash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>使用如下命令启动Logstash服务；</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">--name</span> logstash <span class="token parameter variable">-p</span> <span class="token number">4560</span>:4560 <span class="token parameter variable">-p</span> <span class="token number">4561</span>:4561 <span class="token parameter variable">-p</span> <span class="token number">4562</span>:4562 <span class="token parameter variable">-p</span> <span class="token number">4563</span>:4563 <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> elasticsearch:es <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/logstash/logstash.conf:/usr/share/logstash/pipeline/logstash.conf <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> logstash:7.17.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>进入容器内部，安装<code>json_lines</code>插件。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>logstash-plugin <span class="token function">install</span> logstash-codec-json_lines
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="kibana安装" tabindex="-1"><a class="header-anchor" href="#kibana安装" aria-hidden="true">#</a> Kibana安装</h2><ul><li>下载Kibana<code>7.17.3</code>的docker镜像：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull kibana:7.17.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>使用如下命令启动Kibana服务：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">--name</span> kibana <span class="token parameter variable">-p</span> <span class="token number">5601</span>:5601 <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> elasticsearch:es <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;elasticsearch.hosts=http://es:9200&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> kibana:7.17.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>开启防火墙：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">5601</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,14),_={href:"http://172.0.0.2:5601",target:"_blank",rel:"noopener noreferrer"},q=l(`<figure><img src="https://raw.githubusercontent.com/YuyanCai/imagebed/main/note/mall_linux_deploy_new_04.5c098822.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="mongodb安装" tabindex="-1"><a class="header-anchor" href="#mongodb安装" aria-hidden="true">#</a> MongoDB安装</h2><ul><li>下载MongoDB<code>4</code>的docker镜像：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull mongo:4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>使用docker命令启动：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">27017</span>:27017 <span class="token parameter variable">--name</span> mongo <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/mongo/db:/data/db <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> mongo:4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="docker全部环境安装完成" tabindex="-1"><a class="header-anchor" href="#docker全部环境安装完成" aria-hidden="true">#</a> Docker全部环境安装完成</h2><ul><li>所有下载镜像文件：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
redis                 <span class="token number">7</span>                   604d80444252        <span class="token number">2</span> days ago          117MB
nginx                 <span class="token number">1.22</span>                f9c88cc1c21a        <span class="token number">2</span> weeks ago         142MB
elasticsearch         <span class="token number">7.17</span>.3              3c91aa69ae06        <span class="token number">8</span> weeks ago         613MB
kibana                <span class="token number">7.17</span>.3              4897f4b8b6ee        <span class="token number">8</span> weeks ago         797MB
logstash              <span class="token number">7.17</span>.3              dd4291c803f4        <span class="token number">8</span> weeks ago         774MB
mongo                 <span class="token number">4</span>                   1c0f1e566fec        <span class="token number">5</span> months ago        438MB
rabbitmq              <span class="token number">3.9</span>-management      6c3c2a225947        <span class="token number">6</span> months ago        253MB
mysql                 <span class="token number">5.7</span>                 7faa3c53e6d6        <span class="token number">3</span> years ago         373MB
nginx                 <span class="token number">1.10</span>                0346349a1a64        <span class="token number">5</span> years ago         182MB
<span class="token function">java</span>                  <span class="token number">8</span>                   d23bdf5b1b1b        <span class="token number">5</span> years ago         643MB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>所有运行在容器里面的应用：</li></ul><figure><img src="https://www.macrozheng.com/assets/mall_linux_deploy_new_05.dbb53569.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="springboot应用部署" tabindex="-1"><a class="header-anchor" href="#springboot应用部署" aria-hidden="true">#</a> SpringBoot应用部署</h2><h3 id="构建所有docker镜像并上传" tabindex="-1"><a class="header-anchor" href="#构建所有docker镜像并上传" aria-hidden="true">#</a> 构建所有Docker镜像并上传</h3><ul><li>修改项目根目录下的<code>pom.xml</code>中的<code>docker.host</code>属性：</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>docker.host</span><span class="token punctuation">&gt;</span></span>http://192.168.3.101:2375<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>docker.host</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>如果项目根目录的<code>pom.mxl</code>中<code>docker-maven-plugin</code>的<code>&lt;executions&gt;</code>节点被注释掉了就打开注释，使项目在打包时直接构建Docker镜像；</li></ul><figure><img src="https://www.macrozheng.com/assets/mall_linux_deploy_new_06.bf2e2ee0.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li>直接双击根项目<code>mall</code>的<code>package</code>命令可以一次性打包所有应用的Docker镜像；</li></ul><figure><img src="https://raw.githubusercontent.com/YuyanCai/imagebed/main/note/mall_linux_deploy_12.fe095c6d.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
mall/mall-portal      <span class="token number">1.0</span>-SNAPSHOT        c668ea32b405        <span class="token number">24</span> hours ago        712MB
mall/mall-search      <span class="token number">1.0</span>-SNAPSHOT        627d1ebbc21b        <span class="token number">24</span> hours ago        745MB
mall/mall-admin       <span class="token number">1.0</span>-SNAPSHOT        2300aca75270        <span class="token number">24</span> hours ago        725MB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="部署mall-admin" tabindex="-1"><a class="header-anchor" href="#部署mall-admin" aria-hidden="true">#</a> 部署mall-admin</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 <span class="token parameter variable">--name</span> mall-admin <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> mysql:db <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> redis:redis <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /etc/localtime:/etc/localtime <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/app/admin/logs:/var/logs <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> mall/mall-admin:1.0-SNAPSHOT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>注意</code>：如果想使用Logstash收集日志的话，需要将应用容器连接到Logstsh，添加如下配置即可；</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token parameter variable">--link</span> logstash:logstash <span class="token punctuation">\\</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="部署mall-search" tabindex="-1"><a class="header-anchor" href="#部署mall-search" aria-hidden="true">#</a> 部署mall-search</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">8081</span>:8081 <span class="token parameter variable">--name</span> mall-search <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> elasticsearch:es <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> mysql:db <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /etc/localtime:/etc/localtime <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/app/search/logs:/var/logs <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> mall/mall-search:1.0-SNAPSHOT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="部署mall-port" tabindex="-1"><a class="header-anchor" href="#部署mall-port" aria-hidden="true">#</a> 部署mall-port</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">8085</span>:8085 <span class="token parameter variable">--name</span> mall-portal <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> mysql:db <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> redis:redis <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> mongo:mongo <span class="token punctuation">\\</span>
<span class="token parameter variable">--link</span> rabbitmq:rabbit <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /etc/localtime:/etc/localtime <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /mydata/app/portal/logs:/var/logs <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> mall/mall-portal:1.0-SNAPSHOT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="开启防火墙" tabindex="-1"><a class="header-anchor" href="#开启防火墙" aria-hidden="true">#</a> 开启防火墙</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8080</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8081</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8085</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="访问接口进行测试" tabindex="-1"><a class="header-anchor" href="#访问接口进行测试" aria-hidden="true">#</a> 访问接口进行测试</h3>`,31),w={href:"http://172.0.0.2:8080/swagger-ui/",target:"_blank",rel:"noopener noreferrer"},S=a("figure",null,[a("img",{src:"https://raw.githubusercontent.com/YuyanCai/imagebed/main/note/mall_linux_deploy_13.f1cb4e11.png",alt:"img",tabindex:"0",loading:"lazy"}),a("figcaption",null,"img")],-1),z={href:"http://172.0.0.2:8081/swagger-ui/",target:"_blank",rel:"noopener noreferrer"},M=a("figure",null,[a("img",{src:"https://www.macrozheng.com/assets/mall_linux_deploy_14.4cc0ed38.png",alt:"img",tabindex:"0",loading:"lazy"}),a("figcaption",null,"img")],-1),E={href:"http://172.0.0.2:8085/swagger-ui/",target:"_blank",rel:"noopener noreferrer"},A=a("figure",null,[a("img",{src:"https://raw.githubusercontent.com/YuyanCai/imagebed/main/note/mall_linux_deploy_15.5964e33a.png",alt:"img",tabindex:"0",loading:"lazy"}),a("figcaption",null,"img")],-1);function B(T,O){const n=c("ExternalLinkIcon");return t(),r("div",null,[p,a("ul",null,[a("li",null,[s("访问地址查看是否安装成功："),a("a",d,[s("http://172.0.0.2:15672"),e(n)])])]),u,a("ul",null,[a("li",null,[s("安装中文分词器IKAnalyzer，注意下载与Elasticsearch对应的版本，下载地址："),a("a",m,[s("https://github.com/medcl/elasticsearch-analysis-ik/releases"),e(n)])])]),b,a("ul",null,[a("li",null,[s("访问会返回版本信息："),a("a",v,[s("http://172.0.0.2:9200"),e(n)])])]),g,a("ul",null,[a("li",null,[s("修改Logstash的配置文件"),h,s("中"),k,s("节点下的Elasticsearch连接地址为"),f,s("，配置文件地址："),a("a",x,[s("https://github.com/macrozheng/mall/blob/master/document/elk/logstash.conf"),e(n)])])]),y,a("ul",null,[a("li",null,[s("访问地址进行测试："),a("a",_,[s("http://172.0.0.2:5601"),e(n)])])]),q,a("ul",null,[a("li",null,[s("mall-admin的api接口文档地址："),a("a",w,[s("http://172.0.0.2:8080/swagger-ui/"),e(n)])])]),S,a("ul",null,[a("li",null,[s("mall-search的api接口文档地址："),a("a",z,[s("http://172.0.0.2:8081/swagger-ui/"),e(n)])])]),M,a("ul",null,[a("li",null,[s("mall-portal的api接口文档地址："),a("a",E,[s("http://172.0.0.2:8085/swagger-ui/"),e(n)])])]),A])}const Y=i(o,[["render",B],["__file","index.html.vue"]]);export{Y as default};
