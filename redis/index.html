<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/redis/"><meta property="og:site_name" content="小蔡coding"><meta property="og:title" content="Redis"><meta property="og:description" content="1.1 NoSql数据库 1.1.1 概述 ACID是衡量事务的四个特性： - 原子性（Atomicity，或称不可分割性） - 一致性（Consistency） - 隔离性（Isolation） - 持久性（Durability） 非关系型数据库就是没用遵循关系代数模式的数据库。举一些例子： 1. 文档数据库，没研究过定义，通常mongodb 就是文..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-12-31T12:07:23.000Z"><meta property="og:locale" content="en-US"><meta property="article:modified_time" content="2022-12-31T12:07:23.000Z"><title>Redis | 小蔡coding</title><meta name="description" content="1.1 NoSql数据库 1.1.1 概述 ACID是衡量事务的四个特性： - 原子性（Atomicity，或称不可分割性） - 一致性（Consistency） - 隔离性（Isolation） - 持久性（Durability） 非关系型数据库就是没用遵循关系代数模式的数据库。举一些例子： 1. 文档数据库，没研究过定义，通常mongodb 就是文...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-b0136e4c.css" as="style"><link rel="stylesheet" href="/assets/style-b0136e4c.css">
    <link rel="modulepreload" href="/assets/app-59753726.js"><link rel="modulepreload" href="/assets/framework-f12b30cc.js"><link rel="modulepreload" href="/assets/index.html-1d090b10.js"><link rel="modulepreload" href="/assets/index.html-904e3e63.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.png" alt="小蔡coding"><!----><span class="site-name hide-in-pad">小蔡coding</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="font-icon icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/front/Vue/" class="nav-link" aria-label="前端"><span class="font-icon icon iconfont icon-javascript" style=""></span>前端<!----></a></div><div class="nav-item hide-in-mobile"><a href="/Java/" class="nav-link" aria-label="后端"><span class="font-icon icon iconfont icon-java" style=""></span>后端<!----></a></div><div class="nav-item hide-in-mobile"><a href="/devops/" class="nav-link" aria-label="运维"><span class="font-icon icon iconfont icon-centos" style=""></span>运维<!----></a></div><div class="nav-item hide-in-mobile"><a href="/mysql/" class="nav-link" aria-label="Mysql"><span class="font-icon icon iconfont icon-more" style=""></span>Mysql<!----></a></div><div class="nav-item hide-in-mobile"><a aria-current="page" href="/redis/" class="router-link-active router-link-exact-active nav-link active" aria-label="Redis"><span class="font-icon icon iconfont icon-launch" style=""></span>Redis<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="项目实战"><span class="title"><span class="font-icon icon iconfont icon-hot" style=""></span>项目实战</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/study-project/school/" class="nav-link" aria-label="谷粒学院"><!---->谷粒学院<!----></a></li><li class="dropdown-item"><a href="/study-project/mall/" class="nav-link" aria-label="谷粒商城"><!---->谷粒商城<!----></a></li><li class="dropdown-item"><a href="/study-project/evaluate/" class="nav-link" aria-label="黑马点评"><!---->黑马点评<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/redis/#" class="router-link-active router-link-exact-active nav-link" aria-label="探花交友"><!---->探花交友<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/redis/#" class="router-link-active router-link-exact-active nav-link" aria-label="黑马头条"><!---->黑马头条<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/redis/#" class="router-link-active router-link-exact-active nav-link" aria-label="品达物流TMS"><!---->品达物流TMS<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/redis/#" class="router-link-active router-link-exact-active nav-link" aria-label="智牛股"><!---->智牛股<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/redis/#" class="router-link-active router-link-exact-active nav-link" aria-label="亿可控"><!---->亿可控<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/redis/#" class="router-link-active router-link-exact-active nav-link" aria-label="开源项目"><!---->开源项目<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="学习中遇到的问题"><span class="title"><span class="font-icon icon iconfont icon-linux" style=""></span>学习中遇到的问题</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/mac/idea.html" class="nav-link" aria-label="MAC使用IDEA小技巧"><!---->MAC使用IDEA小技巧<!----></a></li><li class="dropdown-item"><a href="/mac/linux.html" class="nav-link" aria-label="Linux使用小技巧"><!---->Linux使用小技巧<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/redis/redis.html" class="nav-link sidebar-link sidebar-page" aria-label="Redis"><!---->Redis<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Redis</h1><div class="page-info"><span class="author-info" aria-label="Author🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://xiaocaicoding.cn" target="_blank" rel="noopener noreferrer">xiaocai</a></span><span property="author" content="xiaocai"></span></span><!----><span class="date-info" aria-label="Writing Date📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-12-31T12:07:23.000Z"></span><!----><!----><span class="reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 38 min</span><meta property="timeRequired" content="PT38M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_1-1-nosql数据库" class="router-link-active router-link-exact-active toc-link level2">1.1 NoSql数据库</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_1-1-1-概述" class="router-link-active router-link-exact-active toc-link level3">1.1.1 概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_1-1-2-nosql适用场景" class="router-link-active router-link-exact-active toc-link level3">1.1.2  NoSQL适用场景</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_1-1-3-nosql不适用场景" class="router-link-active router-link-exact-active toc-link level3">1.1.3 NoSQL不适用场景</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_1-1-4-常见的nosql" class="router-link-active router-link-exact-active toc-link level3">1.1.4 常见的NoSql</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_2-1-应用场景" class="router-link-active router-link-exact-active toc-link level2">2.1 应用场景</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_2-1-1-配合关系型数据库做高速缓存" class="router-link-active router-link-exact-active toc-link level3">2.1.1 配合关系型数据库做高速缓存</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_2-1-2-多样的数据结构存储持久化数据" class="router-link-active router-link-exact-active toc-link level3">2.1.2  多样的数据结构存储持久化数据</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_2-2-安装redis" class="router-link-active router-link-exact-active toc-link level2">2.2 安装redis</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_2-2-1-前台启动" class="router-link-active router-link-exact-active toc-link level3">2.2.1 前台启动</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_2-2-2-后台启动" class="router-link-active router-link-exact-active toc-link level3">2.2.2 后台启动</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_2-2-3-测试" class="router-link-active router-link-exact-active toc-link level3">2.2.3 测试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_2-2-4-端口6379从何而来" class="router-link-active router-link-exact-active toc-link level3">2.2.4 端口6379从何而来</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-1-redis键-key" class="router-link-active router-link-exact-active toc-link level2">3.1 Redis键(key)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-2-redis字符串" class="router-link-active router-link-exact-active toc-link level2">3.2 Redis字符串</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-2-1-常用命令" class="router-link-active router-link-exact-active toc-link level3">3.2.1 常用命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-2-2-数据结构" class="router-link-active router-link-exact-active toc-link level3">3.2.2 数据结构</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-3-redis列表-list" class="router-link-active router-link-exact-active toc-link level2">3.3 Redis列表（List）</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-3-1-常用命令" class="router-link-active router-link-exact-active toc-link level3">3.3.1  常用命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-3-2-数据结构" class="router-link-active router-link-exact-active toc-link level3">3.3.2  数据结构</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-4-redis集合-set" class="router-link-active router-link-exact-active toc-link level2">3.4 Redis集合(Set)</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-4-1-常用命令" class="router-link-active router-link-exact-active toc-link level3">3.4.1 常用命令</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-5-redis哈希-hash" class="router-link-active router-link-exact-active toc-link level2">3.5 Redis哈希(Hash)</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-5-1-常用命令" class="router-link-active router-link-exact-active toc-link level3">3.5.1 常用命令</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-6-redis有序集合zset" class="router-link-active router-link-exact-active toc-link level2">3.6 Redis有序集合Zset</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_3-6-1-常用命令" class="router-link-active router-link-exact-active toc-link level3">3.6.1 常用命令</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-1-units单位" class="router-link-active router-link-exact-active toc-link level2">4.1 Units单位</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-3-网络相关配置" class="router-link-active router-link-exact-active toc-link level2">4.3 网络相关配置</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-3-1-bind" class="router-link-active router-link-exact-active toc-link level3">4.3.1 bind</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-3-2-protected-mode" class="router-link-active router-link-exact-active toc-link level3">4.3.2 protected-mode</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-3-3-port" class="router-link-active router-link-exact-active toc-link level3">4.3.3 port</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-3-4-timeout" class="router-link-active router-link-exact-active toc-link level3">4.3.4 timeout</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-3-5-tcp-keepalive" class="router-link-active router-link-exact-active toc-link level3">4.3.5 tcp-keepalive</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-4-general通用" class="router-link-active router-link-exact-active toc-link level2">4.4 GENERAL通用</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-4-1-daemonize" class="router-link-active router-link-exact-active toc-link level3">4.4.1 daemonize</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-4-2-pidfile" class="router-link-active router-link-exact-active toc-link level3">4.4.2 pidfile</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-4-3-loglevel" class="router-link-active router-link-exact-active toc-link level3">4.4.3 loglevel</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-5-security安全" class="router-link-active router-link-exact-active toc-link level2">4.5 SECURITY安全</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-5-1-设置密码" class="router-link-active router-link-exact-active toc-link level3">4.5.1 设置密码</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-6-limits限制" class="router-link-active router-link-exact-active toc-link level2">4.6 LIMITS限制</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-6-1-maxclients" class="router-link-active router-link-exact-active toc-link level3">4.6.1 maxclients</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-6-2-maxmemory" class="router-link-active router-link-exact-active toc-link level3">4.6.2 maxmemory</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_4-6-3-maxmemory-policy" class="router-link-active router-link-exact-active toc-link level3">4.6.3 maxmemory-policy</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_5-1-测试" class="router-link-active router-link-exact-active toc-link level2">5.1 测试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_6-1-bitmaps" class="router-link-active router-link-exact-active toc-link level2">6.1 Bitmaps</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_6-1-1-命令" class="router-link-active router-link-exact-active toc-link level3">6.1.1 命令</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_6-2-hyperloglog" class="router-link-active router-link-exact-active toc-link level2">6.2 HyperLogLog</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_6-2-1-命令" class="router-link-active router-link-exact-active toc-link level3">6.2.1 命令</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_7-1-导包" class="router-link-active router-link-exact-active toc-link level2">7.1 导包</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_7-2-各种测试" class="router-link-active router-link-exact-active toc-link level2">7.2 各种测试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_7-3-连接redis注意事项" class="router-link-active router-link-exact-active toc-link level2">7.3 连接Redis注意事项</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_7-4-手机验证码实例" class="router-link-active router-link-exact-active toc-link level2">7.4 手机验证码实例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_8-1-引入依赖" class="router-link-active router-link-exact-active toc-link level2">8.1 引入依赖</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_8-2-配置文件" class="router-link-active router-link-exact-active toc-link level2">8.2 配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_8-3-测试" class="router-link-active router-link-exact-active toc-link level2">8.3 测试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_9-1-multi、exec、discard" class="router-link-active router-link-exact-active toc-link level2">9.1 Multi、Exec、discard</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_9-2-事务的错误处理" class="router-link-active router-link-exact-active toc-link level2">9.2 事务的错误处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_9-3-乐观锁和悲观锁" class="router-link-active router-link-exact-active toc-link level2">9.3 乐观锁和悲观锁</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_10-1-rdb" class="router-link-active router-link-exact-active toc-link level2">10.1 RDB</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_10-2-备份是如何执行的" class="router-link-active router-link-exact-active toc-link level2">10.2 备份是如何执行的</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_10-3-aof-append-only-file" class="router-link-active router-link-exact-active toc-link level2">10.3 AOF（Append Only File）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_11-1-部署流程" class="router-link-active router-link-exact-active toc-link level2">11.1 部署流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_11-2-复制原理" class="router-link-active router-link-exact-active toc-link level2">11.2 复制原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_11-3-哨兵模式-sentinel" class="router-link-active router-link-exact-active toc-link level2">11.3 哨兵模式(sentinel)</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_11-3-1-初始环境" class="router-link-active router-link-exact-active toc-link level3">11.3.1 初始环境</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_11-3-2-部署" class="router-link-active router-link-exact-active toc-link level3">11.3.2 部署</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_11-3-3-启动哨兵" class="router-link-active router-link-exact-active toc-link level3">11.3.3 启动哨兵</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_12-1-出现的问题" class="router-link-active router-link-exact-active toc-link level2">12.1 出现的问题</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_12-2-初始化环境" class="router-link-active router-link-exact-active toc-link level2">12.2 初始化环境</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_12-3-将6个结点合成一个集群" class="router-link-active router-link-exact-active toc-link level2">12.3 将6个结点合成一个集群</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_12-4-集群常用操作" class="router-link-active router-link-exact-active toc-link level2">12.4 集群常用操作</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_13-1-缓存穿透" class="router-link-active router-link-exact-active toc-link level2">13.1 缓存穿透</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_13-1-1-解决方案" class="router-link-active router-link-exact-active toc-link level3">13.1.1 解决方案</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_13-2-缓存击穿" class="router-link-active router-link-exact-active toc-link level2">13.2 缓存击穿</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_13-2-1-解决方案" class="router-link-active router-link-exact-active toc-link level3">13.2.1 解决方案</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_13-3-缓存雪崩" class="router-link-active router-link-exact-active toc-link level2">13.3 缓存雪崩</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/redis/#_13-3-1-解决方案" class="router-link-active router-link-exact-active toc-link level3">13.3.1 解决方案</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="一、nosql数据库简介" tabindex="-1"><a class="header-anchor" href="#一、nosql数据库简介" aria-hidden="true">#</a> 一、NoSQL数据库简介</h1><h2 id="_1-1-nosql数据库" tabindex="-1"><a class="header-anchor" href="#_1-1-nosql数据库" aria-hidden="true">#</a> 1.1 NoSql数据库</h2><h3 id="_1-1-1-概述" tabindex="-1"><a class="header-anchor" href="#_1-1-1-概述" aria-hidden="true">#</a> 1.1.1 概述</h3><blockquote><p>ACID是衡量事务的四个特性：</p><ul><li>原子性（Atomicity，或称不可分割性）</li><li>一致性（Consistency）</li><li>隔离性（Isolation）</li><li>持久性（Durability）</li></ul></blockquote><blockquote><p>非关系型数据库就是没用遵循关系代数模式的数据库。举一些例子：</p><ol><li><p>文档数据库，没研究过定义，通常mongodb 就是文档数据库，特点就是数据定义比较灵活。</p></li><li><p>Kv数据库，提供的是kv的数据表示模式。单机的rocksdb，分布式的tikv之类。</p></li><li><p>图数据库。数据可以用图来定义。</p></li><li><p>列式数据库。hbase之类，这里可能有争议，很多人把hbase 定义为列存</p></li></ol></blockquote><p>NoSQL(NoSQL = <strong>Not Only SQL</strong> )，意即“不仅仅是SQL”，泛指<strong>非关系型的数据库</strong>。</p><p>NoSQL 不依赖业务逻辑方式存储，而以简单的<mark>key-value</mark>模式存储。因此大大的增加了数据库的扩展能力。</p><ul><li><strong>不遵循SQL标准。</strong></li><li>不支持ACID。</li><li>远超于SQL的性能。</li></ul><h3 id="_1-1-2-nosql适用场景" tabindex="-1"><a class="header-anchor" href="#_1-1-2-nosql适用场景" aria-hidden="true">#</a> 1.1.2 NoSQL适用场景</h3><ul><li>对数据高并发的读写</li><li>海量数据的读写</li><li>对数据高可扩展性的</li></ul><h3 id="_1-1-3-nosql不适用场景" tabindex="-1"><a class="header-anchor" href="#_1-1-3-nosql不适用场景" aria-hidden="true">#</a> 1.1.3 NoSQL不适用场景</h3><ul><li>需要事务支持</li><li>基于sql的结构化查询存储，处理复杂的关系,需要即席查询。</li><li>（用不着sql的和用了sql也不行的情况，请考虑用NoSql）</li></ul><h3 id="_1-1-4-常见的nosql" tabindex="-1"><a class="header-anchor" href="#_1-1-4-常见的nosql" aria-hidden="true">#</a> 1.1.4 常见的NoSql</h3><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307163845327.png" alt="image-20220307163845327" tabindex="0" loading="lazy"><figcaption>image-20220307163845327</figcaption></figure><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307163934525.png" alt="image-20220307163934525" tabindex="0" loading="lazy"><figcaption>image-20220307163934525</figcaption></figure><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307164111312.png" alt="image-20220307164111312" tabindex="0" loading="lazy"><figcaption>image-20220307164111312</figcaption></figure><p>HBase的目标就是处理数据量<strong>非常庞大</strong>的表，可以用<strong>普通的计算机</strong>处理超过<strong>10</strong>亿行数据**，还可处理有数百万**列元素的数据表。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307164133010.png" alt="image-20220307164133010" tabindex="0" loading="lazy"><figcaption>image-20220307164133010</figcaption></figure><blockquote><p>计算机存储单位 计算机存储单位一般用B，KB，MB，GB，TB，EB，ZB，YB，BB来表示，它们之间的关系是：</p><p>位 bit (比特)(Binary Digits)：存放一位二进制数，即 0 或 1，最小的存储单位。</p><p>字节 byte：8个二进制位为一个字节(B)，最常用的单位。</p><p>1KB (Kilobyte 千字节)=1024B，</p><p>1MB (Megabyte 兆字节 简称“兆”)=1024KB，</p><p>1GB (Gigabyte 吉字节 又称“千兆”)=1024MB，</p><p>1TB (Trillionbyte 万亿字节 太字节)=1024GB，其中1024=2^10 ( 2 的10次方)，</p><p>1PB（Petabyte 千万亿字节 拍字节）=1024TB，</p><p>1EB（Exabyte 百亿亿字节 艾字节）=1024PB，</p><p>1ZB (Zettabyte 十万亿亿字节 泽字节)= 1024 EB,</p><p>1YB (Jottabyte 一亿亿亿字节 尧字节)= 1024 ZB,</p><p>1BB (Brontobyte 一千亿亿亿字节)= 1024 YB.</p><p>注：“兆”为百万级数量单位。</p></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307164213324.png" alt="image-20220307164213324" tabindex="0" loading="lazy"><figcaption>image-20220307164213324</figcaption></figure><h1 id="二、概述安装" tabindex="-1"><a class="header-anchor" href="#二、概述安装" aria-hidden="true">#</a> 二、概述安装</h1><ul><li>Redis是一个开源的key-value存储系统。</li><li>和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set --有序集合)和hash（哈希类型）。</li><li>这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。</li><li>在此基础上，Redis支持各种不同方式的排序。</li><li>与memcached一样，为了保证效率，数据都是缓存在内存中。</li><li>区别的是Redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件。</li><li>并且在此基础上实现了master-slave(主从)同步。</li></ul><h2 id="_2-1-应用场景" tabindex="-1"><a class="header-anchor" href="#_2-1-应用场景" aria-hidden="true">#</a> 2.1 应用场景</h2><h3 id="_2-1-1-配合关系型数据库做高速缓存" tabindex="-1"><a class="header-anchor" href="#_2-1-1-配合关系型数据库做高速缓存" aria-hidden="true">#</a> 2.1.1 配合关系型数据库做高速缓存</h3><ul><li>高频次，热门访问的数据，降低数据库IO</li><li>分布式架构，做session共享</li></ul><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307171123625.png" alt="image-20220307171123625" tabindex="0" loading="lazy"><figcaption>image-20220307171123625</figcaption></figure><h3 id="_2-1-2-多样的数据结构存储持久化数据" tabindex="-1"><a class="header-anchor" href="#_2-1-2-多样的数据结构存储持久化数据" aria-hidden="true">#</a> 2.1.2 多样的数据结构存储持久化数据</h3><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307171156623.png" alt="image-20220307171156623" tabindex="0" loading="lazy"><figcaption>image-20220307171156623</figcaption></figure><h2 id="_2-2-安装redis" tabindex="-1"><a class="header-anchor" href="#_2-2-安装redis" aria-hidden="true">#</a> 2.2 安装redis</h2><blockquote><p>咱们在linux中安装</p></blockquote><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install centos-release-scl scl-utils-build

yum install -y devtoolset-8-toolchain

scl enable devtoolset-8 bash

测试 gcc版本 

gcc --version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307171301179.png" alt="image-20220307171301179" tabindex="0" loading="lazy"><figcaption>image-20220307171301179</figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>下载redis-6.2.1.tar.gz放/opt目录
解压命令: tar —zxvf redis-6.2.1.tar.gz
解压完成后进入目录: cd redis-6.2.1
在redis-6.2.1目录下再次执行make命令（只是编译好）
继续执行: make install

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看默认安装目录：</p><p>redis-benchmark:性能测试工具，可以在自己本子运行，看看自己本子性能如何</p><p>redis-check-aof：修复有问题的AOF文件，rdb和aof后面讲</p><p>redis-check-dump：修复有问题的dump.rdb文件</p><p>redis-sentinel：Redis集群使用</p><p><strong>redis-server：Redis服务器启动命令</strong></p><p><strong>redis-cli：客户端，操作入口</strong></p><h3 id="_2-2-1-前台启动" tabindex="-1"><a class="header-anchor" href="#_2-2-1-前台启动" aria-hidden="true">#</a> 2.2.1 前台启动</h3><p>前台启动，命令行窗口不能关闭，否则服务器停止</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307171543412.png" alt="image-20220307171543412" tabindex="0" loading="lazy"><figcaption>image-20220307171543412</figcaption></figure><h3 id="_2-2-2-后台启动" tabindex="-1"><a class="header-anchor" href="#_2-2-2-后台启动" aria-hidden="true">#</a> 2.2.2 后台启动</h3><p>修改redis.conf(128行)文件将里面的<strong>daemonize no 改成 yes</strong>，让服务在后台启动</p><h3 id="_2-2-3-测试" tabindex="-1"><a class="header-anchor" href="#_2-2-3-测试" aria-hidden="true">#</a> 2.2.3 测试</h3><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307171731431.png" alt="image-20220307171731431" tabindex="0" loading="lazy"><figcaption>image-20220307171731431</figcaption></figure><p><strong>单实例关闭：redis-cli shutdown</strong></p><p><strong>多实例关闭，指定端口关闭：redis-cli -p 6379 shutdown</strong></p><h3 id="_2-2-4-端口6379从何而来" tabindex="-1"><a class="header-anchor" href="#_2-2-4-端口6379从何而来" aria-hidden="true">#</a> 2.2.4 端口6379从何而来</h3><p><a href="https://link.zhihu.com/?target=http%3A//it.wikipedia.org/wiki/Alessia_Merz" target="_blank" rel="noopener noreferrer">Alessia Merz<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 是一位意大利舞女、女演员。</p><p>后来 Antirez 重新定义了 &quot;MERZ&quot; ，形容”具有很高的技术价值，包含技艺、耐心和劳动，但仍然保持简单本质“。</p><p>到了给 Redis 选择一个数字作为默认端口号时，Antirez 没有多想，把 &quot;MERZ&quot; 在手机键盘上对应的数字 6379 拿来用了。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307181837325.png" alt="image-20220307181837325" tabindex="0" loading="lazy"><figcaption>image-20220307181837325</figcaption></figure><p>默认16个数据库，类似数组下标从0开始，<strong>初始默认使用0号库</strong></p><p>使用命令 select &lt;dbid&gt;来切换数据库。如: select 8</p><p>统一密码管理，所有库同样密码。</p><p>dbsize查看当前数据库的key的数量</p><p>flushdb清空当前库</p><p>flushall通杀全部库</p><p>Redis是单线程+多路IO复用技术</p><p>多路复用是指使用一个线程来检查多个文件描述符（Socket）的就绪状态，比如调用select和poll函数，传入多个文件描述符，如果有一个文件描述符就绪，则返回，否则阻塞直到超时。得到就绪状态后进行真正的操作可以在同一个线程里执行，也可以启动线程执行（比如使用线程池）</p><p>串行 vs 多线程+锁（memcached） vs 单线程+多路IO复用(Redis)</p><p>与Memcache三点不同: 支持多数据类型，支持持久化，单线程+多路IO复用</p><h1 id="三、常用五大数据类型" tabindex="-1"><a class="header-anchor" href="#三、常用五大数据类型" aria-hidden="true">#</a> 三、常用五大数据类型</h1><p><a href="http://www.redis.cn/commands.html" target="_blank" rel="noopener noreferrer">Redis命令中心（Redis commands） -- Redis中国用户组（CRUG）<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="_3-1-redis键-key" tabindex="-1"><a class="header-anchor" href="#_3-1-redis键-key" aria-hidden="true">#</a> 3.1 Redis键(key)</h2><p>keys *查看当前库所有key (匹配：keys *1)</p><p>exists key判断某个key是否存在</p><p>type key 查看你的key是什么类型</p><p>del key 删除指定的key数据</p><p>unlink key 根据value选择非阻塞删除</p><p>仅将keys从keyspace元数据中删除，真正的删除会在后续异步操作。</p><p>expire key 10 10秒钟：为给定的key设置过期时间</p><p>ttl key 查看还有多少秒过期，-1表示永不过期，-2表示已过期</p><p>select命令切换数据库</p><p>dbsize查看当前数据库的key的数量</p><p>flushdb清空当前库</p><p>flushall通杀全部库</p><h2 id="_3-2-redis字符串" tabindex="-1"><a class="header-anchor" href="#_3-2-redis字符串" aria-hidden="true">#</a> 3.2 Redis字符串</h2><blockquote><p><strong>原子性</strong></p><p>所谓<strong>原子</strong>操作是指不会被线程调度机制打断的操作；</p><p>这种操作一旦开始，就一直运行到结束，中间不会有任何 context switch （切换到另一个线程）。</p><p>（1）在单线程中， 能够在单条指令中完成的操作都可以认为是&quot;原子操作&quot;，因为中断只能发生于指令之间。</p><p>（2）在多线程中，不能被其它进程（线程）打断的操作就叫原子操作。</p><p>Redis单命令的原子性主要得益于Redis的单线程。</p></blockquote><p>String是Redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。</p><p>String类型<mark>是二进制安全的</mark>。意味着Redis的string可以包含任何数据。比如jpg图片或者序列化的对象。</p><p>String类型是Redis最基本的数据类型，一个Redis中字符串value最多可以是<mark>512M</mark></p><h3 id="_3-2-1-常用命令" tabindex="-1"><a class="header-anchor" href="#_3-2-1-常用命令" aria-hidden="true">#</a> 3.2.1 常用命令</h3><p>set &lt;key&gt;&lt;value&gt;添加键值对</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307215018015.png" alt="image-20220307215018015" tabindex="0" loading="lazy"><figcaption>image-20220307215018015</figcaption></figure><p>*NX：当数据库中key不存在时，可以将key-value添加数据库</p><p>*XX：当数据库中key存在时，可以将key-value添加数据库，与NX参数互斥</p><p>*EX：key的超时秒数</p><p>*PX：key的超时毫秒数，与EX互斥</p><p>get &lt;key&gt;查询对应键值</p><p>append &lt;key&gt;&lt;value&gt;将给定的&lt;value&gt; 追加到原值的末尾</p><p>strlen &lt;key&gt;获得值的长度</p><p>setnx &lt;key&gt;&lt;value&gt;只有在 key 不存在时 设置 key 的值</p><p>incr &lt;key&gt;</p><p>将 key 中储存的数字值增1</p><p>只能对数字值操作，如果为空，新增值为1</p><p>decr &lt;key&gt;</p><p>将 key 中储存的数字值减1</p><p>只能对数字值操作，如果为空，新增值为-1</p><p>incrby / decrby &lt;key&gt;&lt;步长&gt;将 key 中储存的数字值增减。自定义步长。</p><p>mset <code>&lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;</code> .....</p><p>同时设置一个或多个 key-value对</p><p>mget <code>&lt;key1&gt;&lt;key2&gt;&lt;key3&gt;</code> .....</p><p>同时获取一个或多个 value</p><p>msetnx <code>&lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;</code> .....</p><p>同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在。</p><p><strong>原子性，有一个失败则都失败</strong></p><p>getrange &lt;key&gt;&lt;起始位置&gt;&lt;结束位置&gt;</p><p>获得值的范围，类似java中的substring，<strong>前包，后包</strong></p><p>setrange &lt;key&gt;&lt;起始位置&gt;&lt;value&gt;</p><p>用 &lt;value&gt; 覆写&lt;key&gt;所储存的字符串值，从&lt;起始位置&gt;开始(<strong>索引从0</strong>开始)。</p><p>**setex &lt;key&gt;&lt;**过期时间&gt;&lt;value&gt;</p><p>设置键值的同时，设置过期时间，单位秒。</p><p>getset <code>&lt;key&gt;&lt;value&gt;</code></p><p>以新换旧，设置了新值同时获得旧值。</p><h3 id="_3-2-2-数据结构" tabindex="-1"><a class="header-anchor" href="#_3-2-2-数据结构" aria-hidden="true">#</a> 3.2.2 数据结构</h3><p>String的数据结构为简单动态字符串(Simple Dynamic String,缩写SDS)。是可以修改的字符串，内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307215733145.png" alt="image-20220307215733145" tabindex="0" loading="lazy"><figcaption>image-20220307215733145</figcaption></figure><p>如图中所示，内部为当前字符串实际分配的空间capacity一般要高于实际字符串长度len。当字符串长度小于1M时，扩容都是加倍现有的空间，如果超过1M，扩容时一次只会多扩1M的空间。需要注意的是字符串最大长度为512M。</p><h2 id="_3-3-redis列表-list" tabindex="-1"><a class="header-anchor" href="#_3-3-redis列表-list" aria-hidden="true">#</a> 3.3 Redis列表（List）</h2><p>单键多值</p><p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。</p><p>它的底层实际是个<strong>双向链表</strong>，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307215808238.png" alt="image-20220307215808238" tabindex="0" loading="lazy"><figcaption>image-20220307215808238</figcaption></figure><h3 id="_3-3-1-常用命令" tabindex="-1"><a class="header-anchor" href="#_3-3-1-常用命令" aria-hidden="true">#</a> 3.3.1 常用命令</h3><p><code>lpush/rpush &lt;key&gt;&lt;value1&gt;&lt;value2&gt;&lt;value3&gt; .... 从左边/右边插入一个或多个值。</code></p><p><code>lpop/rpop &lt;key&gt;从左边/右边吐出一个值。值在键在，值光键亡。</code></p><p><code>rpoplpush &lt;key1&gt;&lt;key2&gt;从&lt;key1&gt;列表右边吐出一个值，插到&lt;key2&gt;列表左边。</code></p><p><code>lrange &lt;key&gt;&lt;start&gt;&lt;stop&gt;</code></p><p><code>按照索引下标获得元素(从左到右)</code></p><p><code>lrange mylist 0 -1 0左边第一个，-1右边第一个，（0-1表示获取所有）</code></p><p><code>lindex &lt;key&gt;&lt;index&gt;按照索引下标获得元素(从左到右)</code></p><p><code>llen &lt;key&gt;获得列表长度 </code></p><p><code>linsert &lt;key&gt; before &lt;value&gt;&lt;newvalue&gt;在&lt;value&gt;的后面插入&lt;newvalue&gt;插入值</code></p><p><code>lrem &lt;key&gt;&lt;n&gt;&lt;value&gt;从左边删除n个value(从左到右)</code></p><p><code>lset&lt;key&gt;&lt;index&gt;&lt;value&gt;将列表key下标为index的值替换成value</code></p><h3 id="_3-3-2-数据结构" tabindex="-1"><a class="header-anchor" href="#_3-3-2-数据结构" aria-hidden="true">#</a> 3.3.2 数据结构</h3><p>List的数据结构为快速链表quickList。</p><p>首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是ziplist，也即是压缩列表。</p><p>它将所有的元素紧挨着一起存储，分配的是一块连续的内存。</p><p>当数据量比较多的时候才会改成quicklist。</p><p>因为普通的链表需要的附加指针空间太大，会比较浪费空间。比如这个列表里存的只是int类型的数据，结构上还需要两个额外的指针prev和next。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307215937317.png" alt="image-20220307215937317" tabindex="0" loading="lazy"><figcaption>image-20220307215937317</figcaption></figure><p>Redis将链表和ziplist结合起来组成了quicklist。也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的空间冗余。</p><h2 id="_3-4-redis集合-set" tabindex="-1"><a class="header-anchor" href="#_3-4-redis集合-set" aria-hidden="true">#</a> 3.4 Redis集合(Set)</h2><p>Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以<strong>自动排重</strong>的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。</p><p>Redis的Set是string类型的<strong>无序集合。它底层其实是一个value为null的hash表</strong>，所以添加，删除，查找的复杂度都是O(1)。</p><p>一个算法，随着数据的增加，执行时间的长短，如果是O(1)，数据增加，查找数据的时间不变</p><h3 id="_3-4-1-常用命令" tabindex="-1"><a class="header-anchor" href="#_3-4-1-常用命令" aria-hidden="true">#</a> 3.4.1 常用命令</h3><p><code>sadd &lt;key&gt;&lt;value1&gt;&lt;value2&gt; ..... </code></p><p>将一个或多个 member 元素加入到集合 key 中，已经存在的 member 元素将被忽略</p><p><code>smembers &lt;key&gt;取出该集合的所有值。</code></p><p><code>sismember &lt;key&gt;&lt;value&gt;判断集合&lt;key&gt;是否为含有该&lt;value&gt;值，有1，没有0</code></p><p><code>scard&lt;key&gt;返回该集合的元素个数。</code></p><p><code>srem &lt;key&gt;&lt;value1&gt;&lt;value2&gt; .... 删除集合中的某个元素。</code></p><p><code>spop &lt;key&gt;**随机从该集合中吐出一个值。</code>**</p><p><code>srandmember &lt;key&gt;&lt;n&gt;随机从该集合中取出n个值。不会从集合中删除 。</code></p><p><code>smove &lt;source&gt;&lt;destination&gt;value把集合中一个值从一个集合移动到另一个集合</code></p><p><code>sinter &lt;key1&gt;&lt;key2&gt;返回两个集合的交集元素。</code></p><p><code>sunion &lt;key1&gt;&lt;key2&gt;返回两个集合的并集元素。</code></p><p><code>sdiff &lt;key1&gt;&lt;key2&gt;返回两个集合的**差集**元素(key1中的，不包含key2中的)</code></p><p>Set数据结构是dict字典，字典是用哈希表实现的。</p><p>Java中HashSet的内部实现使用的是HashMap，只不过所有的value都指向同一个对象。Redis的set结构也是一样，它的内部也使用hash结构，所有的value都指向同一个内部值。</p><h2 id="_3-5-redis哈希-hash" tabindex="-1"><a class="header-anchor" href="#_3-5-redis哈希-hash" aria-hidden="true">#</a> 3.5 Redis哈希(Hash)</h2><p>Redis hash 是一个键值对集合。</p><p>Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。</p><p>类似Java里面的Map&lt;String,Object&gt;</p><p>用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息，如果用普通的key/value结构来存储</p><p>主要有以下2种存储方式：</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307220408245.png" alt="image-20220307220408245" tabindex="0" loading="lazy"><figcaption>image-20220307220408245</figcaption></figure><h3 id="_3-5-1-常用命令" tabindex="-1"><a class="header-anchor" href="#_3-5-1-常用命令" aria-hidden="true">#</a> 3.5.1 常用命令</h3><p><code>hset &lt;key&gt;&lt;field&gt;&lt;value&gt;给&lt;key&gt;集合中的 &lt;field&gt;键赋值&lt;value&gt;</code></p><p><code>hget &lt;key1&gt;&lt;field&gt;从&lt;key1&gt;集合&lt;field&gt;取出 value </code></p><p><code>hmset &lt;key1&gt;&lt;field1&gt;&lt;value1&gt;&lt;field2&gt;&lt;value2&gt;... 批量设置hash的值</code></p><p><code>hexists&lt;key1&gt;&lt;field&gt;查看哈希表 key 中，给定域 field 是否存在。</code></p><p><code>hkeys &lt;key&gt;列出该hash集合的所有field</code></p><p><code>hvals &lt;key&gt;列出该hash集合的所有value</code></p><p><code>hincrby &lt;key&gt;&lt;field&gt;&lt;increment&gt;为哈希表 key 中的域 field 的值加上增量 1 -1</code></p><p><code>hsetnx &lt;key&gt;&lt;field&gt;&lt;value&gt;将哈希表 key 中的域 field 的值设置为 value ，当且仅当域 field 不存在 .</code></p><p>Hash类型对应的数据结构是两种：ziplist（压缩列表），hashtable（哈希表）。当field-value长度较短且个数较少时，使用ziplist，否则使用hashtable。</p><h2 id="_3-6-redis有序集合zset" tabindex="-1"><a class="header-anchor" href="#_3-6-redis有序集合zset" aria-hidden="true">#</a> 3.6 Redis有序集合Zset</h2><p>Redis有序集合zset与普通集合set非常相似，是一个<strong>没有重复元素</strong>的字符串集合。</p><p>不同之处是有序集合的每个成员都关联了一个**评分（score）,这个评分（score）被用来按照从最低分到最高分的方式排序集合中的成员。**集合的成员是唯一的，但是评分可以是重复了 。</p><p>因为元素是有序的, 所以你也可以很快的根据评分（score）或者次序（position）来获取一个范围的元素。</p><p>访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。</p><h3 id="_3-6-1-常用命令" tabindex="-1"><a class="header-anchor" href="#_3-6-1-常用命令" aria-hidden="true">#</a> 3.6.1 常用命令</h3><p><code>zadd &lt;key&gt;&lt;score1&gt;&lt;value1&gt;&lt;score2&gt;&lt;value2&gt;…</code></p><p><code>将一个或多个 member 元素及其 score 值加入到有序集 key 当中。</code></p><p><code>**zrange &lt;key&gt;&lt;start&gt;&lt;stop&gt; [WITHSCORES]** </code></p><p><code>返回有序集 key 中，下标在&lt;start&gt;&lt;stop&gt;之间的元素</code></p><p><code>带WITHSCORES，可以让分数一起和值返回到结果集。</code></p><p><code>zrangebyscore key minmax [withscores] [limit offset count]</code></p><p>返回有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。有序集成员按 score 值递增(从小到大)次序排列。</p><p>zrevrangebyscore key maxmin [withscores] [limit offset count]</p><p>同上，改为从大到小排列。</p><p><code>zincrby &lt;key&gt;&lt;increment&gt;&lt;value&gt; 为元素的score加上增量</code></p><p><code>zrem &lt;key&gt;&lt;value&gt;删除该集合下，指定值的元素</code></p><p><code>zcount &lt;key&gt;&lt;min&gt;&lt;max&gt;统计该集合，分数区间内的元素个数 </code></p><p><code>zrank &lt;key&gt;&lt;value&gt;返回该值在集合中的排名，从0开始。</code></p><p>案例：如何利用zset实现一个文章访问量的排行榜？</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307221417514.png" alt="image-20220307221417514" tabindex="0" loading="lazy"><figcaption>image-20220307221417514</figcaption></figure><p>SortedSet(zset)是Redis提供的一个非常特别的数据结构，一方面它等价于Java的数据结构Map&lt;String, Double&gt;，可以给每一个元素value赋予一个权重score，另一方面它又类似于TreeSet，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。</p><p>zset底层使用了两个数据结构</p><p>（1）hash，hash的作用就是关联元素value和权重score，保障元素value的唯一性，可以通过元素value找到相应的score值。</p><p>（2）跳跃表，跳跃表的目的在于给元素value排序，根据score的范围获取元素列表。</p><h1 id="四、配置文件介绍" tabindex="-1"><a class="header-anchor" href="#四、配置文件介绍" aria-hidden="true">#</a> 四、配置文件介绍</h1><h2 id="_4-1-units单位" tabindex="-1"><a class="header-anchor" href="#_4-1-units单位" aria-hidden="true">#</a> 4.1 Units单位</h2><p>配置大小单位,开头定义了一些基本的度量单位，只支持bytes，不支持bit</p><p>大小写不敏感</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307221522940.png" alt="image-20220307221522940" tabindex="0" loading="lazy"><figcaption>image-20220307221522940</figcaption></figure><p>4.2 INCLUDES包含</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307221536456.png" alt="image-20220307221536456" tabindex="0" loading="lazy"><figcaption>image-20220307221536456</figcaption></figure><p>类似jsp中的include，多实例的情况可以把公用的配置文件提取出来</p><h2 id="_4-3-网络相关配置" tabindex="-1"><a class="header-anchor" href="#_4-3-网络相关配置" aria-hidden="true">#</a> 4.3 网络相关配置</h2><h3 id="_4-3-1-bind" tabindex="-1"><a class="header-anchor" href="#_4-3-1-bind" aria-hidden="true">#</a> 4.3.1 bind</h3><p>默认情况bind=127.0.0.1只能接受本机的访问请求</p><p>不写的情况下，无限制接受任何ip地址的访问</p><p>生产环境肯定要写你应用服务器的地址；服务器是需要远程访问的，所以需要将其注释掉</p><p><strong>如果开启了protected-mode，那么在没有设定bind ip且没有设密码的情况下，Redis只允许接受本机的响应</strong></p><p>保存配置，停止服务，重启启动查看进程，不再是本机访问了。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307221731444.png" alt="image-20220307221731444" tabindex="0" loading="lazy"><figcaption>image-20220307221731444</figcaption></figure><h3 id="_4-3-2-protected-mode" tabindex="-1"><a class="header-anchor" href="#_4-3-2-protected-mode" aria-hidden="true">#</a> 4.3.2 protected-mode</h3><p>将本机访问保护模式设置 no</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307221739300.png" alt="image-20220307221739300" tabindex="0" loading="lazy"><figcaption>image-20220307221739300</figcaption></figure><h3 id="_4-3-3-port" tabindex="-1"><a class="header-anchor" href="#_4-3-3-port" aria-hidden="true">#</a> 4.3.3 port</h3><p>端口号，默认 6379</p><h3 id="_4-3-4-timeout" tabindex="-1"><a class="header-anchor" href="#_4-3-4-timeout" aria-hidden="true">#</a> 4.3.4 timeout</h3><p>一个空闲的客户端维持多少秒会关闭，0表示关闭该功能。即<strong>永不关闭</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307221825463.png" alt="image-20220307221825463" tabindex="0" loading="lazy"><figcaption>image-20220307221825463</figcaption></figure><h3 id="_4-3-5-tcp-keepalive" tabindex="-1"><a class="header-anchor" href="#_4-3-5-tcp-keepalive" aria-hidden="true">#</a> 4.3.5 tcp-keepalive</h3><p>对访问客户端的一种心跳检测，每个n秒检测一次。</p><p>单位为秒，如果设置为0，则不会进行Keepalive检测，建议设置成60</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307221851728.png" alt="image-20220307221851728" tabindex="0" loading="lazy"><figcaption>image-20220307221851728</figcaption></figure><h2 id="_4-4-general通用" tabindex="-1"><a class="header-anchor" href="#_4-4-general通用" aria-hidden="true">#</a> 4.4 GENERAL通用</h2><h3 id="_4-4-1-daemonize" tabindex="-1"><a class="header-anchor" href="#_4-4-1-daemonize" aria-hidden="true">#</a> 4.4.1 daemonize</h3><p>是否为后台进程，设置为yes</p><p>守护进程，后台启动</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307221941720.png" alt="image-20220307221941720" tabindex="0" loading="lazy"><figcaption>image-20220307221941720</figcaption></figure><h3 id="_4-4-2-pidfile" tabindex="-1"><a class="header-anchor" href="#_4-4-2-pidfile" aria-hidden="true">#</a> 4.4.2 pidfile</h3><p>存放pid文件的位置，每个实例会产生一个不同的pid文件</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222008641.png" alt="image-20220307222008641" tabindex="0" loading="lazy"><figcaption>image-20220307222008641</figcaption></figure><h3 id="_4-4-3-loglevel" tabindex="-1"><a class="header-anchor" href="#_4-4-3-loglevel" aria-hidden="true">#</a> 4.4.3 loglevel</h3><p>指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为<strong>notice</strong></p><p><strong>四个级别根据使用阶段来选择，生产环境选择notice 或者warning</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222042983.png" alt="image-20220307222042983" tabindex="0" loading="lazy"><figcaption>image-20220307222042983</figcaption></figure><h2 id="_4-5-security安全" tabindex="-1"><a class="header-anchor" href="#_4-5-security安全" aria-hidden="true">#</a> 4.5 SECURITY安全</h2><h3 id="_4-5-1-设置密码" tabindex="-1"><a class="header-anchor" href="#_4-5-1-设置密码" aria-hidden="true">#</a> 4.5.1 设置密码</h3><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222125672.png" alt="image-20220307222125672" tabindex="0" loading="lazy"><figcaption>image-20220307222125672</figcaption></figure><p>访问密码的查看、设置和取消</p><p>在命令中设置密码，只是临时的。重启redis服务器，密码就还原了。</p><p>永久设置，需要再配置文件中进行设置。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222132066.png" alt="image-20220307222132066" tabindex="0" loading="lazy"><figcaption>image-20220307222132066</figcaption></figure><h2 id="_4-6-limits限制" tabindex="-1"><a class="header-anchor" href="#_4-6-limits限制" aria-hidden="true">#</a> 4.6 LIMITS限制</h2><h3 id="_4-6-1-maxclients" tabindex="-1"><a class="header-anchor" href="#_4-6-1-maxclients" aria-hidden="true">#</a> 4.6.1 maxclients</h3><ul><li>设置redis同时可以与多少个客户端进行连接。</li><li>默认情况下为10000个客户端。</li><li>如果达到了此限制，redis则会拒绝新的连接请求，并且向这些连接请求方发出“max number of clients reached”以作回应。</li></ul><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222236574.png" alt="image-20220307222236574" tabindex="0" loading="lazy"><figcaption>image-20220307222236574</figcaption></figure><h3 id="_4-6-2-maxmemory" tabindex="-1"><a class="header-anchor" href="#_4-6-2-maxmemory" aria-hidden="true">#</a> 4.6.2 maxmemory</h3><p>建议<strong>必须设置</strong>，否则，将内存占满，造成服务器宕机</p><p>设置redis可以使用的内存量。一旦到达内存使用上限，redis将会试图移除内部数据，移除规则可以通过<strong>maxmemory-policy</strong>来指定。</p><p>如果redis无法根据移除规则来移除内存中的数据，或者设置了“不允许移除”，那么redis则会针对那些需要申请内存的指令返回错误信息，比如SET、LPUSH等。</p><p>但是对于无内存申请的指令，仍然会正常响应，比如GET等。如果你的redis是主redis（说明你的redis有从redis），那么在设置内存使用上限时，需要在系统中留出一些内存空间给同步队列缓存，只有在你设置的是“不移除”的情况下，才不用考虑这个因素。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222321503.png" alt="image-20220307222321503" tabindex="0" loading="lazy"><figcaption>image-20220307222321503</figcaption></figure><h3 id="_4-6-3-maxmemory-policy" tabindex="-1"><a class="header-anchor" href="#_4-6-3-maxmemory-policy" aria-hidden="true">#</a> 4.6.3 maxmemory-policy</h3><ul><li>volatile-lru：使用LRU算法移除key，只对设置了过期时间的键；（最近最少使用）</li><li>allkeys-lru：在所有集合key中，使用LRU算法移除key</li><li>volatile-random：在过期集合中移除随机的key，只对设置了过期时间的键</li><li>allkeys-random：在所有集合key中，移除随机的key</li><li>volatile-ttl：移除那些TTL值最小的key，即那些最近要过期的key</li><li>noeviction：不进行移除。针对写操作，只是返回错误信息</li></ul><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222425237.png" alt="image-20220307222425237" tabindex="0" loading="lazy"><figcaption>image-20220307222425237</figcaption></figure><h1 id="五、redis的发布和订阅" tabindex="-1"><a class="header-anchor" href="#五、redis的发布和订阅" aria-hidden="true">#</a> 五、Redis的发布和订阅</h1><p>Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。</p><p>Redis 客户端可以订阅任意数量的频道。</p><p>客户端可以订阅频道如下图</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222452820.png" alt="image-20220307222452820" tabindex="0" loading="lazy"><figcaption>image-20220307222452820</figcaption></figure><p>当给这个频道发布消息后，消息就会发送给订阅的客户端</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222505629.png" alt="image-20220307222505629" tabindex="0" loading="lazy"><figcaption>image-20220307222505629</figcaption></figure><h2 id="_5-1-测试" tabindex="-1"><a class="header-anchor" href="#_5-1-测试" aria-hidden="true">#</a> 5.1 测试</h2><p>打开一个客户端订阅channel1</p><p>SUBSCRIBE channel1</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222539767.png" alt="image-20220307222539767" tabindex="0" loading="lazy"><figcaption>image-20220307222539767</figcaption></figure><p>打开另一个客户端，给channel1发布消息hello</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222713187.png" alt="image-20220307222713187" tabindex="0" loading="lazy"><figcaption>image-20220307222713187</figcaption></figure><p>返回的1是订阅者数量</p><p>打开第一个客户端可以看到发送的消息</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222722811.png" alt="image-20220307222722811" tabindex="0" loading="lazy"><figcaption>image-20220307222722811</figcaption></figure><p>注：发布的消息没有持久化，如果在订阅的客户端收不到hello，只能收到订阅后发布的消息</p><h1 id="六、redis新数据类型" tabindex="-1"><a class="header-anchor" href="#六、redis新数据类型" aria-hidden="true">#</a> 六、Redis新数据类型</h1><h2 id="_6-1-bitmaps" tabindex="-1"><a class="header-anchor" href="#_6-1-bitmaps" aria-hidden="true">#</a> 6.1 Bitmaps</h2><p>现代计算机用二进制（位） 作为信息的基础单位， 1个字节等于8位， 例如“abc”字符串是由3个字节组成， 但实际在计算机存储时将其用二进制表示， “abc”分别对应的ASCII码分别是97、 98、 99， 对应的二进制分别是01100001、 01100010和01100011，如下图</p><p>​ <img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222837734.png" alt="image-20220307222837734" loading="lazy"></p><p>合理地使用操作位能够有效地提高内存使用率和开发效率。</p><p>Redis提供了Bitmaps这个“数据类型”可以实现对位的操作：</p><p>（1） Bitmaps本身不是一种数据类型， 实际上它就是字符串（key-value） ， 但是它可以对字符串的位进行操作。</p><p>（2） Bitmaps单独提供了一套命令， 所以在Redis中使用Bitmaps和使用字符串的方法不太相同。 可以把Bitmaps想象成一个以位为单位的数组， 数组的每个单元只能存储0和1， 数组的下标在Bitmaps中叫做偏移量。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307222841471.png" alt="image-20220307222841471" tabindex="0" loading="lazy"><figcaption>image-20220307222841471</figcaption></figure><h3 id="_6-1-1-命令" tabindex="-1"><a class="header-anchor" href="#_6-1-1-命令" aria-hidden="true">#</a> 6.1.1 命令</h3><p>setbit</p><p>（1）格式</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>setbit&lt;key&gt;&lt;offset&gt;&lt;value&gt;设置Bitmaps中某个偏移量的值（0或1）
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223000190.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>*offset:偏移量从0开始</p><p>（2）实例</p><p>每个独立用户是否访问过网站存放在Bitmaps中， 将访问的用户记做1， 没有访问的用户记做0， 用偏移量作为用户的id。</p><p>设置键的第offset个位的值（从0算起） ， 假设现在有20个用户，userid=1， 6， 11， 15， 19的用户对网站进行了访问， 那么当前Bitmaps初始化结果如图</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223023691.png" alt="image-20220307223023691" tabindex="0" loading="lazy"><figcaption>image-20220307223023691</figcaption></figure><p>unique:users:20201106代表2020-11-06这天的独立访问用户的Bitmaps</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223036588.png" alt="image-20220307223036423" tabindex="0" loading="lazy"><figcaption>image-20220307223036423</figcaption></figure><p>注：</p><p>很多应用的用户id以一个指定数字（例如10000） 开头， 直接将用户id和Bitmaps的偏移量对应势必会造成一定的浪费， 通常的做法是每次做setbit操作时将用户id减去这个指定数字。</p><p>在第一次初始化Bitmaps时， 假如偏移量非常大， 那么整个初始化过程执行会比较慢， 可能会造成Redis的阻塞。</p><p>2、getbit</p><p>（1）格式</p><p><code>getbit&lt;key&gt;&lt;offset&gt;获取Bitmaps中某个偏移量的值</code></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223101027.png" alt="image-20220307223101027" tabindex="0" loading="lazy"><figcaption>image-20220307223101027</figcaption></figure><p>获取键的第offset位的值（从0开始算）</p><p>（2）实例</p><p>获取id=8的用户是否在2020-11-06这天访问过， 返回0说明没有访问过：</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223120279.png" alt="image-20220307223120279" tabindex="0" loading="lazy"><figcaption>image-20220307223120279</figcaption></figure><p>注：因为100根本不存在，所以也是返回0</p><p>3、bitcount</p><p>统计<strong>字符串</strong>被设置为1的bit数。一般情况下，给定的整个字符串都会被进行计数，通过指定额外的 start 或 end 参数，可以让计数只在特定的位上进行。start 和 end 参数的设置，都可以使用负数值：比如 -1 表示最后一个位，而 -2 表示倒数第二个位，start、end 是指bit组的字节的下标数，二者皆包含。</p><p>（1）格式</p><p><code>bitcount&lt;key&gt;[start end] 统计字符串从start字节到end字节比特值为1的数量</code></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223213272.png" alt="image-20220307223213272" tabindex="0" loading="lazy"><figcaption>image-20220307223213272</figcaption></figure><p>（2）实例</p><p>计算2022-11-06这天的独立访问用户数量</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223223184.png" alt="image-20220307223223184" tabindex="0" loading="lazy"><figcaption>image-20220307223223184</figcaption></figure><p>start和end代表起始和结束字节数， 下面操作计算用户id在第1个字节到第3个字节之间的独立访问用户数， 对应的用户id是11， 15， 19。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223231831.png" alt="image-20220307223231831" tabindex="0" loading="lazy"><figcaption>image-20220307223231831</figcaption></figure><h2 id="_6-2-hyperloglog" tabindex="-1"><a class="header-anchor" href="#_6-2-hyperloglog" aria-hidden="true">#</a> 6.2 HyperLogLog</h2><p>在工作当中，我们经常会遇到与统计相关的功能需求，比如统计网站PV（PageView页面访问量）,可以使用Redis的incr、incrby轻松实现。</p><p>但像UV（UniqueVisitor，独立访客）、独立IP数、搜索记录数等需要去重和计数的问题如何解决？这种求集合中不重复元素个数的问题称为基数问题。</p><p>解决基数问题有很多种方案：</p><p>（1）数据存储在MySQL表中，使用distinct count计算不重复个数</p><p>（2）使用Redis提供的hash、set、bitmaps等数据结构来处理</p><p>以上的方案结果精确，但随着数据不断增加，导致占用空间越来越大，对于非常大的数据集是不切实际的。</p><p>什么是基数?</p><p>比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数。</p><h3 id="_6-2-1-命令" tabindex="-1"><a class="header-anchor" href="#_6-2-1-命令" aria-hidden="true">#</a> 6.2.1 命令</h3><p>1、pfadd</p><p>（1）格式</p><p><code>pfadd &lt;key&gt;&lt; element&gt; [element ...] 添加指定元素到 HyperLogLog 中</code></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223445184.png" alt="image-20220307223445184" tabindex="0" loading="lazy"><figcaption>image-20220307223445184</figcaption></figure><p>（2）实例</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223453591.png" alt="image-20220307223453591" tabindex="0" loading="lazy"><figcaption>image-20220307223453591</figcaption></figure><p>将所有元素添加到指定HyperLogLog数据结构中。如果执行命令后HLL估计的近似基数发生变化，则返回1，否则返回0。</p><p>2、pfcount</p><p>（1）格式</p><p><code>pfcount&lt;key&gt; [key ...] 计算HLL的近似基数，可以计算多个HLL，比如用HLL存储每天的UV，计算一周的UV可以使用7天的UV合并计算即可</code></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223517311.png" alt="image-20220307223517311" tabindex="0" loading="lazy"><figcaption>image-20220307223517311</figcaption></figure><p>（2）实例</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223523140.png" alt="image-20220307223523140" tabindex="0" loading="lazy"><figcaption>image-20220307223523140</figcaption></figure><p>3、pfmerge</p><p>（1）格式</p><p><code>pfmerge&lt;destkey&gt;&lt;sourcekey&gt; [sourcekey ...] 将一个或多个HLL合并后的结果存储在另一个HLL中，比如每月活跃用户可以使用每天的活跃用户来合并计算可得</code></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307223546882.png" alt="image-20220307223546882" tabindex="0" loading="lazy"><figcaption>image-20220307223546882</figcaption></figure><h1 id="七、jedis测试" tabindex="-1"><a class="header-anchor" href="#七、jedis测试" aria-hidden="true">#</a> 七、Jedis测试</h1><h2 id="_7-1-导包" tabindex="-1"><a class="header-anchor" href="#_7-1-导包" aria-hidden="true">#</a> 7.1 导包</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-2-各种测试" tabindex="-1"><a class="header-anchor" href="#_7-2-各种测试" aria-hidden="true">#</a> 7.2 各种测试</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>caq<span class="token punctuation">.</span>jedis</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisDemo1</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建jedis对象</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;172.20.10.9&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//测试</span>
        <span class="token class-name">String</span> ping <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ping<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//    操作zset</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo05</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;172.20.10.9&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;china&quot;</span><span class="token punctuation">,</span><span class="token number">100d</span><span class="token punctuation">,</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> china <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">&quot;china&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>china<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 操作hash</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo04</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;172.20.10.9&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;demo04&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hget <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">&quot;demo04&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hget<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//    操作set</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo03</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;172.20.10.9&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">&quot;demo03&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">&quot;demo03&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;monkey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> name <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">&quot;demo03&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//操作list</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;172.20.10.9&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">&quot;demo02&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lucy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> key1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">&quot;demo02&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


    <span class="token comment">//操作key</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建redis对象</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;172.20.10.9&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        Set&lt;String&gt; keys = jedis.keys(&quot;*&quot;);</span>
<span class="token comment">//        keys.forEach(x-&gt; System.out.println(x));</span>
<span class="token comment">//        添加</span>
<span class="token comment">//        jedis.set(&quot;name&quot;,&quot;jack&quot;);</span>
<span class="token comment">//        String name = jedis.get(&quot;name&quot;);</span>


<span class="token comment">//        添加多个key</span>
        jedis<span class="token punctuation">.</span><span class="token function">mset</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mget <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mget<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-3-连接redis注意事项" tabindex="-1"><a class="header-anchor" href="#_7-3-连接redis注意事项" aria-hidden="true">#</a> 7.3 连接Redis注意事项</h2><p>禁用Linux的防火墙：Linux(CentOS7)里执行命令</p><p><strong>systemctl stop/disable firewalld.service</strong></p><p>redis.conf中注释掉bind 127.0.0.1 ,然后 protected-mode no</p><h2 id="_7-4-手机验证码实例" tabindex="-1"><a class="header-anchor" href="#_7-4-手机验证码实例" aria-hidden="true">#</a> 7.4 手机验证码实例</h2><p>要求：</p><p>1、输入手机号，点击发送后随机生成6位数字码，2分钟有效</p><p>2、输入验证码，点击验证，返回成功或失败</p><p>3、每个手机号每天只能输入3次</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>caq<span class="token punctuation">.</span>jedis</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneCode</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//模拟验证码发送</span>
<span class="token comment">//        verifyCode(&quot;342352132&quot;);</span>

        <span class="token comment">//校验</span>
        <span class="token function">getRedisCode</span><span class="token punctuation">(</span><span class="token string">&quot;342352132&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;833731&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//1 生成6位数字验证码</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> rand <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            code <span class="token operator">+=</span> rand<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//2 每个手机每天只能发送三次，验证码放到redis中，设置超时时间</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">verifyCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        连接redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;10.216.54.73&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        拼接key</span>
<span class="token comment">//        手机发送次数key</span>
        <span class="token class-name">String</span> countKey <span class="token operator">=</span> <span class="token string">&quot;VerityCode&quot;</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">&quot;:count&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//        验证码key</span>
        <span class="token class-name">String</span> codeKey <span class="token operator">=</span> <span class="token string">&quot;VerityCode&quot;</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">&quot;:code&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//        每个手机每天只能发送三次</span>
        <span class="token class-name">String</span> count <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//            没有发送次数，第一次发送</span>
<span class="token comment">//            设置发送次数是1</span>
            jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>countKey<span class="token punctuation">,</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//            发送次数+1</span>
            jedis<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//            发送三次，不能再发送</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;今天发送次数已经超过三次&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//发送验证码放到redis里面</span>
        <span class="token class-name">String</span> vcode <span class="token operator">=</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> vcode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//    3 验证码校验</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getRedisCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//从redis获取验证码</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;10.216.54.73&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//验证码key</span>
        <span class="token class-name">String</span> codeKey <span class="token operator">=</span> <span class="token string">&quot;VerityCode&quot;</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">&quot;:code&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> redisCode <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisCode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="八、-redis与spring-boot整合" tabindex="-1"><a class="header-anchor" href="#八、-redis与spring-boot整合" aria-hidden="true">#</a> 八、 Redis与Spring Boot整合</h1><h2 id="_8-1-引入依赖" tabindex="-1"><a class="header-anchor" href="#_8-1-引入依赖" aria-hidden="true">#</a> 8.1 引入依赖</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- spring2.X集成redis所需common-pool2--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-2-配置文件" tabindex="-1"><a class="header-anchor" href="#_8-2-配置文件" aria-hidden="true">#</a> 8.2 配置文件</h2><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment">#Redis服务器地址</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 10.216.54.73
    <span class="token comment">#Redis服务器连接端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token comment">#Redis数据库索引（默认为0）</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token comment">#连接超时时间（毫秒）</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment">#连接池最大连接数（使用负值表示没有限制）</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">20</span>
        <span class="token comment">#最大阻塞等待时间(负数表示没限制)</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1</span>
        <span class="token comment">#最大阻塞等待时间(负数表示没限制)</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>
        <span class="token comment">#连接池中的最小空闲连接</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-3-测试" tabindex="-1"><a class="header-anchor" href="#_8-3-测试" aria-hidden="true">#</a> 8.3 测试</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>caq<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonAutoDetect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PropertyAccessor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">CacheManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">CachingConfigurerSupport</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableCaching</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">RedisCacheConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">RedisCacheManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">RedisConnectionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">Jackson2JsonRedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">RedisSerializationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">RedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//key序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//value序列化</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//value hashmap序列化</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//解决查询缓存转换异常的问题</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置序列化（解决乱码的问题）,过期时间600秒</span>
        <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">cacheDefaults</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cacheManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>RedisTestController中添加测试方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>caq<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/redisTest&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTestController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//设置值到redis</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        从redis获取值</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="九、redis事务" tabindex="-1"><a class="header-anchor" href="#九、redis事务" aria-hidden="true">#</a> 九、Redis事务</h1><blockquote><p>涉及到很多秒杀相关的实例，这里只做简单的介绍</p></blockquote><p>Redis事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</p><p>Redis事务的主要作用就是串联多个命令防止别的命令插队。</p><h2 id="_9-1-multi、exec、discard" tabindex="-1"><a class="header-anchor" href="#_9-1-multi、exec、discard" aria-hidden="true">#</a> 9.1 Multi、Exec、discard</h2><p>从输入Multi命令开始，输入的命令都会依次进入命令队列中，但不会执行，直到输入Exec后，Redis会将之前的命令队列中的命令依次执行。</p><p>组队的过程中可以通过discard来放弃组队。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307224415423.png" alt="image-20220307224415423" tabindex="0" loading="lazy"><figcaption>image-20220307224415423</figcaption></figure><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307224427082.png" alt="image-20220307224427082" tabindex="0" loading="lazy"><figcaption>image-20220307224427082</figcaption></figure><p>组队成功，提交成功</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307224433982.png" alt="image-20220307224433982" tabindex="0" loading="lazy"><figcaption>image-20220307224433982</figcaption></figure><p>组队阶段报错，提交失败</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307224441877.png" alt="image-20220307224441877" tabindex="0" loading="lazy"><figcaption>image-20220307224441877</figcaption></figure><p>组队成功，提交有成功有失败情况</p><h2 id="_9-2-事务的错误处理" tabindex="-1"><a class="header-anchor" href="#_9-2-事务的错误处理" aria-hidden="true">#</a> 9.2 事务的错误处理</h2><p>组队中某个命令出现了报告错误，执行时整个的所有队列都会被取消。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307224539207.png" alt="image-20220307224539207" tabindex="0" loading="lazy"><figcaption>image-20220307224539207</figcaption></figure><p>如果执行阶段某个命令报出了错误，则只有报错的命令不会被执行，而其他的命令都会执行，不会回滚。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307224553868.png" alt="image-20220307224553868" tabindex="0" loading="lazy"><figcaption>image-20220307224553868</figcaption></figure><h2 id="_9-3-乐观锁和悲观锁" tabindex="-1"><a class="header-anchor" href="#_9-3-乐观锁和悲观锁" aria-hidden="true">#</a> 9.3 乐观锁和悲观锁</h2><p>乐观锁和悲观锁是两种思想，用于解决并发场景下的数据竞争问题。</p><ul><li>乐观锁：乐观锁在操作数据时非常乐观，认为别人不会同时修改数据。因此乐观锁不会上锁，只是在执行更新的时候判断一下在此期间别人是否修改了数据：如果别人修改了数据则放弃操作，否则执行操作。</li><li>悲观锁：悲观锁在操作数据时比较悲观，认为别人会同时修改数据。因此操作数据时直接把数据锁住，直到操作完成后才会释放锁；上锁期间其他人不能修改数据。</li></ul><h1 id="十、redis持久化" tabindex="-1"><a class="header-anchor" href="#十、redis持久化" aria-hidden="true">#</a> 十、Redis持久化</h1><p>Redis 提供了2个不同形式的持久化方式。</p><ul><li>RDB（Redis DataBase）</li><li>AOF（Append Of File）</li></ul><h2 id="_10-1-rdb" tabindex="-1"><a class="header-anchor" href="#_10-1-rdb" aria-hidden="true">#</a> 10.1 RDB</h2><p>在指定的时间间隔内将内存中的数据集快照写入磁盘， 也就是行话讲的Snapshot快照，它恢复时是将快照文件直接读到内存里</p><h2 id="_10-2-备份是如何执行的" tabindex="-1"><a class="header-anchor" href="#_10-2-备份是如何执行的" aria-hidden="true">#</a> 10.2 备份是如何执行的</h2><p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到 一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。 整个过程中，主进程是不进行任何IO操作的，这就确保了极高的性能 如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。<strong>RDB</strong>的缺点是最后一次持久化后的数据可能丢失。</p><h2 id="_10-3-aof-append-only-file" tabindex="-1"><a class="header-anchor" href="#_10-3-aof-append-only-file" aria-hidden="true">#</a> 10.3 AOF（Append Only File）</h2><p>以<strong>日志</strong>的形式来记录每个写操作（增量保存），将Redis执行过的所有写指令记录下来(<strong>读操作不记录</strong>)， <strong>只许追加文件但不可以改写文件</strong>，redis启动之初会读取该文件重新构建数据，换言之，redis 重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p><h1 id="十一、redis主从" tabindex="-1"><a class="header-anchor" href="#十一、redis主从" aria-hidden="true">#</a> 十一、Redis主从</h1><p>主机数据更新后根据配置和策略， 自动同步到备机的master/slaver机制，Master以写为主，Slave以读为主</p><p>优点：</p><ul><li>读写分离，性能扩展</li><li>容灾快速恢复</li></ul><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307225345875.png" alt="image-20220307225345875" tabindex="0" loading="lazy"><figcaption>image-20220307225345875</figcaption></figure><h2 id="_11-1-部署流程" tabindex="-1"><a class="header-anchor" href="#_11-1-部署流程" aria-hidden="true">#</a> 11.1 部署流程</h2><p>拷贝多个redis.conf文件include(写绝对路径)</p><p>开启daemonize yes</p><p>Pid文件名字pidfile</p><p>指定端口port</p><p>Log文件名字</p><p>dump.rdb名字dbfilename</p><p>Appendonly 关掉或者换名字</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307225514719.png" alt="image-20220307225514719" tabindex="0" loading="lazy"><figcaption>image-20220307225514719</figcaption></figure><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307225520582.png" alt="image-20220307225520582" tabindex="0" loading="lazy"><figcaption>image-20220307225520582</figcaption></figure><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307225525729.png" alt="image-20220307225525729" tabindex="0" loading="lazy"><figcaption>image-20220307225525729</figcaption></figure><p>配从(库)不配主(库)</p><p><code>slaveof &lt;ip&gt;&lt;port&gt;</code></p><p>成为某个实例的从服务器</p><p>1、在6380和6381上执行: slaveof 127.0.0.1 6379</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307225720515.png" alt="image-20220307225720515" tabindex="0" loading="lazy"><figcaption>image-20220307225720515</figcaption></figure><p>2、在主机上写，在从机上可以读取数据</p><p>在从机上写数据报错</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307225751398.png" alt="image-20220307225751398" tabindex="0" loading="lazy"><figcaption>image-20220307225751398</figcaption></figure><p>3、主机挂掉，重启就行，一切如初</p><p>4、从机重启需重设：slaveof 127.0.0.1 6379</p><p>可以将配置增加到文件中。永久生效。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307225801577.png" alt="image-20220307225801577" tabindex="0" loading="lazy"><figcaption>image-20220307225801577</figcaption></figure><h2 id="_11-2-复制原理" tabindex="-1"><a class="header-anchor" href="#_11-2-复制原理" aria-hidden="true">#</a> 11.2 复制原理</h2><ol><li>Slave启动成功连接到master后会发送一个sync命令</li><li>Master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master将传送整个数据文件到slave,以完成一次完全同步</li><li>全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</li><li>增量复制：Master继续将新的所有收集到的修改命令依次传给slave,完成同步</li><li>但是只要是重新连接master,一次完全同步（全量复制)将被自动执行</li></ol><h2 id="_11-3-哨兵模式-sentinel" tabindex="-1"><a class="header-anchor" href="#_11-3-哨兵模式-sentinel" aria-hidden="true">#</a> 11.3 哨兵模式(sentinel)</h2><p><strong>能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307225853742.png" alt="image-20220307225853742" tabindex="0" loading="lazy"><figcaption>image-20220307225853742</figcaption></figure><h3 id="_11-3-1-初始环境" tabindex="-1"><a class="header-anchor" href="#_11-3-1-初始环境" aria-hidden="true">#</a> 11.3.1 初始环境</h3><h3 id="_11-3-2-部署" tabindex="-1"><a class="header-anchor" href="#_11-3-2-部署" aria-hidden="true">#</a> 11.3.2 部署</h3><p>自定义的/myredis目录下新建sentinel.conf文件，名字绝不能错</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>sentinel monitor mymaster 127.0.0.1 6379 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>其中mymaster为监控对象起的服务器名称， 1 为至少有多少个哨兵同意迁移的数量。</p><h3 id="_11-3-3-启动哨兵" tabindex="-1"><a class="header-anchor" href="#_11-3-3-启动哨兵" aria-hidden="true">#</a> 11.3.3 启动哨兵</h3><p>/usr/local/bin</p><p>redis做压测可以用自带的redis-benchmark工具</p><p>执行redis-sentinel /myredis/sentinel.conf</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307091149963.png" alt="image-20220307091149963" tabindex="0" loading="lazy"><figcaption>image-20220307091149963</figcaption></figure><p><strong>当主机挂掉，从机选举中产生新的主机</strong></p><p>(大概10秒左右可以看到哨兵窗口日志，切换了新的主机)</p><p>哪个从机会被选举为主机呢？根据优先级别：slave-priority</p><p>原主机重启后会变为从机。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307230131225.png" alt="image-20220307230131225" tabindex="0" loading="lazy"><figcaption>image-20220307230131225</figcaption></figure><h1 id="十二、redis集群" tabindex="-1"><a class="header-anchor" href="#十二、redis集群" aria-hidden="true">#</a> 十二、Redis集群</h1><h2 id="_12-1-出现的问题" tabindex="-1"><a class="header-anchor" href="#_12-1-出现的问题" aria-hidden="true">#</a> 12.1 出现的问题</h2><p>容量不够，redis如何进行扩容？</p><p>并发写操作， redis如何分摊？</p><p>之前通过代理主机来解决，但是redis3.0中提供了解决方案。就是无中心化集群配置。</p><h2 id="_12-2-初始化环境" tabindex="-1"><a class="header-anchor" href="#_12-2-初始化环境" aria-hidden="true">#</a> 12.2 初始化环境</h2><p>我们在一台虚拟机上模拟多台redis服务器，通过模拟端口的形式来进行</p><p>制作6个实例，6379,6380,6381,6389,6390,6391</p><blockquote><p>cluster-enabled yes 打开集群模式</p><p>cluster-config-file nodes-6379.conf 设定节点配置文件名</p><p>cluster-node-timeout 15000 设定节点失联时间，超过该时间（毫秒），集群自动进行主从切换。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>include /home/bigdata/redis.conf
port <span class="token number">6379</span>
pidfile <span class="token string">&quot;/var/run/redis_6379.pid&quot;</span>
dbfilename <span class="token string">&quot;dump6379.rdb&quot;</span>
<span class="token function">dir</span> <span class="token string">&quot;/home/bigdata/redis_cluster&quot;</span>
logfile <span class="token string">&quot;/home/bigdata/redis_cluster/redis_err_6379.log&quot;</span>
cluster-enabled <span class="token function">yes</span>
cluster-config-file nodes-6379.conf
cluster-node-timeout <span class="token number">15000</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>修改好redis6379</strong>.conf文件，拷贝多个redis.conf文件</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307230350312.png" alt="image-20220307230350312" tabindex="0" loading="lazy"><figcaption>image-20220307230350312</figcaption></figure><p><strong>修改好redis6379</strong>.conf文件，拷贝多个redis.conf文件</p><p><strong>使用查找替换修改另外5个文件</strong></p><blockquote><p>%s/6379/6380</p></blockquote><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307102712422.png" alt="image-20220307102712422" tabindex="0" loading="lazy"><figcaption>image-20220307102712422</figcaption></figure><p>文件都正常生成</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307102745380.png" alt="image-20220307102745380" tabindex="0" loading="lazy"><figcaption>image-20220307102745380</figcaption></figure><h2 id="_12-3-将6个结点合成一个集群" tabindex="-1"><a class="header-anchor" href="#_12-3-将6个结点合成一个集群" aria-hidden="true">#</a> 12.3 将6个结点合成一个集群</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@redis src<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster create --cluster-replicas 1 192.168.10.10:6379 192.168.10.10:6380 192.168.10.10:6381 192.168.10.10:6389 192.168.10.10:6390 192.168.10.10:6391</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307103343839.png" alt="image-20220307103343839" tabindex="0" loading="lazy"><figcaption>image-20220307103343839</figcaption></figure><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307103359547.png" alt="image-20220307103359547" tabindex="0" loading="lazy"><figcaption>image-20220307103359547</figcaption></figure><h2 id="_12-4-集群常用操作" tabindex="-1"><a class="header-anchor" href="#_12-4-集群常用操作" aria-hidden="true">#</a> 12.4 集群常用操作</h2><p><strong>-c</strong> 采用集群策略连接，设置数据会自动切换到相应的写主机</p><p><strong>通过 cluster nodes 命令查看集群信息</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307103759758.png" alt="image-20220307103759758" tabindex="0" loading="lazy"><figcaption>image-20220307103759758</figcaption></figure><p><strong>redis cluster如何分配这六个节点?</strong></p><p>一个集群至少要有三个主节点。</p><p>选项 --cluster-replicas 1 表示我们希望为集群中的每个主节点创建一个从节点。</p><p>分配原则尽量保证每个主数据库运行在不同的IP地址，每个从库和主库不在一个IP地址上。</p><h1 id="十三、redis应用问题" tabindex="-1"><a class="header-anchor" href="#十三、redis应用问题" aria-hidden="true">#</a> 十三、Redis应用问题</h1><h2 id="_13-1-缓存穿透" tabindex="-1"><a class="header-anchor" href="#_13-1-缓存穿透" aria-hidden="true">#</a> 13.1 缓存穿透</h2><p>**key对应的数据在数据源并不存在，每次针对此key的请求从缓存获取不到，请求都会压到数据源，从而可能压垮数据源。**比如用一个不存在的用户id获取用户信息，不论缓存还是数据库都没有，若黑客利用此漏洞进行攻击可能压垮数据库。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307231233509.png" alt="image-20220307231233509" tabindex="0" loading="lazy"><figcaption>image-20220307231233509</figcaption></figure><h3 id="_13-1-1-解决方案" tabindex="-1"><a class="header-anchor" href="#_13-1-1-解决方案" aria-hidden="true">#</a> 13.1.1 解决方案</h3><p>一个一定不存在缓存及查询不到的数据，由于缓存是不命中时被动写的，并且出于容错考虑，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到存储层去查询，失去了缓存的意义。</p><p>解决方案：</p><p>（1） **对空值缓存：**如果一个查询返回的数据为空（不管是数据是否不存在），我们仍然把这个空结果（null）进行缓存，设置空结果的过期时间会很短，最长不超过五分钟</p><p>（2） <strong>设置可访问的名单（白名单）：</strong></p><p>使用bitmaps类型定义一个可以访问的名单，名单id作为bitmaps的偏移量，每次访问和bitmap里面的id进行比较，如果访问id不在bitmaps里面，进行拦截，不允许访问。</p><p>（3） <strong>采用布隆过滤器</strong>：(布隆过滤器（Bloom Filter）是1970年由布隆提出的。它实际上是一个很长的二进制向量(位图)和一系列随机映射函数（哈希函数）。</p><p>布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难。)</p><p>将所有可能存在的数据哈希到一个足够大的bitmaps中，一个一定不存在的数据会被 这个bitmaps拦截掉，从而避免了对底层存储系统的查询压力。</p><p><strong>（4）</strong> **进行实时监控：**当发现Redis的命中率开始急速降低，需要排查访问对象和访问的数据，和运维人员配合，可以设置黑名单限制服务</p><h2 id="_13-2-缓存击穿" tabindex="-1"><a class="header-anchor" href="#_13-2-缓存击穿" aria-hidden="true">#</a> 13.2 缓存击穿</h2><p><strong>key对应的数据存在，但在redis中过期，此时若有大量并发请求过来，这些请求发现缓存过期一般都会从后端DB加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把后端DB压垮。</strong></p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307231347390.png" alt="image-20220307231347390" tabindex="0" loading="lazy"><figcaption>image-20220307231347390</figcaption></figure><h3 id="_13-2-1-解决方案" tabindex="-1"><a class="header-anchor" href="#_13-2-1-解决方案" aria-hidden="true">#</a> 13.2.1 解决方案</h3><p>key可能会在某些时间点被超高并发地访问，是一种非常“热点”的数据。这个时候，需要考虑一个问题：缓存被“击穿”的问题。</p><p>解决问题：</p><p><strong>（1</strong>）预先设置热门数据：在redis高峰访问之前，把一些热门数据提前存入到redis里面，加大这些热门数据key的时长</p><p><strong>（2</strong>）实时调整：现场监控哪些数据热门，实时调整key的过期时长</p><p><strong>（3</strong>）使用锁：</p><p>（1） 就是在缓存失效的时候（判断拿出来的值为空），不是立即去load db。</p><p>（2） 先使用缓存工具的某些带成功操作返回值的操作（比如Redis的SETNX）去set一个mutex key</p><p>（3） 当操作返回成功时，再进行load db的操作，并回设缓存,最后删除mutex key；</p><p>（4） 当操作返回失败，证明有线程在load db，当前线程睡眠一段时间再重试整个get缓存的方法。</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307231428298.png" alt="image-20220307231428298" tabindex="0" loading="lazy"><figcaption>image-20220307231428298</figcaption></figure><h2 id="_13-3-缓存雪崩" tabindex="-1"><a class="header-anchor" href="#_13-3-缓存雪崩" aria-hidden="true">#</a> 13.3 缓存雪崩</h2><p>key对应的数据存在，但在redis中过期，此时若有大量并发请求过来，这些请求发现缓存过期一般都会从后端DB加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把后端DB压垮。</p><p>缓存雪崩与缓存击穿的区别在于这里针对很多key缓存，前者则是某一个key</p><p>正常访问</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307231437196.png" alt="image-20220307231437196" tabindex="0" loading="lazy"><figcaption>image-20220307231437196</figcaption></figure><p>缓存失效瞬间</p><figure><img src="https://typora-1259403628.cos.ap-nanjing.myqcloud.com/image-20220307231442289.png" alt="image-20220307231442289" tabindex="0" loading="lazy"><figcaption>image-20220307231442289</figcaption></figure><h3 id="_13-3-1-解决方案" tabindex="-1"><a class="header-anchor" href="#_13-3-1-解决方案" aria-hidden="true">#</a> 13.3.1 解决方案</h3><p>缓存失效时的雪崩效应对底层系统的冲击非常可怕！</p><p>解决方案：</p><p><strong>（1）</strong> **构建多级缓存架构：**nginx缓存 + redis缓存 +其他缓存（ehcache等）</p><p><strong>（2）</strong> <strong>使用锁或队列：</strong></p><p>用加锁或者队列的方式保证来保证不会有大量的线程对数据库一次性进行读写，从而避免失效时大量的并发请求落到底层存储系统上。不适用高并发情况</p><p><strong>（3）</strong> <strong>设置过期标志更新缓存：</strong></p><p>记录缓存数据是否过期（设置提前量），如果过期会触发通知另外的线程在后台去更新实际key的缓存。</p><p><strong>（4）</strong> <strong>将缓存失效时间分散开：</strong></p><p>比如我们可以在原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。</p><hr></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/ssss/edit/main/demo/theme-docs/src/redis/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">Last update: </span><!----></div><div class="meta-item contributors"><span class="label">Contributors: </span><!--[--><!--[--><span class="contributor" title="email: mildcaq@163.com">xiaocai</span><!--]--><!--]--></div></footer><!----><div class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">NickName</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">E-Mail</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">Website</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="Write a comment here (Fill in the email address to receive an email notification when being replied)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>Preview:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="Emoji" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="GIF"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="Upload Image"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="Preview"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-text-number">0 <!--v-if-->  Words</div><button type="button" class="wl-btn">Login</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->Submit<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="Search GIF"><div class="wl-gallery" style="gap:6px;"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> Comments</div><ul class="wl-sort"><!--[--><li class="active">Latest</li><li class="">Oldest</li><li class="">Hottest</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v2.14.4</div></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Copyright © 2022 小蔡coding</div><div class="copyright">Copyright © 2022 xiaocai</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-59753726.js" defer></script>
  </body>
</html>
